<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width,minimum-scale=1,maximum-scale=1">

  
  
  <link href="//fonts.googleapis.com/css?family=Anonymous+Pro" rel="stylesheet" type="text/css">
  

  
  <title>Sharing knowledge</title>

  
  
  <link rel="stylesheet" href="https://uthark.github.io/css/hugo-octopress.css">

  
  

  
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css">

  
  <link href="https://uthark.github.io/favicon.png" rel="icon">

  
  
  

  <link href="https://uthark.github.io/index.xml" rel="alternate" type="application/rss+xml" title="Sharing knowledge" />

  <meta name="description" content="">
  <meta name="keywords" content="">

  <meta name="author" content="Oleg Atamanenko">

  
  <meta name="generator" content="Hugo 0.31.1" />

  
  

</head>
<body>


<header role="banner"><hgroup>
  
  <h1><a href="https://uthark.github.io/">Sharing knowledge</a></h1>
    <h2></h2>
</hgroup></header>


<nav role="navigation">

<ul class="main-navigation">
  
  
    
      <li><a href="https://uthark.github.io/" title="Home">Home</a></li>
    
  
    
      <li><a href="https://uthark.github.io/categories/article/" title="Articles" >Articles</a></li>
    
  
    
      <li><a href="https://uthark.github.io/categories/reading-list/" title="Reading List" >Reading List</a></li>
    
  
    
      <li><a href="https://uthark.github.io/about/" title="About me" >About me</a></li>
    
  
</ul>


<ul class="subscription">
  
    
        <a href="https://uthark.github.io/index.xml" target="_blank" type="application/rss+xml" title="RSS"><i class="fa fa-rss-square fa-lg"></i></a>
    
  

</ul>


<form action="https://www.google.com/search" method="get" target="_blank">
  <fieldset role="search">
  	<input class="search" type="text" name="q" results="0" placeholder="Search"/>
    <input type="hidden" name="q" value="site:https://uthark.github.io/" />
  </fieldset>
</form>

</nav>


<div id="main">
 <div id="content">
  <div class="blog-index">
    
    
    <article>

        
        

<header>
    <h1 class="entry-title">
        <a href="https://uthark.github.io/2009/11/14/delicious-bookmarks-google/">Расширение Delicious Bookmarks для Google Chrome/Chromium</a>
    </h1>

</header>


        
        <p><h1>Введение</h1><br />
Решил научиться писать собственные расширения для <a href="http://www.google.com/chrome">Google Chrome</a>/<a href="http://www.chromium.org/">Chromium</a>.<br />
<br />
За идею взял официальное расширение от <a href="http://m.www.yahoo.com/">Yahoo!</a> для <a href="http://www.mozilla.com/en-US/firefox/firefox.html">Firefox</a> - <a href="https://addons.mozilla.org/en-US/firefox/addon/3615">Delicious Bookmarks</a>.<br />
<br />
<h1>Структура расширения</h1><br />
Расширение - файл с расширением <tt>.crx</tt>. На самом деле это просто <tt>ZIP</tt>-архив с файлом манифеста внутри.<br />
<br />
<h1>Файл манифеста</h1><pre class="brush:js; highlight: [2, 3, 4, 5, 10, 16, 23]">{
&ldquo;name&rdquo;: &ldquo;Delicious plugin&rdquo;, // 1
&ldquo;version&rdquo;: &ldquo;0.2&rdquo;, // 2
&ldquo;background_page&rdquo;: &ldquo;background.html&rdquo;, // 3
&ldquo;permissions&rdquo;: [ // 4
&ldquo;bookmarks&rdquo;,
&ldquo;tabs&rdquo;
],</p>

<p>&ldquo;browser_action&rdquo;: { // 5
&ldquo;name&rdquo;: &ldquo;Save bookmark to delicious.com&rdquo;,
&ldquo;default_title&rdquo;: &ldquo;Save bookmark to delicious.com&rdquo;,
&ldquo;default_icon&rdquo;: &ldquo;delicious.20.gif&rdquo; // optional
},</p>

<p>&ldquo;content_scripts&rdquo;: [ // 6
{
&ldquo;matches&rdquo;: [&ldquo;http://<em>/</em>&rdquo;, &ldquo;https://<em>/</em>&rdquo;],
&ldquo;js&rdquo;: [&ldquo;getDocumentSelection.js&rdquo;]
}
],</p>

<p>&ldquo;options_page&rdquo;: &ldquo;options.html&rdquo; // 7
}
</pre><br />
Манифест - файл в формате <a href="http://json.org/">JSON</a>.<br />
<br />
Манифест состоит из следующих частей:<br />
<br />
1. <span style="font-weight:bold;"><tt>name</tt></span> - Имя расширения<br />
2. <span style="font-weight:bold;"><tt>version</tt></span> - Версия расширения<br />
3. <span style="font-weight:bold;"><tt>background_page</tt></span> - основной файл с расширением. Это обычный HTML-файл с разметкой.<br />
4. <span style="font-weight:bold;"><tt>permissions</tt></span> - разрешения для расширения. Указываем, что нам нужен доступ к вкладкам (tabs) и закладкам (bookmarks).<br />
5. <span style="font-weight:bold;"><tt>browser_action</tt></span> - указываем, что нужно отобразить на панели инструментов браузера.<br />
6. <span style="font-weight:bold;"><tt>content_scripts</tt></span> - Для доступа к DOM отображаемой страницы необходимы content scripts, данный блок регистрирует скрипт <tt>getDocumentSelection.js</tt> для всех <tt>http</tt> и <tt>https</tt> страниц.<br />
7. <span style="font-weight:bold;"><tt>options_page</tt></span> - страница с настройками.<br />
<br />
Подробное описание файла манифеста есть <a href="http://code.google.com/chrome/extensions/manifest.html">на официальном сайте</a>. <br />
<br />
<h1>Описание работы расширения</h1><br />
<br />
Расширение работает следующим образом:<br />
1. При клике на значок расширения вызывается обработчик <tt>addBookmark</tt><br />
2. Обработчик открывает коммуникационный порт и отправляет сообщение скрипту содержимого.<br />
3. Скрипт содержимого забирает выделенный текст и отправляет назад расширению выделенный текст.<br />
4. Расширение забирает выделенный текст, определяет настройки сохранения (Private/Public) и вызывает окно сохранения <span style="font-style:italic;">Delicious</span>.<br />
<br />
<h1>Реализация расширения</h1><br />
<br />
<span style="font-weight:bold;">background.html</span>:<br />
<pre class="brush:js; html-script: true">&lt;html&gt;
&lt;head&gt;
&lt;script&nbsp;type=&quot;text/javascript&quot;&gt;
&nbsp;&nbsp;&nbsp;&nbsp;function&nbsp;saveBookmark()&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Send&nbsp;our&nbsp;password&nbsp;to&nbsp;the&nbsp;current&nbsp;tab&nbsp;when&nbsp;clicked.
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;chrome.tabs.getSelected(null,&nbsp;function(tab)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;port&nbsp;=&nbsp;chrome.tabs.connect(tab.id,&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name&nbsp;:&nbsp;&quot;deliciousBookmark&quot;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;port.postMessage(&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;action&nbsp;:&nbsp;&lsquo;getSelection&rsquo;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});
&nbsp;&nbsp;&nbsp;&nbsp;}</p>

<p>&nbsp;&nbsp;&nbsp;&nbsp;function&nbsp;addBookmark(id,&nbsp;bookmark)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;console.log(&quot;added&nbsp;bookmark:&nbsp;&nbsp;&quot;&nbsp;+&nbsp;bookmark);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;saveBookmark();
&nbsp;&nbsp;&nbsp;&nbsp;}</p>

<p>&nbsp;&nbsp;&nbsp;&nbsp;chrome.bookmarks.onCreated.addListener(addBookmark);
&nbsp;&nbsp;&nbsp;&nbsp;console.log(&quot;Registered&nbsp;listener&quot;);</p>

<p>&nbsp;&nbsp;&nbsp;&nbsp;function&nbsp;getShareStatus()&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;markPrivate&nbsp;=&nbsp;localStorage[&quot;markPrivate&quot;];
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;share&nbsp;=&nbsp;&quot;yes&quot;;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(markPrivate&nbsp;==&nbsp;&quot;true&quot;)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;share&nbsp;=&nbsp;&quot;no&quot;;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;share;
&nbsp;&nbsp;&nbsp;&nbsp;}</p>

<p>&nbsp;&nbsp;&nbsp;&nbsp;chrome.extension.onConnect.addListener(function(port)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;console.assert(port.name&nbsp;==&nbsp;&quot;deliciousBookmark&quot;);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;port.onMessage.addListener(function(msg)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;selection&nbsp;=&nbsp;msg.selection;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;chrome.tabs.getSelected(null,&nbsp;function(tab)&nbsp;{</p>

<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;url&nbsp;=&nbsp;encodeURIComponent(tab.url);</p>

<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!url&nbsp;||&nbsp;url&nbsp;===&nbsp;&quot;&quot;)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</p>

<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;title&nbsp;=&nbsp;encodeURIComponent(tab.title);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;description&nbsp;=&nbsp;encodeURIComponent(selection);</p>

<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;share&nbsp;=&nbsp;getShareStatus();</p>

<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;f&nbsp;=&nbsp;&lsquo;<a href="http://delicious.com/save?url='&nbsp;+&nbsp;url&nbsp;+&nbsp;'&amp;title='&nbsp;+&nbsp;title&nbsp;+&nbsp;'&amp;notes='&nbsp;+&nbsp;description">http://delicious.com/save?url='&nbsp;+&nbsp;url&nbsp;+&nbsp;'&amp;title='&nbsp;+&nbsp;title&nbsp;+&nbsp;'&amp;notes='&nbsp;+&nbsp;description</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;&lsquo;&amp;share=&rsquo;&nbsp;+&nbsp;share&nbsp;+&nbsp;&lsquo;&amp;v=5&amp;&rsquo;;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;window.open(f&nbsp;+&nbsp;&lsquo;noui=1&amp;jump=doclose&rsquo;,&nbsp;&lsquo;deliciousuiv5&rsquo;,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lsquo;location=yes,links=no,scrollbars=no,toolbar=no,width=550,height=550&rsquo;);</p>

<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});
&nbsp;&nbsp;&nbsp;&nbsp;});</p>

<p>&nbsp;&nbsp;&nbsp;&nbsp;chrome.browserAction.onClicked.addListener(saveBookmark);
&lt;/script&gt;
&lt;/head&gt;
&lt;/html&gt;</p>

<p></pre><br />
<br />
<span style="font-weight:bold;">getDocumentSelection.js</span><br />
<br />
<pre class="brush:js">var port = chrome.extension.connect( {
name : &ldquo;deliciousBookmark&rdquo;
});</p>

<p>// Also listen for new channels from the extension for when the button is
// pressed.
chrome.extension.onConnect.addListener(function(port) {
console.assert(port.name == &ldquo;deliciousBookmark&rdquo;);
port.onMessage.addListener(function(msg) {
if (msg.action == &lsquo;getSelection&rsquo;) {
var responsePort = chrome.extension.connect( {
name : &ldquo;deliciousBookmark&rdquo;
});
var description = document.getSelection() ? &ldquo; + document.getSelection() : &ldquo;;
responsePort.postMessage( {
selection : description
});
}
});
});</p>

<p></pre><br />
<br />
<span style="font-weight:bold;">options.html</span><br />
<br />
<pre class="brush:js; html-script: true">&lt;html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;title&gt;Delicious Bookmarks Options&lt;/title&gt;
&lt;/head&gt;
&lt;script type=&quot;text/javascript&quot;&gt;
    // Saves options to localStorage.
    function saveOptions() {
        var share = document.getElementById(&quot;share&quot;);
        localStorage[&quot;markPrivate&quot;] = share.checked;</p>

<pre><code>    // Update status to let user know options were saved.
    var status = document.getElementById(&amp;quot;status&amp;quot;);
    status.innerHTML = &amp;quot;Options Saved.&amp;quot;;
    setTimeout(function() {
        status.innerHTML = &amp;quot;&amp;quot;;
    }, 1500);
}

// Restores select box state to saved value from localStorage.
function restoreOptions() {
    var share = localStorage[&amp;quot;markPrivate&amp;quot;];

    if (!share) {
        return;
    }
    var shareCheckbox = document.getElementById(&amp;quot;share&amp;quot;);

    shareCheckbox.checked = share;

}
</code></pre>

<p>&lt;/script&gt;</p>

<p>&lt;body onload=&quot;restoreOptions()&quot;&gt;</p>

<p>&lt;label for=&quot;share&quot;&gt;Mark as Private&lt;/label&gt;
&lt;input type=&quot;checkbox&quot; class=&quot;checkbox&quot; name=&quot;share&quot; id=&quot;share&quot; /&gt;</p>

<p>&lt;br&gt;
&lt;button onclick=&quot;saveOptions();&quot;&gt;Save&lt;/button&gt;
&lt;div id=&quot;status&quot;&gt;&amp;nbsp;&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
</pre><br />
<br />
<h1>Сборка расширения</h1><br />
В Chromium есть возможность собрать расширение.<br />
1. Открываем адрес <tt>chrome://extensions/</tt><br />
2. В правом верхнем углу нажимаем Developer Mode.<br />
3. На появившейся панели инструментов кликаем Pack Extension<br />
4. Выбираем каталог, в котором находится расширение<br />
5. Chromium автоматически собирает расширение в каталоге с исходниками расширения.<br />
<br />
<h1>Заключение</h1><br />
Писать расширения для Google Chrome не просто, а очень просто. <br />
<br />
Готовое и собранное расширение можно <a href="http://bit.ly/2KYnr8">скачать здесь</a>.<br />
<br />
<h1>Дополнительная информация</h1><br />
<ol><li><a href="http://code.google.com/chrome/extensions/devguide.html">Google Chrome Extensions Developer&rsquo;s Guide</a></li>
<li><a href="http://code.google.com/chrome/extensions/manifest.html">Manifest file description</a></li>
<li><a href="http://code.google.com/chrome/extensions/api_index.html">Chrome Extensions API</a></li>
<li><a href="http://code.google.com/chrome/extensions/packaging.html">Extension Packaging</a></li>
</ol><br />
<br />
В следующей заметке опишу работу messaging для коммуникации расширения со скриптами содержимого.</p>

        

    </article>
    
    <article>

        
        

<header>
    <h1 class="entry-title">
        <a href="https://uthark.github.io/2009/11/02/google-wave/">Инвайты на Google Wave</a>
    </h1>

</header>


        
        <p>Кому нужны инвайты на Google Wave, отписываемся в комментариях - поделюсь.</p>

<p><strong>UPD</strong>. Инвайты закончились, всем спасибо.</p>

        

    </article>
    
    <article>

        
        

<header>
    <h1 class="entry-title">
        <a href="https://uthark.github.io/2009/07/07/blog-post/">Двунаправленная ссылочная целостность</a>
    </h1>

</header>


        
        

<p>Здравствуйте.</p>

<p>Я считаю, что разработчику всегда стоит иметь представление о том, как работают низлежащие абстракции. Хотя бы потому, что часто <a href="http://c2.com/cgi/wiki?LeakyAbstraction">абстракции</a> <a href="http://en.wikipedia.org/wiki/Leaky_abstraction">бывают</a> <a href="http://www.joelonsoftware.com/articles/LeakyAbstractions.html">протекающими</a>.</p>

<p>А веду я это к тому, что когда фреймворк вываливает стектрейс с несколькими вложенными (и, часто, для непосвященных непонятными) исключениями, то бывает непонятно, что с этим делать, особенно, если не знаешь, как реализована абстракция.</p>

<p>Иногда бывает нужно хранить двунаправленные связи между таблицами. Например, есть игрок и есть его статистика и нужно, чтобы каждая из сущностей знала про другую.</p>

<p>Вопрос - каким образом вставлять в базу данных такие сущности?</p>

<p>При вставке в таблицу в <code>Player</code> нам нужно уже иметь запись в таблице <code>Statistics</code>, а для вставки в таблицу <code>Statistics</code> нужно знать идентификатор игрока, к которому относится эта запись.</p>

<p>Выглядит замкнутым кругом, но решение есть.</p>

<p>Во-первых, вставки в обе таблицы должны происходить в рамках одной транзакции (как я <a href="http://www.blogger.com/2009/04/blog-post_24.html">уже писал</a>, транзакция обеспечивает перевод базы данных из одного непротиворечащего состояния в другое непротиворечащее состояние).</p>

<p>К сожалению, этого недостаточно:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">BEGIN</span> TRANSACTION;

<span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> <span style="color:#e6db74">&#34;Player&#34;</span>  <span style="color:#66d9ef">VALUES</span> (<span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">20</span>);
<span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> <span style="color:#e6db74">&#34;Statistics&#34;</span>  <span style="color:#66d9ef">VALUES</span> (<span style="color:#ae81ff">20</span>, <span style="color:#ae81ff">10</span>);

<span style="color:#66d9ef">COMMIT</span>;</code></pre></div>
<p>выдаёт следующую ошибку:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">ERROR: insert or update on table <span style="color:#e6db74">&#34;Player&#34;</span> violates foreign key constraint <span style="color:#e6db74">&#34;statisticsId&#34;</span>
SQL state: <span style="color:#ae81ff">23503</span>
Detail: Key <span style="color:#f92672">(</span>statisticsId<span style="color:#f92672">)=(</span><span style="color:#ae81ff">20</span><span style="color:#f92672">)</span> is not present in table <span style="color:#e6db74">&#34;Statistics&#34;</span>.</code></pre></div>
<p>И снова кажется, что замкнутый круг не разорвать</p>

<p>Но решение всё же есть.</p>

<p>Многие базы данных позволяют нарушать консистентность базы данных внутри транзакции. В данном случае можно &ldquo;попросить&rdquo; базу данных отложить проверку ссылочной целостности. На примере <code>PostgreSQL</code> рассмотрим, как это работает.</p>

<h3 id="postgresql">PostgreSQL</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-postgresql" data-lang="postgresql"><span style="color:#66d9ef">begin</span> <span style="color:#66d9ef">transaction</span>;

<span style="color:#66d9ef">set</span> <span style="color:#66d9ef">constraints</span> <span style="color:#66d9ef">all</span> <span style="color:#66d9ef">deferred</span>; <span style="color:#75715e">-- 1
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;Player&#34;</span>  <span style="color:#66d9ef">VALUES</span> (<span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">20</span>);
<span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;Statistics&#34;</span>  <span style="color:#66d9ef">VALUES</span> (<span style="color:#ae81ff">20</span>, <span style="color:#ae81ff">10</span>);

<span style="color:#66d9ef">set</span> <span style="color:#66d9ef">constraints</span> <span style="color:#66d9ef">all</span> <span style="color:#66d9ef">immediate</span>; <span style="color:#75715e">-- 2
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">commit</span>; <span style="color:#75715e">-- 3</span></code></pre></div>
<p>1 - Сделать все ограничения отложенными. Ограничения будут проверены в момент проведения фиксации транзакции (в строке 3)</p>

<p>2 - Явно делаем все ограничения немедленными. В данном примере это необязательно, так как в 3) они всё равно будут проверены.</p>

<p>После выполнения данного кода получаем:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">Query returned successfully with no result in <span style="color:#ae81ff">24</span> ms.</code></pre></div>
<p>Это уже полностью рабочий пример, чтобы это заработало нужно явно сделать ограничения отложенными - они должны быть объявлены как <code>DEFERRED</code>. Официальная документация к PostgreSQL гласит:</p>

<blockquote>
<p>Upon creation, a constraint is given one of three characteristics: DEFERRABLE INITIALLY DEFERRED, DEFERRABLE INITIALLY IMMEDIATE, or NOT DEFERRABLE. The third class is always IMMEDIATE and is not affected by the SET CONSTRAINTS command. The first two classes start every transaction in the indicated mode, but their behavior can be changed within a transaction by SET CONSTRAINTS.</p>
</blockquote>

<p>Так что необходимо также модифицировать объявления ограничений:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">ALTER</span> <span style="color:#66d9ef">TABLE</span> <span style="color:#e6db74">&#34;Player&#34;</span>
<span style="color:#66d9ef">ADD</span> <span style="color:#66d9ef">CONSTRAINT</span> <span style="color:#e6db74">&#34;statisticsId&#34;</span> <span style="color:#66d9ef">FOREIGN</span> <span style="color:#66d9ef">KEY</span> (<span style="color:#e6db74">&#34;statisticsId&#34;</span>)
<span style="color:#66d9ef">REFERENCES</span> <span style="color:#e6db74">&#34;Statistics&#34;</span> (<span style="color:#e6db74">&#34;statisticsId&#34;</span>) <span style="color:#66d9ef">MATCH</span> <span style="color:#66d9ef">SIMPLE</span>
<span style="color:#66d9ef">ON</span> <span style="color:#66d9ef">UPDATE</span> <span style="color:#66d9ef">NO</span> ACTION <span style="color:#66d9ef">ON</span> <span style="color:#66d9ef">DELETE</span> <span style="color:#66d9ef">NO</span> ACTION <span style="color:#66d9ef">DEFERRABLE</span> <span style="color:#66d9ef">INITIALLY</span> <span style="color:#66d9ef">IMMEDIATE</span>;</code></pre></div>
<p>Данный пример был приведён для PostgreSQL.</p>

<p>Для других баз данных решения следующие:</p>

<h3 id="sybase">Sybase</h3>

<p>В Sybase есть переменная <a href="http://manuals.sybase.com/onlinebooks/group-sasarc/awg0600e/dbugen6/@Generic__BookTextView/26075;hf=0;pt=25811">WAIT_FOR_COMMIT</a>, которая управляет поведением проверки ограничений. По умолчанию она отключена. Кроме того, это поведение можно переопределить при объявлении можно указывать CHECK ON COMMIT. Подробнее можно посмотреть в <a href="http://manuals.sybase.com/onlinebooks/group-pbarc/conn5/sqlug/@Generic__BookTextView/39397%3Bpt=39951">официальной документации</a>.</p>

<h3 id="oracle">Oracle</h3>

<p>Также, как и в PostgreSQL:</p>

<blockquote>
<p>You can define constraints as either deferrable or not deferrable, and either initially deferred or initially immediate. These attributes can be different for each constraint. You specify them with keywords in the CONSTRAINT clause:
DEFERRABLE or NOT DEFERRABLE
INITIALLY DEFERRED or INITIALLY IMMEDIATE</p>

<p>Constraints can be added, dropped, enabled, disabled, or validated. You can also modify a constraint&rsquo;s attributes.<br /></p>
</blockquote>

<p>Подробнее в <a href="http://download.oracle.com/docs/cd/B10501_01/server.920/a96524/c22integ.htm#4666">официльной документации</a>.</p>

<h2 id="mysql">MySQL</h2>

<p>К сожалению, mySQL не имеет возможности отложенной проверки ограничении, о чём в документации и сказано:</p>

<blockquote>
<p>Deviation from SQL standards: Like MySQL in general, in an SQL statement that inserts, deletes, or updates many rows, InnoDB checks UNIQUE and FOREIGN KEY constraints row-by-row. According to the SQL standard, the default behavior should be deferred checking. That is, constraints are only checked after the entire SQL statement has been processed. Until InnoDB implements deferred constraint checking, some things will be impossible, such as deleting a record that refers to itself via a foreign key.</p>
</blockquote>

<p>Но это не конец света, так как можно отключить проверку внешних ключей:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">SET</span> foreign_key_checks <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
<span style="color:#75715e">-- code goes here
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SET</span> foreign_key_checks <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;</code></pre></div>
<p>Чем эта информация может быть полезна для разработчика? Например, в случае, если ошибки и недоработки Hibernate покажут себя в виде стектрейса в логе(например, <a href="http://opensource.atlassian.com/projects/hibernate/browse/HHH-2248">HHH-2248</a>), то разработчик будет понимать причину ошибки и то, как реализовать work-around.</p>

        

    </article>
    
    <article>

        
        

<header>
    <h1 class="entry-title">
        <a href="https://uthark.github.io/2009/07/04/opera-delicious/">Opera и del.icio.us</a>
    </h1>

</header>


        
        <p>Так получилось, что в последнее время я стал пользоваться небезызвестной <a href="http://www.opera.com">оперой</a>.</p>

<p>В связи с этим я стал искать замену часто используемым расширениям, одно из них - delicious bookmarks. Сервис <a href="http://delicious.com">del.icio.us</a> предоставляет букмарклеты для различных браузеров, которые позволяют сохранять закладки быстро и удобно. Вот только есть один недостаток - <a href="https://addons.mozilla.org/en-US/firefox/addon/3615">официальный плагин для Firefox</a> в свойство Notes новой закладки добавляет выделенный текст со страницы, чего букмарклет не делает.</p>

<p>Посмотрев исходник букмарклета, а это обычный javascript, я добавил небольшой кусочек кода, который восстанавливает справедливость и тоже добавляет в поле Notes текст, выделенный на странице.</p>

<p>Ниже привожу изменённый код букмарклета:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#a6e22e">javascript</span><span style="color:#f92672">:</span>(<span style="color:#66d9ef">function</span>(){<span style="color:#a6e22e">f</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;http://delicious.com/save?url=&#39;</span><span style="color:#f92672">+</span>encodeURIComponent(window.<span style="color:#a6e22e">location</span>.<span style="color:#a6e22e">href</span>)<span style="color:#f92672">+</span><span style="color:#e6db74">&#39;&amp;title=&#39;</span><span style="color:#f92672">+</span>encodeURIComponent(document.<span style="color:#a6e22e">title</span>)<span style="color:#f92672">+</span><span style="color:#e6db74">&#39;¬es=&#39;</span><span style="color:#f92672">+</span>encodeURIComponent(document.<span style="color:#a6e22e">getSelection</span>())<span style="color:#f92672">+</span><span style="color:#e6db74">&#39;&amp;v=5&amp;&#39;</span>;<span style="color:#a6e22e">a</span><span style="color:#f92672">=</span><span style="color:#66d9ef">function</span>(){<span style="color:#66d9ef">if</span>(<span style="color:#f92672">!</span>window.<span style="color:#a6e22e">open</span>(<span style="color:#a6e22e">f</span><span style="color:#f92672">+</span><span style="color:#e6db74">&#39;noui=1&amp;jump=doclose&#39;</span>,<span style="color:#e6db74">&#39;deliciousuiv5&#39;</span>,<span style="color:#e6db74">&#39;location=yes,links=no,scrollbars=no,toolbar=no,width=550,height=550&#39;</span>))<span style="color:#a6e22e">location</span>.<span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#a6e22e">f</span><span style="color:#f92672">+</span><span style="color:#e6db74">&#39;jump=yes&#39;</span>};<span style="color:#66d9ef">if</span>(<span style="color:#e6db74">/Firefox/</span>.<span style="color:#a6e22e">test</span>(<span style="color:#a6e22e">navigator</span>.<span style="color:#a6e22e">userAgent</span>)){<span style="color:#a6e22e">setTimeout</span>(<span style="color:#a6e22e">a</span>,<span style="color:#ae81ff">0</span>)}<span style="color:#66d9ef">else</span>{<span style="color:#a6e22e">a</span>()}})()</code></pre></div>
        

    </article>
    
    <article>

        
        

<header>
    <h1 class="entry-title">
        <a href="https://uthark.github.io/2009/06/06/spring-roo-2/">Spring Roo (часть 2)</a>
    </h1>

</header>


        
        

<p><h1>Архитектура сгенерированного приложения</h1>
Spring Roo активно использует аспекты. В качестве реализации аспектов была взята библиотека <a href="http://www.eclipse.org/aspectj/">aspectj</a>.
Большая часть сгенерированного кода попадает в отдельные файлы-аспекты.
Создадим простой класс:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">new persistent class jpa -name ~.domain.Action -testAutomatically
add field string name -notNull -sizeMin <span style="color:#ae81ff">1</span> -sizeMax <span style="color:#ae81ff">80</span>
add field string description -sizeMax <span style="color:#ae81ff">1024</span></code></pre></div>
<p>Spring Roo создаст нам следующие файлы:</p>

<ul>
<li><strong>Action.java</strong>
Класс содержит только полезную с точки зрения назначения класса информацию. По сути, то, что вводит разработчик в консоль Roo аккумулируется здесь. Весь дополнительный код разносится по другим классам.</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Entity</span> <span style="color:#75715e">//1
</span><span style="color:#75715e"></span><span style="color:#a6e22e">@RooJavaBean</span> <span style="color:#75715e">//2
</span><span style="color:#75715e"></span><span style="color:#a6e22e">@RooToString</span> <span style="color:#75715e">//3
</span><span style="color:#75715e"></span><span style="color:#a6e22e">@RooEntity</span><span style="color:#f92672">(</span>finders <span style="color:#f92672">=</span> <span style="color:#f92672">{</span> <span style="color:#e6db74">&#34;findActionsByName&#34;</span> <span style="color:#f92672">})</span> <span style="color:#75715e">//4
</span><span style="color:#75715e"></span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Action</span> <span style="color:#f92672">{</span>

<span style="color:#a6e22e">@NotNull</span>
<span style="color:#a6e22e">@Size</span><span style="color:#f92672">(</span>min <span style="color:#f92672">=</span> 1<span style="color:#f92672">,</span> max <span style="color:#f92672">=</span> 80<span style="color:#f92672">)</span>
<span style="color:#66d9ef">private</span> String name<span style="color:#f92672">;</span>


<span style="color:#a6e22e">@Size</span><span style="color:#f92672">(</span>max <span style="color:#f92672">=</span> 1024<span style="color:#f92672">)</span>
<span style="color:#66d9ef">private</span> String description<span style="color:#f92672">;</span>
<span style="color:#f92672">}</span></code></pre></div>
<p>Мы видим, что:</p>

<ol>
<li>Класс является JPA-сущностью.</li>
<li>Аннотация <code>@RooJavaBean</code> говорит, что этот класс - обычный Java-бин.</li>
<li>Аннотация <code>@RooToString</code> говорит, что у этого класса есть перегруженный метод toString().</li>
<li>Аннотация <code>@RooEntity</code> говорит что класс является JPA-сущностью.</li>
</ol>

<ul>
<li><strong>Action_Roo_Configurable.aj</strong>
Данный аспект говорит, что класс Action является конфигурируемым через Spring.</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">privileged aspect Action_Roo_Configurable <span style="color:#f92672">{</span>
declare <span style="color:#a6e22e">@type</span><span style="color:#f92672">:</span> Action: <span style="color:#a6e22e">@org.springframework.beans.factory.annotation.Configurable</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span></code></pre></div>
<ul>
<li><strong>Action_Roo_Entity.aj</strong>
В данном классе собраны все методы DAO для работы с классом Action.</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">package</span> org.academ.uthark.research.roo.domain<span style="color:#f92672">;</span>

privileged aspect Action_Roo_Entity <span style="color:#f92672">{</span>

<span style="color:#a6e22e">@javax.persistence.PersistenceContext</span>
<span style="color:#66d9ef">transient</span> javax<span style="color:#f92672">.</span><span style="color:#a6e22e">persistence</span><span style="color:#f92672">.</span><span style="color:#a6e22e">EntityManager</span> Action<span style="color:#f92672">.</span><span style="color:#a6e22e">entityManager</span><span style="color:#f92672">;</span>

<span style="color:#a6e22e">@javax.persistence.Id</span>
<span style="color:#a6e22e">@javax.persistence.GeneratedValue</span><span style="color:#f92672">(</span>strategy <span style="color:#f92672">=</span> javax<span style="color:#f92672">.</span><span style="color:#a6e22e">persistence</span><span style="color:#f92672">.</span><span style="color:#a6e22e">GenerationType</span><span style="color:#f92672">.</span><span style="color:#a6e22e">AUTO</span><span style="color:#f92672">)</span>
<span style="color:#a6e22e">@javax.persistence.Column</span><span style="color:#f92672">(</span>name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;id&#34;</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">private</span> java<span style="color:#f92672">.</span><span style="color:#a6e22e">lang</span><span style="color:#f92672">.</span><span style="color:#a6e22e">Long</span> Action<span style="color:#f92672">.</span><span style="color:#a6e22e">id</span><span style="color:#f92672">;</span>

<span style="color:#a6e22e">@javax.persistence.Version</span>
<span style="color:#a6e22e">@javax.persistence.Column</span><span style="color:#f92672">(</span>name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;version&#34;</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">private</span> java<span style="color:#f92672">.</span><span style="color:#a6e22e">lang</span><span style="color:#f92672">.</span><span style="color:#a6e22e">Integer</span> Action<span style="color:#f92672">.</span><span style="color:#a6e22e">version</span><span style="color:#f92672">;</span>

<span style="color:#66d9ef">public</span> java<span style="color:#f92672">.</span><span style="color:#a6e22e">lang</span><span style="color:#f92672">.</span><span style="color:#a6e22e">Long</span> Action<span style="color:#f92672">.</span><span style="color:#a6e22e">getId</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">id</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> Action<span style="color:#f92672">.</span><span style="color:#a6e22e">setId</span><span style="color:#f92672">(</span>java<span style="color:#f92672">.</span><span style="color:#a6e22e">lang</span><span style="color:#f92672">.</span><span style="color:#a6e22e">Long</span> id<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
<span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">id</span> <span style="color:#f92672">=</span> id<span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>

<span style="color:#66d9ef">public</span> java<span style="color:#f92672">.</span><span style="color:#a6e22e">lang</span><span style="color:#f92672">.</span><span style="color:#a6e22e">Integer</span> Action<span style="color:#f92672">.</span><span style="color:#a6e22e">getVersion</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">version</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> Action<span style="color:#f92672">.</span><span style="color:#a6e22e">setVersion</span><span style="color:#f92672">(</span>java<span style="color:#f92672">.</span><span style="color:#a6e22e">lang</span><span style="color:#f92672">.</span><span style="color:#a6e22e">Integer</span> version<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
<span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">version</span> <span style="color:#f92672">=</span> version<span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>

<span style="color:#a6e22e">@org.springframework.transaction.annotation.Transactional</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> Action<span style="color:#f92672">.</span><span style="color:#a6e22e">persist</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
<span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">entityManager</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> IllegalStateException<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Entity manager has not been injected (is the Spring Aspects JAR configured as an AJC/AJDT aspects library?)&#34;</span><span style="color:#f92672">);</span>
<span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">entityManager</span><span style="color:#f92672">.</span><span style="color:#a6e22e">persist</span><span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">);</span>
<span style="color:#f92672">}</span>

<span style="color:#a6e22e">@org.springframework.transaction.annotation.Transactional</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> Action<span style="color:#f92672">.</span><span style="color:#a6e22e">remove</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
<span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">entityManager</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> IllegalStateException<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Entity manager has not been injected (is the Spring Aspects JAR configured as an AJC/AJDT aspects library?)&#34;</span><span style="color:#f92672">);</span>
<span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">entityManager</span><span style="color:#f92672">.</span><span style="color:#a6e22e">remove</span><span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">);</span>
<span style="color:#f92672">}</span>

<span style="color:#a6e22e">@org.springframework.transaction.annotation.Transactional</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> Action<span style="color:#f92672">.</span><span style="color:#a6e22e">flush</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
<span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">entityManager</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> IllegalStateException<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Entity manager has not been injected (is the Spring Aspects JAR configured as an AJC/AJDT aspects library?)&#34;</span><span style="color:#f92672">);</span>
<span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">entityManager</span><span style="color:#f92672">.</span><span style="color:#a6e22e">flush</span><span style="color:#f92672">();</span>
<span style="color:#f92672">}</span>

<span style="color:#a6e22e">@org.springframework.transaction.annotation.Transactional</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> Action<span style="color:#f92672">.</span><span style="color:#a6e22e">merge</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
<span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">entityManager</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> IllegalStateException<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Entity manager has not been injected (is the Spring Aspects JAR configured as an AJC/AJDT aspects library?)&#34;</span><span style="color:#f92672">);</span>
Action merged <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">entityManager</span><span style="color:#f92672">.</span><span style="color:#a6e22e">merge</span><span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">);</span>
<span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">entityManager</span><span style="color:#f92672">.</span><span style="color:#a6e22e">flush</span><span style="color:#f92672">();</span>
<span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">id</span> <span style="color:#f92672">=</span> merged<span style="color:#f92672">.</span><span style="color:#a6e22e">getId</span><span style="color:#f92672">();</span>
<span style="color:#f92672">}</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">long</span> Action<span style="color:#f92672">.</span><span style="color:#a6e22e">countActions</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
<span style="color:#66d9ef">return</span> <span style="color:#f92672">(</span>Long<span style="color:#f92672">)</span> <span style="color:#66d9ef">new</span> Action<span style="color:#f92672">().</span><span style="color:#a6e22e">entityManager</span><span style="color:#f92672">.</span><span style="color:#a6e22e">createQuery</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;select count(o) from Action o&#34;</span><span style="color:#f92672">).</span><span style="color:#a6e22e">getSingleResult</span><span style="color:#f92672">();</span>
<span style="color:#f92672">}</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> java<span style="color:#f92672">.</span><span style="color:#a6e22e">util</span><span style="color:#f92672">.</span><span style="color:#a6e22e">List</span><span style="color:#f92672">&lt;</span>org<span style="color:#f92672">.</span><span style="color:#a6e22e">academ</span><span style="color:#f92672">.</span><span style="color:#a6e22e">uthark</span><span style="color:#f92672">.</span><span style="color:#a6e22e">research</span><span style="color:#f92672">.</span><span style="color:#a6e22e">roo</span><span style="color:#f92672">.</span><span style="color:#a6e22e">domain</span><span style="color:#f92672">.</span><span style="color:#a6e22e">action</span><span style="color:#f92672">&gt;</span> Action<span style="color:#f92672">.</span><span style="color:#a6e22e">findAllActions</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> Action<span style="color:#f92672">().</span><span style="color:#a6e22e">entityManager</span><span style="color:#f92672">.</span><span style="color:#a6e22e">createQuery</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;select o from Action o&#34;</span><span style="color:#f92672">).</span><span style="color:#a6e22e">getResultList</span><span style="color:#f92672">();</span>
<span style="color:#f92672">}</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> org<span style="color:#f92672">.</span><span style="color:#a6e22e">academ</span><span style="color:#f92672">.</span><span style="color:#a6e22e">uthark</span><span style="color:#f92672">.</span><span style="color:#a6e22e">research</span><span style="color:#f92672">.</span><span style="color:#a6e22e">roo</span><span style="color:#f92672">.</span><span style="color:#a6e22e">domain</span><span style="color:#f92672">.</span><span style="color:#a6e22e">Action</span> Action<span style="color:#f92672">.</span><span style="color:#a6e22e">findAction</span><span style="color:#f92672">(</span>java<span style="color:#f92672">.</span><span style="color:#a6e22e">lang</span><span style="color:#f92672">.</span><span style="color:#a6e22e">Long</span> id<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
<span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>id <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> IllegalArgumentException<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;An identifier is required to retrieve an instance of Action&#34;</span><span style="color:#f92672">);</span>
<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> Action<span style="color:#f92672">().</span><span style="color:#a6e22e">entityManager</span><span style="color:#f92672">.</span><span style="color:#a6e22e">find</span><span style="color:#f92672">(</span>Action<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">,</span> id<span style="color:#f92672">);</span>
<span style="color:#f92672">}</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> java<span style="color:#f92672">.</span><span style="color:#a6e22e">util</span><span style="color:#f92672">.</span><span style="color:#a6e22e">List</span><span style="color:#f92672">&lt;</span>org<span style="color:#f92672">.</span><span style="color:#a6e22e">academ</span><span style="color:#f92672">.</span><span style="color:#a6e22e">uthark</span><span style="color:#f92672">.</span><span style="color:#a6e22e">research</span><span style="color:#f92672">.</span><span style="color:#a6e22e">roo</span><span style="color:#f92672">.</span><span style="color:#a6e22e">domain</span><span style="color:#f92672">.</span><span style="color:#a6e22e">action</span><span style="color:#f92672">&gt;</span> Action<span style="color:#f92672">.</span><span style="color:#a6e22e">findActionEntries</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> firstResult<span style="color:#f92672">,</span> <span style="color:#66d9ef">int</span> maxResults<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> Action<span style="color:#f92672">().</span><span style="color:#a6e22e">entityManager</span><span style="color:#f92672">.</span><span style="color:#a6e22e">createQuery</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;select o from Action o&#34;</span><span style="color:#f92672">).</span><span style="color:#a6e22e">setFirstResult</span><span style="color:#f92672">(</span>firstResult<span style="color:#f92672">).</span><span style="color:#a6e22e">setMaxResults</span><span style="color:#f92672">(</span>maxResults<span style="color:#f92672">).</span><span style="color:#a6e22e">getResultList</span><span style="color:#f92672">();</span>
<span style="color:#f92672">}</span>

<span style="color:#f92672">}</span></code></pre></div>
<p>Как легко видеть, этот аспект добавляет классу Action CRUD-методы, поля id и version.</p>

<ul>
<li><strong>Action_Roo_Finder.aj</strong>
Этот аспект аккумулирует все finder-методы, созданные через консоль Spring Roo.</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">privileged aspect Action_Roo_Finder <span style="color:#f92672">{</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> javax<span style="color:#f92672">.</span><span style="color:#a6e22e">persistence</span><span style="color:#f92672">.</span><span style="color:#a6e22e">Query</span> Action<span style="color:#f92672">.</span><span style="color:#a6e22e">findActionsByName</span><span style="color:#f92672">(</span>java<span style="color:#f92672">.</span><span style="color:#a6e22e">lang</span><span style="color:#f92672">.</span><span style="color:#a6e22e">String</span> name<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
<span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>name <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> IllegalArgumentException<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;The name argument is required&#34;</span><span style="color:#f92672">);</span>
javax<span style="color:#f92672">.</span><span style="color:#a6e22e">persistence</span><span style="color:#f92672">.</span><span style="color:#a6e22e">Query</span> q <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Action<span style="color:#f92672">().</span><span style="color:#a6e22e">entityManager</span><span style="color:#f92672">.</span><span style="color:#a6e22e">createQuery</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;FROM Action AS action WHERE action.name = :name&#34;</span><span style="color:#f92672">);</span>
q<span style="color:#f92672">.</span><span style="color:#a6e22e">setParameter</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;name&#34;</span><span style="color:#f92672">,</span> name<span style="color:#f92672">);</span>
<span style="color:#66d9ef">return</span> q<span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>

<span style="color:#f92672">}</span></code></pre></div>
<ul>
<li><strong>Action_Roo_JavaBean.aj</strong>
Для уменьшения загромождения кода ненужными методами для доступа к полям Spring Roo выносит их в отдельный аспект.</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">privileged aspect Action_Roo_JavaBean <span style="color:#f92672">{</span>

<span style="color:#66d9ef">public</span> java<span style="color:#f92672">.</span><span style="color:#a6e22e">lang</span><span style="color:#f92672">.</span><span style="color:#a6e22e">String</span> Action<span style="color:#f92672">.</span><span style="color:#a6e22e">getName</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">name</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> Action<span style="color:#f92672">.</span><span style="color:#a6e22e">setName</span><span style="color:#f92672">(</span>java<span style="color:#f92672">.</span><span style="color:#a6e22e">lang</span><span style="color:#f92672">.</span><span style="color:#a6e22e">String</span> name<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
<span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">name</span> <span style="color:#f92672">=</span> name<span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>

<span style="color:#66d9ef">public</span> java<span style="color:#f92672">.</span><span style="color:#a6e22e">lang</span><span style="color:#f92672">.</span><span style="color:#a6e22e">String</span> Action<span style="color:#f92672">.</span><span style="color:#a6e22e">getDescription</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">description</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> Action<span style="color:#f92672">.</span><span style="color:#a6e22e">setDescription</span><span style="color:#f92672">(</span>java<span style="color:#f92672">.</span><span style="color:#a6e22e">lang</span><span style="color:#f92672">.</span><span style="color:#a6e22e">String</span> description<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
<span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">description</span> <span style="color:#f92672">=</span> description<span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>

<span style="color:#f92672">}</span></code></pre></div>
<ul>
<li><strong>Action_Roo_Plural.aj</strong>
В данном аспекте можно определить, как созданная сущность выглядит во множественном числе.</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">package</span> org.academ.uthark.research.roo.domain<span style="color:#f92672">;</span>

privileged aspect Action_Roo_JavaBean <span style="color:#f92672">{</span>

<span style="color:#66d9ef">public</span> java<span style="color:#f92672">.</span><span style="color:#a6e22e">lang</span><span style="color:#f92672">.</span><span style="color:#a6e22e">String</span> Action<span style="color:#f92672">.</span><span style="color:#a6e22e">getName</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">name</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> Action<span style="color:#f92672">.</span><span style="color:#a6e22e">setName</span><span style="color:#f92672">(</span>java<span style="color:#f92672">.</span><span style="color:#a6e22e">lang</span><span style="color:#f92672">.</span><span style="color:#a6e22e">String</span> name<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
<span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">name</span> <span style="color:#f92672">=</span> name<span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>

<span style="color:#66d9ef">public</span> java<span style="color:#f92672">.</span><span style="color:#a6e22e">lang</span><span style="color:#f92672">.</span><span style="color:#a6e22e">String</span> Action<span style="color:#f92672">.</span><span style="color:#a6e22e">getDescription</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">description</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> Action<span style="color:#f92672">.</span><span style="color:#a6e22e">setDescription</span><span style="color:#f92672">(</span>java<span style="color:#f92672">.</span><span style="color:#a6e22e">lang</span><span style="color:#f92672">.</span><span style="color:#a6e22e">String</span> description<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
<span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">description</span> <span style="color:#f92672">=</span> description<span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>

<span style="color:#f92672">}</span></code></pre></div>
<ul>
<li><strong>Action_Roo_ToString.aj</strong>
Аспект, переопределяющий <code>toString()</code></li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">privileged aspect Action_Roo_ToString <span style="color:#f92672">{</span>

<span style="color:#66d9ef">public</span> java<span style="color:#f92672">.</span><span style="color:#a6e22e">lang</span><span style="color:#f92672">.</span><span style="color:#a6e22e">String</span> Action<span style="color:#f92672">.</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
StringBuilder sb <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> StringBuilder<span style="color:#f92672">();</span>
sb<span style="color:#f92672">.</span><span style="color:#a6e22e">append</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;id: &#34;</span><span style="color:#f92672">).</span><span style="color:#a6e22e">append</span><span style="color:#f92672">(</span>getId<span style="color:#f92672">()).</span><span style="color:#a6e22e">append</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;, &#34;</span><span style="color:#f92672">);</span>
sb<span style="color:#f92672">.</span><span style="color:#a6e22e">append</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;version: &#34;</span><span style="color:#f92672">).</span><span style="color:#a6e22e">append</span><span style="color:#f92672">(</span>getVersion<span style="color:#f92672">()).</span><span style="color:#a6e22e">append</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;, &#34;</span><span style="color:#f92672">);</span>
sb<span style="color:#f92672">.</span><span style="color:#a6e22e">append</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;name: &#34;</span><span style="color:#f92672">).</span><span style="color:#a6e22e">append</span><span style="color:#f92672">(</span>getName<span style="color:#f92672">()).</span><span style="color:#a6e22e">append</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;, &#34;</span><span style="color:#f92672">);</span>
sb<span style="color:#f92672">.</span><span style="color:#a6e22e">append</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;description: &#34;</span><span style="color:#f92672">).</span><span style="color:#a6e22e">append</span><span style="color:#f92672">(</span>getDescription<span style="color:#f92672">()).</span><span style="color:#a6e22e">append</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;, &#34;</span><span style="color:#f92672">);</span>
<span style="color:#66d9ef">return</span> sb<span style="color:#f92672">.</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">();</span>
<span style="color:#f92672">}</span>

<span style="color:#f92672">}</span></code></pre></div>
<ul>
<li><strong>ActionEditor.java</strong>
Кроме того, при создании контроллеров для работы дополнительно создается <code>ActionEditor</code></li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">import</span> org.springframework.roo.addon.property.editor.RooEditor<span style="color:#f92672">;</span>

<span style="color:#a6e22e">@RooEditor</span><span style="color:#f92672">(</span>providePropertyEditorFor <span style="color:#f92672">=</span> Action<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ActionEditor</span> <span style="color:#f92672">{</span>
<span style="color:#f92672">}</span></code></pre></div>
<ul>
<li><strong>ActionEditor_Roo_Editor.aj</strong>
Аспект с реализацией.</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">privileged aspect ActionEditor_Roo_Editor <span style="color:#f92672">{</span>

declare parents: ActionEditor <span style="color:#66d9ef">implements</span> java<span style="color:#f92672">.</span><span style="color:#a6e22e">beans</span><span style="color:#f92672">.</span><span style="color:#a6e22e">PropertyEditorSupport</span><span style="color:#f92672">;</span>

org<span style="color:#f92672">.</span><span style="color:#a6e22e">springframework</span><span style="color:#f92672">.</span><span style="color:#a6e22e">beans</span><span style="color:#f92672">.</span><span style="color:#a6e22e">SimpleTypeConverter</span> ActionEditor<span style="color:#f92672">.</span><span style="color:#a6e22e">typeConverter</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> org<span style="color:#f92672">.</span><span style="color:#a6e22e">springframework</span><span style="color:#f92672">.</span><span style="color:#a6e22e">beans</span><span style="color:#f92672">.</span><span style="color:#a6e22e">SimpleTypeConverter</span><span style="color:#f92672">();</span>

<span style="color:#66d9ef">public</span> java<span style="color:#f92672">.</span><span style="color:#a6e22e">lang</span><span style="color:#f92672">.</span><span style="color:#a6e22e">String</span> ActionEditor<span style="color:#f92672">.</span><span style="color:#a6e22e">getAsText</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
 Object obj <span style="color:#f92672">=</span> getValue<span style="color:#f92672">();</span> 
 <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>obj <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span> 
     <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>     
 <span style="color:#f92672">}</span> 
 <span style="color:#66d9ef">return</span> <span style="color:#f92672">(</span>String<span style="color:#f92672">)</span> typeConverter<span style="color:#f92672">.</span><span style="color:#a6e22e">convertIfNecessary</span><span style="color:#f92672">(((</span>org<span style="color:#f92672">.</span><span style="color:#a6e22e">academ</span><span style="color:#f92672">.</span><span style="color:#a6e22e">uthark</span><span style="color:#f92672">.</span><span style="color:#a6e22e">research</span><span style="color:#f92672">.</span><span style="color:#a6e22e">roo</span><span style="color:#f92672">.</span><span style="color:#a6e22e">domain</span><span style="color:#f92672">.</span><span style="color:#a6e22e">Action</span><span style="color:#f92672">)</span> obj<span style="color:#f92672">).</span><span style="color:#a6e22e">getId</span><span style="color:#f92672">()</span> <span style="color:#f92672">,</span> String<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">);</span> 
<span style="color:#f92672">}</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> ActionEditor<span style="color:#f92672">.</span><span style="color:#a6e22e">setAsText</span><span style="color:#f92672">(</span>java<span style="color:#f92672">.</span><span style="color:#a6e22e">lang</span><span style="color:#f92672">.</span><span style="color:#a6e22e">String</span> text<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
 <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>text <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">||</span> <span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">.</span><span style="color:#a6e22e">equals</span><span style="color:#f92672">(</span>text<span style="color:#f92672">))</span> <span style="color:#f92672">{</span> 
     setValue<span style="color:#f92672">(</span><span style="color:#66d9ef">null</span><span style="color:#f92672">);</span>     
     <span style="color:#66d9ef">return</span><span style="color:#f92672">;</span>     
 <span style="color:#f92672">}</span> 

 java<span style="color:#f92672">.</span><span style="color:#a6e22e">lang</span><span style="color:#f92672">.</span><span style="color:#a6e22e">Long</span> identifier <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>java<span style="color:#f92672">.</span><span style="color:#a6e22e">lang</span><span style="color:#f92672">.</span><span style="color:#a6e22e">Long</span><span style="color:#f92672">)</span> typeConverter<span style="color:#f92672">.</span><span style="color:#a6e22e">convertIfNecessary</span><span style="color:#f92672">(</span>text<span style="color:#f92672">,</span> java<span style="color:#f92672">.</span><span style="color:#a6e22e">lang</span><span style="color:#f92672">.</span><span style="color:#a6e22e">Long</span><span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">);</span> 
 <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>identifier <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span> 
     setValue<span style="color:#f92672">(</span><span style="color:#66d9ef">null</span><span style="color:#f92672">);</span>     
     <span style="color:#66d9ef">return</span><span style="color:#f92672">;</span>     
 <span style="color:#f92672">}</span> 

 setValue<span style="color:#f92672">(</span>org<span style="color:#f92672">.</span><span style="color:#a6e22e">academ</span><span style="color:#f92672">.</span><span style="color:#a6e22e">uthark</span><span style="color:#f92672">.</span><span style="color:#a6e22e">research</span><span style="color:#f92672">.</span><span style="color:#a6e22e">roo</span><span style="color:#f92672">.</span><span style="color:#a6e22e">domain</span><span style="color:#f92672">.</span><span style="color:#a6e22e">Action</span><span style="color:#f92672">.</span><span style="color:#a6e22e">findAction</span><span style="color:#f92672">(</span>identifier<span style="color:#f92672">));</span> 
<span style="color:#f92672">}</span>

<span style="color:#f92672">}</span></code></pre></div>
<h3 id="а-где-же-equals-hashcode">А где же equals()/hashCode()?</h3>

<p>Легко заметить, что Spring Roo забыл ещё про один важный аспект - про реализацию методов <code>equals()</code> и <code>hashCode()</code>. К релизу, я думаю, эта недоработка будет исправлена.</p>

<p>Как видно, код скрипта для генерации весьма и весьма лаконичен, а получающий java-код наглядно показывает всю многословность языка Java.</p>

<h3 id="apache-maven-integration">Apache Maven integration</h3>

<p>Spring Roo при создании проекта создаёт pom.xml, хорошо знакомый всем работавшим с maven. Кроме того, консоль позволяет добавлять и удалять зависимости, не правя файл вручную.</p>

<h3 id="расширения">Расширения</h3>

<p>Spring Roo поддерживает расширения, что ещё больше даёт возможностей. На сегодняшний день написано уже как минимум одно расширение - <a href="http://jira.springframework.org/browse/ROO-41">Sitemesh Addon</a>.</p>

<h3 id="критика">Критика</h3>

<p>В первую очередь критика относится к текущему релизу, а так как он ещё в глубокой альфе, то все может измениться к официальному релизу.</p>

<ol>
<li>Нет возможности подставлять свои JSP-шаблоны для сгенерированного CRUD</li>
<li>В сгенерированном коде есть ошибки, например, если заводим поле типа флоат, создаём контроллер, то при редактировании сущности возможна следующая ошибка: вводим достаточно большое число (1234567), сохраняем сущность, открываем на редактирование. В поле, хранящем флоат получаем 1.23456E7, и после этого невозможно сохранить сущность, так как получаем ошибку валидации.</li>
<li>Ещё одна ошибка связана с отношением один ко многим. Создаём пару сущностей с таким отношением. Запускаем, пробуем создать сущность. Roo умничает, если нет связанных сущностей в БД, то он даже не генерирует <code>&lt;select&gt;</code></li>
</ol>

<h3 id="вывод">Вывод</h3>

<p>В целом, Spring Roo достойное начинание, но пользоваться им в Production можно будет ещё нескоро.</p>

        

    </article>
    
    
    




<div class="pagination">

    
        
        
        
        <a href="/" aria-label="First" class="label-pagination"><i class="fa fa-angle-double-left fa-lg"></i></a>
    

    
    
        <a href="/page/20/" aria-label="Previous" class="label-pagination"><i class="fa fa-angle-left fa-lg"></i></a>
    

    
        <a href="/" class="label-pagination">1</a>
    
        <a href="/page/2/" class="label-pagination">2</a>
    
        <a href="/page/3/" class="label-pagination">3</a>
    
        <a href="/page/4/" class="label-pagination">4</a>
    
        <a href="/page/5/" class="label-pagination">5</a>
    
        <a href="/page/6/" class="label-pagination">6</a>
    
        <a href="/page/7/" class="label-pagination">7</a>
    
        <a href="/page/8/" class="label-pagination">8</a>
    
        <a href="/page/9/" class="label-pagination">9</a>
    
        <a href="/page/10/" class="label-pagination">10</a>
    
        <a href="/page/11/" class="label-pagination">11</a>
    
        <a href="/page/12/" class="label-pagination">12</a>
    
        <a href="/page/13/" class="label-pagination">13</a>
    
        <a href="/page/14/" class="label-pagination">14</a>
    
        <a href="/page/15/" class="label-pagination">15</a>
    
        <a href="/page/16/" class="label-pagination">16</a>
    
        <a href="/page/17/" class="label-pagination">17</a>
    
        <a href="/page/18/" class="label-pagination">18</a>
    
        <a href="/page/19/" class="label-pagination">19</a>
    
        <a href="/page/20/" class="label-pagination">20</a>
    
        <a href="/page/21/" class="label-pagination">21</a>
    
        <a href="/page/22/" class="label-pagination">22</a>
    
        <a href="/page/23/" class="label-pagination">23</a>
    
        <a href="/page/24/" class="label-pagination">24</a>
    

    
    
        <a href="/page/22/" aria-label="Next" class="label-pagination"><i class="fa fa-angle-right fa-lg"></i></a>
    

    
    
        <a href="/page/24/" aria-label="Last"><i class="fa fa-angle-double-right fa-lg"></i></a>
    

</div>

  

  </div>

  

<aside class="sidebar thirds">
  <section class="first odd">

    

    <p>
      
    </p>
  </section>





  

  

  
  
  

</aside>
    
 </div>
</div>

<footer role="contentinfo">
    
    <div class="center">
        <ul class="sidebar-nav">
            <li class="sidebar-nav-item">
                <a target="_blank" href="https://github.com/uthark/" title="https://github.com/uthark/"><i
                    class="fa fa-github fa-3x"></i></a></li>
            <li class="sidebar-nav-item">    <a target="_blank" href="https://bitbucket.org/uthark/" title="https://bitbucket.org/uthark/"><i
                    class="fa fa-bitbucket fa-3x"></i></a>
            <li class="sidebar-nav-item">
            <li class="sidebar-nav-item"><a target="_blank" href="https://twitter.com/LinkageError/" title="https://twitter.com/LinkageError/"><i
                    class="fa fa-twitter fa-3x"></i></a>
            <li class="sidebar-nav-item"><a target="_blank" href="https://keybase.io/uthark/" title="https://keybase.io/uthark/"><i
                    class="fa fa-key fa-3x"></i></a> 
            <li class="sidebar-nav-item">
            <li class="sidebar-nav-item"><a target="_blank" href="http://stackoverflow.com/users/216764/uthark" title="http://stackoverflow.com/users/216764/uthark"><i
                    class="fa fa-stack-overflow fa-3x"></i></a>
            <li class="sidebar-nav-item"><a target="_blank" href="https://plus.google.com/&#43;OlegAtamanenko" title="https://plus.google.com/&#43;OlegAtamanenko"><i
                    class="fa fa-google-plus fa-3x"></i></a>
            <li class="sidebar-nav-item">
            <li class="sidebar-nav-item">
            <li class="sidebar-nav-item">
                
                
            </li>
        </ul>
    </div>
    <p>Copyright &copy; 2017 Oleg Atamanenko - <a href="https://uthark.github.io/license/">License</a> -
        <span class="credit">Powered by <a target="_blank" href="https://gohugo.io">Hugo</a> and
            <a target="_blank" href="https://github.com/parsiya/hugo-octopress/">Hugo-Octopress</a> theme.
    </p>

</footer>


</body>
</html>
   
