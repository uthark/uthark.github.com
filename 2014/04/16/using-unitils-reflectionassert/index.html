<!doctype html><html>
<head>
<meta charset=utf-8>
<title>
Using Unitils ReflectionAssert &ndash; Oleg Atamanenko
</title>
<meta name=HandheldFriendly content="True">
<meta name=MobileOptimized content="320">
<meta name=theme-color content="#333" media="(prefers-color-scheme: dark)">
<meta name=theme-color content="#777" media="(prefers-color-scheme: light)">
<meta name=viewport content="width=device-width,minimum-scale=1,maximum-scale=1">
<link rel=stylesheet media=screen href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@300&family=Prata&display=swap" type=text/css>
<link rel=stylesheet href=https://uthark.github.io/css/theme.72254bdf9ec9fc2d8b013dd5c21997b2ab476af1a37ded5995aae71c4a63d57d.css>
<link rel=stylesheet href=//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css>
<link href=https://uthark.github.io/favicon.png rel=icon>
</head>
<body>
<header class=site>
<h1><a href=https://uthark.github.io/>Oleg Atamanenko</a></h1>
<h2>thoughts about programming</h2>
</header>
<nav>
<ul class=main-navigation>
<li><a href=https://uthark.github.io/ title=Posts>Posts</a></li>
<li><a href=https://uthark.github.io/categories/ title=Categories>Categories</a></li>
<li><a href=https://uthark.github.io/usefularticles/ title=Links>Links</a></li>
<li><a href=https://uthark.github.io/about/ title="About me">About me</a></li>
</ul>
</nav>
<div class=article>
<h1>Using Unitils ReflectionAssert</h1>
<p>Often it is needed to compare two different instances of the class inside test. I.e. we save object into database, then fetch it back from db and we want to be sure if nothing was lost during saving/reading.</p>
<p>In order to make such assertions more easier and maintainable one can use great Unitils library which has useful class <a href=http://www.unitils.org/tutorial-reflectionassert.html>ReflectionAssert</a></p>
<p>First, update parent&rsquo;s <code>pom.xml</code>:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=nt>&lt;properties&gt;</span>
    <span class=nt>&lt;unitils.version&gt;</span>3.4<span class=nt>&lt;/unitils.version&gt;</span>
<span class=nt>&lt;/properties&gt;</span>
<span class=nt>&lt;dependency&gt;</span>
    <span class=nt>&lt;groupId&gt;</span>org.unitils<span class=nt>&lt;/groupId&gt;</span>
    <span class=nt>&lt;artifactId&gt;</span>unitils-core<span class=nt>&lt;/artifactId&gt;</span>
    <span class=nt>&lt;version&gt;</span>${unitils.version}<span class=nt>&lt;/version&gt;</span>
    <span class=nt>&lt;scope&gt;</span>test<span class=nt>&lt;/scope&gt;</span>
<span class=nt>&lt;/dependency&gt;</span>
</code></pre></div><p>Then add dependency to the child module:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=nt>&lt;dependency&gt;</span>
    <span class=nt>&lt;groupId&gt;</span>org.unitils<span class=nt>&lt;/groupId&gt;</span>
    <span class=nt>&lt;artifactId&gt;</span>unitils-core<span class=nt>&lt;/artifactId&gt;</span>
<span class=nt>&lt;/dependency&gt;</span>
</code></pre></div><p>Usage is very simple:
Add static import to the class.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=kn>import static</span> <span class=nn>org.unitils.reflectionassert.ReflectionAssert.assertReflectionEquals</span><span class=o>;</span>
</code></pre></div><p>and use it instead of regular JUnit assert:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=n>assertReflectionEquals</span><span class=o>(</span><span class=n>expected</span><span class=o>,</span> <span class=n>actual</span><span class=o>);</span>
</code></pre></div><p>It is possible to pass reflection comparator modes as optional parameters to the above method.</p>
<p>Be ware that this method is not very useful if you want to compare objects which has floating point or double parameters - ReflectionAssert compares <code>double</code> and <code>float</code> values using <code>==</code>, so it is not very useful. It is not possible to pass epsilon for comparison.</p>
<p>excerpt from <code>org.unitils.reflectionassert.comparator.impl.LenientNumberComparator#compare</code>:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=n>Double</span> <span class=n>leftDouble</span> <span class=o>=</span> <span class=n>getDoubleValue</span><span class=o>(</span><span class=n>left</span><span class=o>);</span>
<span class=n>Double</span> <span class=n>rightDouble</span> <span class=o>=</span> <span class=n>getDoubleValue</span><span class=o>(</span><span class=n>right</span><span class=o>);</span>
<span class=k>if</span> <span class=o>(!</span><span class=n>leftDouble</span><span class=o>.</span><span class=na>equals</span><span class=o>(</span><span class=n>rightDouble</span><span class=o>))</span> <span class=o>{</span>
    <span class=k>return</span> <span class=k>new</span> <span class=n>Difference</span><span class=o>(</span><span class=n>differenceMessage</span><span class=o>,</span> <span class=n>left</span><span class=o>,</span> <span class=n>right</span><span class=o>);</span>
<span class=o>}</span>
</code></pre></div><p>If you need to compare double values in JUnit assertions then it is better to use <a href=https://code.google.com/p/hamcrest/>hamcrest library</a>.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=kn>import static</span> <span class=nn>org.hamcrest.number.IsCloseTo.closeTo</span><span class=o>;</span>
<span class=kn>import static</span> <span class=nn>org.junit.Assert.assertThat</span><span class=o>;</span>

<span class=c1>// in @Test method:
</span><span class=c1></span><span class=n>assertThat</span><span class=o>(</span><span class=n>actual</span><span class=o>.</span><span class=na>getFederalIncomeTax</span><span class=o>(),</span> <span class=n>closeTo</span><span class=o>(</span><span class=n>expected</span><span class=o>.</span><span class=na>getFederalIncomeTax</span><span class=o>(),</span> <span class=n>EPSILON</span><span class=o>))</span>
</code></pre></div><p>Happy hacking!</p>
</div>
<footer>
<div class=social>
<ul>
<li class=sidebar-nav-item><a target=_blank href=https://github.com/uthark/ title=https://github.com/uthark/><i class="fa fa-github fa-2x"></i></a>
</li>
<li class=sidebar-nav-item> <a target=_blank href=https://bitbucket.org/uthark/ title=https://bitbucket.org/uthark/><i class="fa fa-bitbucket fa-2x"></i></a>
<li class=sidebar-nav-item><a target=_blank href=https://twitter.com/real_atamanenko title=https://twitter.com/real_atamanenko><i class="fa fa-twitter fa-2x"></i></a>
<li class=sidebar-nav-item><a target=_blank href=https://keybase.io/uthark/ title=https://keybase.io/uthark/><i class="fa fa-key fa-2x"></i></a>
<li class=sidebar-nav-item><a target=_blank href=http://stackoverflow.com/users/216764/uthark title=http://stackoverflow.com/users/216764/uthark><i class="fa fa-stack-overflow fa-2x"></i></a>
</li>
<li><a href=https://feeds.feedburner.com/atamanenko target=_blank type=application/rss+xml title=RSS><i class="fa fa-rss-square fa-2x"></i></a></li>
</ul>
</div>
<p>&copy;&nbsp;2009&nbsp;â€”&nbsp;2021 Oleg Atamanenko - <a href=https://uthark.github.io/license/>CC&nbsp;BY-SA&nbsp;4.0</a>
</p>
</footer>
<script>var _gaq=[['_setAccount','UA-8688665-1'],['_trackPageview']];(function(b,c){var d=b.createElement(c),a=b.getElementsByTagName(c)[0];a.async='async',d.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js',a.parentNode.insertBefore(d,a)})(document,'script')</script>
</body>
</html>
</body>
</html>