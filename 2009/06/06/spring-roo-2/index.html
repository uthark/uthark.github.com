<!doctype html><html>
<head>
<meta charset=utf-8>
<title>
Spring Roo (часть 2) &ndash; Oleg Atamanenko
</title>
<meta name=HandheldFriendly content="True">
<meta name=MobileOptimized content="320">
<meta name=theme-color content="#333" media="(prefers-color-scheme: dark)">
<meta name=theme-color content="#777" media="(prefers-color-scheme: light)">
<meta name=viewport content="width=device-width,minimum-scale=1,maximum-scale=1">
<link rel=stylesheet media=screen href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@300&family=Prata&display=swap" type=text/css>
<link rel=stylesheet href=https://uthark.github.io/css/theme.72254bdf9ec9fc2d8b013dd5c21997b2ab476af1a37ded5995aae71c4a63d57d.css>
<link rel=stylesheet href=//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css>
<link href=https://uthark.github.io/favicon.png rel=icon>
</head>
<body>
<header class=site>
<h1><a href=https://uthark.github.io/>Oleg Atamanenko</a></h1>
<h2>thoughts about programming</h2>
</header>
<nav>
<ul class=main-navigation>
<li><a href=https://uthark.github.io/ title=Posts>Posts</a></li>
<li><a href=https://uthark.github.io/categories/ title=Categories>Categories</a></li>
<li><a href=https://uthark.github.io/usefularticles/ title=Links>Links</a></li>
<li><a href=https://uthark.github.io/about/ title="About me">About me</a></li>
</ul>
</nav>
<div class=article>
<h1>Spring Roo (часть 2)</h1>
<h1>Архитектура сгенерированного приложения</h1>
Spring Roo активно использует аспекты. В качестве реализации аспектов была взята библиотека <a href=http://www.eclipse.org/aspectj/>aspectj</a>.
Большая часть сгенерированного кода попадает в отдельные файлы-аспекты.
Создадим простой класс:
```bash
new persistent class jpa -name ~.domain.Action -testAutomatically
add field string name -notNull -sizeMin 1 -sizeMax 80
add field string description -sizeMax 1024
```
Spring Roo создаст нам следующие файлы:
<ul>
<li><strong>Action.java</strong>
Класс содержит только полезную с точки зрения назначения класса информацию. По сути, то, что вводит разработчик в консоль Roo аккумулируется здесь. Весь дополнительный код разносится по другим классам.</li>
</ul>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=nd>@Entity</span> <span class=c1>//1
</span><span class=c1></span><span class=nd>@RooJavaBean</span> <span class=c1>//2
</span><span class=c1></span><span class=nd>@RooToString</span> <span class=c1>//3
</span><span class=c1></span><span class=nd>@RooEntity</span><span class=o>(</span><span class=n>finders</span> <span class=o>=</span> <span class=o>{</span> <span class=s>&#34;findActionsByName&#34;</span> <span class=o>})</span> <span class=c1>//4
</span><span class=c1></span><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Action</span> <span class=o>{</span>

<span class=nd>@NotNull</span>
<span class=nd>@Size</span><span class=o>(</span><span class=n>min</span> <span class=o>=</span> <span class=n>1</span><span class=o>,</span> <span class=n>max</span> <span class=o>=</span> <span class=n>80</span><span class=o>)</span>
<span class=kd>private</span> <span class=n>String</span> <span class=n>name</span><span class=o>;</span>


<span class=nd>@Size</span><span class=o>(</span><span class=n>max</span> <span class=o>=</span> <span class=n>1024</span><span class=o>)</span>
<span class=kd>private</span> <span class=n>String</span> <span class=n>description</span><span class=o>;</span>
<span class=o>}</span>
</code></pre></div><p>Мы видим, что:</p>
<ol>
<li>Класс является JPA-сущностью.</li>
<li>Аннотация <code>@RooJavaBean</code> говорит, что этот класс - обычный Java-бин.</li>
<li>Аннотация <code>@RooToString</code> говорит, что у этого класса есть перегруженный метод toString().</li>
<li>Аннотация <code>@RooEntity</code> говорит что класс является JPA-сущностью.</li>
</ol>
<ul>
<li><strong>Action_Roo_Configurable.aj</strong>
Данный аспект говорит, что класс Action является конфигурируемым через Spring.</li>
</ul>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=n>privileged</span> <span class=n>aspect</span> <span class=n>Action_Roo_Configurable</span> <span class=o>{</span>
<span class=n>declare</span> <span class=nd>@type</span><span class=o>:</span> <span class=n>Action</span><span class=o>:</span> <span class=nd>@org.springframework.beans.factory.annotation.Configurable</span><span class=o>;</span>
<span class=o>}</span>
</code></pre></div><ul>
<li><strong>Action_Roo_Entity.aj</strong>
В данном классе собраны все методы DAO для работы с классом Action.</li>
</ul>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=kn>package</span> <span class=nn>org.academ.uthark.research.roo.domain</span><span class=o>;</span>

<span class=n>privileged</span> <span class=n>aspect</span> <span class=n>Action_Roo_Entity</span> <span class=o>{</span>

<span class=nd>@javax.persistence.PersistenceContext</span>
<span class=kd>transient</span> <span class=n>javax</span><span class=o>.</span><span class=na>persistence</span><span class=o>.</span><span class=na>EntityManager</span> <span class=n>Action</span><span class=o>.</span><span class=na>entityManager</span><span class=o>;</span>

<span class=nd>@javax.persistence.Id</span>
<span class=nd>@javax.persistence.GeneratedValue</span><span class=o>(</span><span class=n>strategy</span> <span class=o>=</span> <span class=n>javax</span><span class=o>.</span><span class=na>persistence</span><span class=o>.</span><span class=na>GenerationType</span><span class=o>.</span><span class=na>AUTO</span><span class=o>)</span>
<span class=nd>@javax.persistence.Column</span><span class=o>(</span><span class=n>name</span> <span class=o>=</span> <span class=s>&#34;id&#34;</span><span class=o>)</span>
<span class=kd>private</span> <span class=n>java</span><span class=o>.</span><span class=na>lang</span><span class=o>.</span><span class=na>Long</span> <span class=n>Action</span><span class=o>.</span><span class=na>id</span><span class=o>;</span>

<span class=nd>@javax.persistence.Version</span>
<span class=nd>@javax.persistence.Column</span><span class=o>(</span><span class=n>name</span> <span class=o>=</span> <span class=s>&#34;version&#34;</span><span class=o>)</span>
<span class=kd>private</span> <span class=n>java</span><span class=o>.</span><span class=na>lang</span><span class=o>.</span><span class=na>Integer</span> <span class=n>Action</span><span class=o>.</span><span class=na>version</span><span class=o>;</span>

<span class=kd>public</span> <span class=n>java</span><span class=o>.</span><span class=na>lang</span><span class=o>.</span><span class=na>Long</span> <span class=n>Action</span><span class=o>.</span><span class=na>getId</span><span class=o>()</span> <span class=o>{</span>
<span class=k>return</span> <span class=k>this</span><span class=o>.</span><span class=na>id</span><span class=o>;</span>
<span class=o>}</span>

<span class=kd>public</span> <span class=kt>void</span> <span class=n>Action</span><span class=o>.</span><span class=na>setId</span><span class=o>(</span><span class=n>java</span><span class=o>.</span><span class=na>lang</span><span class=o>.</span><span class=na>Long</span> <span class=n>id</span><span class=o>)</span> <span class=o>{</span>
<span class=k>this</span><span class=o>.</span><span class=na>id</span> <span class=o>=</span> <span class=n>id</span><span class=o>;</span>
<span class=o>}</span>

<span class=kd>public</span> <span class=n>java</span><span class=o>.</span><span class=na>lang</span><span class=o>.</span><span class=na>Integer</span> <span class=n>Action</span><span class=o>.</span><span class=na>getVersion</span><span class=o>()</span> <span class=o>{</span>
<span class=k>return</span> <span class=k>this</span><span class=o>.</span><span class=na>version</span><span class=o>;</span>
<span class=o>}</span>

<span class=kd>public</span> <span class=kt>void</span> <span class=n>Action</span><span class=o>.</span><span class=na>setVersion</span><span class=o>(</span><span class=n>java</span><span class=o>.</span><span class=na>lang</span><span class=o>.</span><span class=na>Integer</span> <span class=n>version</span><span class=o>)</span> <span class=o>{</span>
<span class=k>this</span><span class=o>.</span><span class=na>version</span> <span class=o>=</span> <span class=n>version</span><span class=o>;</span>
<span class=o>}</span>

<span class=nd>@org.springframework.transaction.annotation.Transactional</span>
<span class=kd>public</span> <span class=kt>void</span> <span class=n>Action</span><span class=o>.</span><span class=na>persist</span><span class=o>()</span> <span class=o>{</span>
<span class=k>if</span> <span class=o>(</span><span class=k>this</span><span class=o>.</span><span class=na>entityManager</span> <span class=o>==</span> <span class=kc>null</span><span class=o>)</span> <span class=k>throw</span> <span class=k>new</span> <span class=n>IllegalStateException</span><span class=o>(</span><span class=s>&#34;Entity manager has not been injected (is the Spring Aspects JAR configured as an AJC/AJDT aspects library?)&#34;</span><span class=o>);</span>
<span class=k>this</span><span class=o>.</span><span class=na>entityManager</span><span class=o>.</span><span class=na>persist</span><span class=o>(</span><span class=k>this</span><span class=o>);</span>
<span class=o>}</span>

<span class=nd>@org.springframework.transaction.annotation.Transactional</span>
<span class=kd>public</span> <span class=kt>void</span> <span class=n>Action</span><span class=o>.</span><span class=na>remove</span><span class=o>()</span> <span class=o>{</span>
<span class=k>if</span> <span class=o>(</span><span class=k>this</span><span class=o>.</span><span class=na>entityManager</span> <span class=o>==</span> <span class=kc>null</span><span class=o>)</span> <span class=k>throw</span> <span class=k>new</span> <span class=n>IllegalStateException</span><span class=o>(</span><span class=s>&#34;Entity manager has not been injected (is the Spring Aspects JAR configured as an AJC/AJDT aspects library?)&#34;</span><span class=o>);</span>
<span class=k>this</span><span class=o>.</span><span class=na>entityManager</span><span class=o>.</span><span class=na>remove</span><span class=o>(</span><span class=k>this</span><span class=o>);</span>
<span class=o>}</span>

<span class=nd>@org.springframework.transaction.annotation.Transactional</span>
<span class=kd>public</span> <span class=kt>void</span> <span class=n>Action</span><span class=o>.</span><span class=na>flush</span><span class=o>()</span> <span class=o>{</span>
<span class=k>if</span> <span class=o>(</span><span class=k>this</span><span class=o>.</span><span class=na>entityManager</span> <span class=o>==</span> <span class=kc>null</span><span class=o>)</span> <span class=k>throw</span> <span class=k>new</span> <span class=n>IllegalStateException</span><span class=o>(</span><span class=s>&#34;Entity manager has not been injected (is the Spring Aspects JAR configured as an AJC/AJDT aspects library?)&#34;</span><span class=o>);</span>
<span class=k>this</span><span class=o>.</span><span class=na>entityManager</span><span class=o>.</span><span class=na>flush</span><span class=o>();</span>
<span class=o>}</span>

<span class=nd>@org.springframework.transaction.annotation.Transactional</span>
<span class=kd>public</span> <span class=kt>void</span> <span class=n>Action</span><span class=o>.</span><span class=na>merge</span><span class=o>()</span> <span class=o>{</span>
<span class=k>if</span> <span class=o>(</span><span class=k>this</span><span class=o>.</span><span class=na>entityManager</span> <span class=o>==</span> <span class=kc>null</span><span class=o>)</span> <span class=k>throw</span> <span class=k>new</span> <span class=n>IllegalStateException</span><span class=o>(</span><span class=s>&#34;Entity manager has not been injected (is the Spring Aspects JAR configured as an AJC/AJDT aspects library?)&#34;</span><span class=o>);</span>
<span class=n>Action</span> <span class=n>merged</span> <span class=o>=</span> <span class=k>this</span><span class=o>.</span><span class=na>entityManager</span><span class=o>.</span><span class=na>merge</span><span class=o>(</span><span class=k>this</span><span class=o>);</span>
<span class=k>this</span><span class=o>.</span><span class=na>entityManager</span><span class=o>.</span><span class=na>flush</span><span class=o>();</span>
<span class=k>this</span><span class=o>.</span><span class=na>id</span> <span class=o>=</span> <span class=n>merged</span><span class=o>.</span><span class=na>getId</span><span class=o>();</span>
<span class=o>}</span>

<span class=kd>public</span> <span class=kd>static</span> <span class=kt>long</span> <span class=n>Action</span><span class=o>.</span><span class=na>countActions</span><span class=o>()</span> <span class=o>{</span>
<span class=k>return</span> <span class=o>(</span><span class=n>Long</span><span class=o>)</span> <span class=k>new</span> <span class=n>Action</span><span class=o>().</span><span class=na>entityManager</span><span class=o>.</span><span class=na>createQuery</span><span class=o>(</span><span class=s>&#34;select count(o) from Action o&#34;</span><span class=o>).</span><span class=na>getSingleResult</span><span class=o>();</span>
<span class=o>}</span>

<span class=kd>public</span> <span class=kd>static</span> <span class=n>java</span><span class=o>.</span><span class=na>util</span><span class=o>.</span><span class=na>List</span><span class=o>&lt;</span><span class=n>org</span><span class=o>.</span><span class=na>academ</span><span class=o>.</span><span class=na>uthark</span><span class=o>.</span><span class=na>research</span><span class=o>.</span><span class=na>roo</span><span class=o>.</span><span class=na>domain</span><span class=o>.</span><span class=na>action</span><span class=o>&gt;</span> <span class=n>Action</span><span class=o>.</span><span class=na>findAllActions</span><span class=o>()</span> <span class=o>{</span>
<span class=k>return</span> <span class=k>new</span> <span class=n>Action</span><span class=o>().</span><span class=na>entityManager</span><span class=o>.</span><span class=na>createQuery</span><span class=o>(</span><span class=s>&#34;select o from Action o&#34;</span><span class=o>).</span><span class=na>getResultList</span><span class=o>();</span>
<span class=o>}</span>

<span class=kd>public</span> <span class=kd>static</span> <span class=n>org</span><span class=o>.</span><span class=na>academ</span><span class=o>.</span><span class=na>uthark</span><span class=o>.</span><span class=na>research</span><span class=o>.</span><span class=na>roo</span><span class=o>.</span><span class=na>domain</span><span class=o>.</span><span class=na>Action</span> <span class=n>Action</span><span class=o>.</span><span class=na>findAction</span><span class=o>(</span><span class=n>java</span><span class=o>.</span><span class=na>lang</span><span class=o>.</span><span class=na>Long</span> <span class=n>id</span><span class=o>)</span> <span class=o>{</span>
<span class=k>if</span> <span class=o>(</span><span class=n>id</span> <span class=o>==</span> <span class=kc>null</span><span class=o>)</span> <span class=k>throw</span> <span class=k>new</span> <span class=n>IllegalArgumentException</span><span class=o>(</span><span class=s>&#34;An identifier is required to retrieve an instance of Action&#34;</span><span class=o>);</span>
<span class=k>return</span> <span class=k>new</span> <span class=n>Action</span><span class=o>().</span><span class=na>entityManager</span><span class=o>.</span><span class=na>find</span><span class=o>(</span><span class=n>Action</span><span class=o>.</span><span class=na>class</span><span class=o>,</span> <span class=n>id</span><span class=o>);</span>
<span class=o>}</span>

<span class=kd>public</span> <span class=kd>static</span> <span class=n>java</span><span class=o>.</span><span class=na>util</span><span class=o>.</span><span class=na>List</span><span class=o>&lt;</span><span class=n>org</span><span class=o>.</span><span class=na>academ</span><span class=o>.</span><span class=na>uthark</span><span class=o>.</span><span class=na>research</span><span class=o>.</span><span class=na>roo</span><span class=o>.</span><span class=na>domain</span><span class=o>.</span><span class=na>action</span><span class=o>&gt;</span> <span class=n>Action</span><span class=o>.</span><span class=na>findActionEntries</span><span class=o>(</span><span class=kt>int</span> <span class=n>firstResult</span><span class=o>,</span> <span class=kt>int</span> <span class=n>maxResults</span><span class=o>)</span> <span class=o>{</span>
<span class=k>return</span> <span class=k>new</span> <span class=n>Action</span><span class=o>().</span><span class=na>entityManager</span><span class=o>.</span><span class=na>createQuery</span><span class=o>(</span><span class=s>&#34;select o from Action o&#34;</span><span class=o>).</span><span class=na>setFirstResult</span><span class=o>(</span><span class=n>firstResult</span><span class=o>).</span><span class=na>setMaxResults</span><span class=o>(</span><span class=n>maxResults</span><span class=o>).</span><span class=na>getResultList</span><span class=o>();</span>
<span class=o>}</span>

<span class=o>}</span>
</code></pre></div><p>Как легко видеть, этот аспект добавляет классу Action CRUD-методы, поля id и version.</p>
<ul>
<li><strong>Action_Roo_Finder.aj</strong>
Этот аспект аккумулирует все finder-методы, созданные через консоль Spring Roo.</li>
</ul>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=n>privileged</span> <span class=n>aspect</span> <span class=n>Action_Roo_Finder</span> <span class=o>{</span>

<span class=kd>public</span> <span class=kd>static</span> <span class=n>javax</span><span class=o>.</span><span class=na>persistence</span><span class=o>.</span><span class=na>Query</span> <span class=n>Action</span><span class=o>.</span><span class=na>findActionsByName</span><span class=o>(</span><span class=n>java</span><span class=o>.</span><span class=na>lang</span><span class=o>.</span><span class=na>String</span> <span class=n>name</span><span class=o>)</span> <span class=o>{</span>
<span class=k>if</span> <span class=o>(</span><span class=n>name</span> <span class=o>==</span> <span class=kc>null</span><span class=o>)</span> <span class=k>throw</span> <span class=k>new</span> <span class=n>IllegalArgumentException</span><span class=o>(</span><span class=s>&#34;The name argument is required&#34;</span><span class=o>);</span>
<span class=n>javax</span><span class=o>.</span><span class=na>persistence</span><span class=o>.</span><span class=na>Query</span> <span class=n>q</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Action</span><span class=o>().</span><span class=na>entityManager</span><span class=o>.</span><span class=na>createQuery</span><span class=o>(</span><span class=s>&#34;FROM Action AS action WHERE action.name = :name&#34;</span><span class=o>);</span>
<span class=n>q</span><span class=o>.</span><span class=na>setParameter</span><span class=o>(</span><span class=s>&#34;name&#34;</span><span class=o>,</span> <span class=n>name</span><span class=o>);</span>
<span class=k>return</span> <span class=n>q</span><span class=o>;</span>
<span class=o>}</span>

<span class=o>}</span>
</code></pre></div><ul>
<li><strong>Action_Roo_JavaBean.aj</strong>
Для уменьшения загромождения кода ненужными методами для доступа к полям Spring Roo выносит их в отдельный аспект.</li>
</ul>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=n>privileged</span> <span class=n>aspect</span> <span class=n>Action_Roo_JavaBean</span> <span class=o>{</span>

<span class=kd>public</span> <span class=n>java</span><span class=o>.</span><span class=na>lang</span><span class=o>.</span><span class=na>String</span> <span class=n>Action</span><span class=o>.</span><span class=na>getName</span><span class=o>()</span> <span class=o>{</span>
<span class=k>return</span> <span class=k>this</span><span class=o>.</span><span class=na>name</span><span class=o>;</span>
<span class=o>}</span>

<span class=kd>public</span> <span class=kt>void</span> <span class=n>Action</span><span class=o>.</span><span class=na>setName</span><span class=o>(</span><span class=n>java</span><span class=o>.</span><span class=na>lang</span><span class=o>.</span><span class=na>String</span> <span class=n>name</span><span class=o>)</span> <span class=o>{</span>
<span class=k>this</span><span class=o>.</span><span class=na>name</span> <span class=o>=</span> <span class=n>name</span><span class=o>;</span>
<span class=o>}</span>

<span class=kd>public</span> <span class=n>java</span><span class=o>.</span><span class=na>lang</span><span class=o>.</span><span class=na>String</span> <span class=n>Action</span><span class=o>.</span><span class=na>getDescription</span><span class=o>()</span> <span class=o>{</span>
<span class=k>return</span> <span class=k>this</span><span class=o>.</span><span class=na>description</span><span class=o>;</span>
<span class=o>}</span>

<span class=kd>public</span> <span class=kt>void</span> <span class=n>Action</span><span class=o>.</span><span class=na>setDescription</span><span class=o>(</span><span class=n>java</span><span class=o>.</span><span class=na>lang</span><span class=o>.</span><span class=na>String</span> <span class=n>description</span><span class=o>)</span> <span class=o>{</span>
<span class=k>this</span><span class=o>.</span><span class=na>description</span> <span class=o>=</span> <span class=n>description</span><span class=o>;</span>
<span class=o>}</span>

<span class=o>}</span>
</code></pre></div><ul>
<li><strong>Action_Roo_Plural.aj</strong>
В данном аспекте можно определить, как созданная сущность выглядит во множественном числе.</li>
</ul>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=kn>package</span> <span class=nn>org.academ.uthark.research.roo.domain</span><span class=o>;</span>

<span class=n>privileged</span> <span class=n>aspect</span> <span class=n>Action_Roo_JavaBean</span> <span class=o>{</span>

<span class=kd>public</span> <span class=n>java</span><span class=o>.</span><span class=na>lang</span><span class=o>.</span><span class=na>String</span> <span class=n>Action</span><span class=o>.</span><span class=na>getName</span><span class=o>()</span> <span class=o>{</span>
<span class=k>return</span> <span class=k>this</span><span class=o>.</span><span class=na>name</span><span class=o>;</span>
<span class=o>}</span>

<span class=kd>public</span> <span class=kt>void</span> <span class=n>Action</span><span class=o>.</span><span class=na>setName</span><span class=o>(</span><span class=n>java</span><span class=o>.</span><span class=na>lang</span><span class=o>.</span><span class=na>String</span> <span class=n>name</span><span class=o>)</span> <span class=o>{</span>
<span class=k>this</span><span class=o>.</span><span class=na>name</span> <span class=o>=</span> <span class=n>name</span><span class=o>;</span>
<span class=o>}</span>

<span class=kd>public</span> <span class=n>java</span><span class=o>.</span><span class=na>lang</span><span class=o>.</span><span class=na>String</span> <span class=n>Action</span><span class=o>.</span><span class=na>getDescription</span><span class=o>()</span> <span class=o>{</span>
<span class=k>return</span> <span class=k>this</span><span class=o>.</span><span class=na>description</span><span class=o>;</span>
<span class=o>}</span>

<span class=kd>public</span> <span class=kt>void</span> <span class=n>Action</span><span class=o>.</span><span class=na>setDescription</span><span class=o>(</span><span class=n>java</span><span class=o>.</span><span class=na>lang</span><span class=o>.</span><span class=na>String</span> <span class=n>description</span><span class=o>)</span> <span class=o>{</span>
<span class=k>this</span><span class=o>.</span><span class=na>description</span> <span class=o>=</span> <span class=n>description</span><span class=o>;</span>
<span class=o>}</span>

<span class=o>}</span>
</code></pre></div><ul>
<li><strong>Action_Roo_ToString.aj</strong>
Аспект, переопределяющий <code>toString()</code></li>
</ul>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=n>privileged</span> <span class=n>aspect</span> <span class=n>Action_Roo_ToString</span> <span class=o>{</span>

<span class=kd>public</span> <span class=n>java</span><span class=o>.</span><span class=na>lang</span><span class=o>.</span><span class=na>String</span> <span class=n>Action</span><span class=o>.</span><span class=na>toString</span><span class=o>()</span> <span class=o>{</span>
<span class=n>StringBuilder</span> <span class=n>sb</span> <span class=o>=</span> <span class=k>new</span> <span class=n>StringBuilder</span><span class=o>();</span>
<span class=n>sb</span><span class=o>.</span><span class=na>append</span><span class=o>(</span><span class=s>&#34;id: &#34;</span><span class=o>).</span><span class=na>append</span><span class=o>(</span><span class=n>getId</span><span class=o>()).</span><span class=na>append</span><span class=o>(</span><span class=s>&#34;, &#34;</span><span class=o>);</span>
<span class=n>sb</span><span class=o>.</span><span class=na>append</span><span class=o>(</span><span class=s>&#34;version: &#34;</span><span class=o>).</span><span class=na>append</span><span class=o>(</span><span class=n>getVersion</span><span class=o>()).</span><span class=na>append</span><span class=o>(</span><span class=s>&#34;, &#34;</span><span class=o>);</span>
<span class=n>sb</span><span class=o>.</span><span class=na>append</span><span class=o>(</span><span class=s>&#34;name: &#34;</span><span class=o>).</span><span class=na>append</span><span class=o>(</span><span class=n>getName</span><span class=o>()).</span><span class=na>append</span><span class=o>(</span><span class=s>&#34;, &#34;</span><span class=o>);</span>
<span class=n>sb</span><span class=o>.</span><span class=na>append</span><span class=o>(</span><span class=s>&#34;description: &#34;</span><span class=o>).</span><span class=na>append</span><span class=o>(</span><span class=n>getDescription</span><span class=o>()).</span><span class=na>append</span><span class=o>(</span><span class=s>&#34;, &#34;</span><span class=o>);</span>
<span class=k>return</span> <span class=n>sb</span><span class=o>.</span><span class=na>toString</span><span class=o>();</span>
<span class=o>}</span>

<span class=o>}</span>
</code></pre></div><ul>
<li><strong>ActionEditor.java</strong>
Кроме того, при создании контроллеров для работы дополнительно создается <code>ActionEditor</code></li>
</ul>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=kn>import</span> <span class=nn>org.springframework.roo.addon.property.editor.RooEditor</span><span class=o>;</span>

<span class=nd>@RooEditor</span><span class=o>(</span><span class=n>providePropertyEditorFor</span> <span class=o>=</span> <span class=n>Action</span><span class=o>.</span><span class=na>class</span><span class=o>)</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>ActionEditor</span> <span class=o>{</span>
<span class=o>}</span>
</code></pre></div><ul>
<li><strong>ActionEditor_Roo_Editor.aj</strong>
Аспект с реализацией.</li>
</ul>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=n>privileged</span> <span class=n>aspect</span> <span class=n>ActionEditor_Roo_Editor</span> <span class=o>{</span>

<span class=n>declare</span> <span class=n>parents</span><span class=o>:</span> <span class=n>ActionEditor</span> <span class=kd>implements</span> <span class=n>java</span><span class=o>.</span><span class=na>beans</span><span class=o>.</span><span class=na>PropertyEditorSupport</span><span class=o>;</span>

<span class=n>org</span><span class=o>.</span><span class=na>springframework</span><span class=o>.</span><span class=na>beans</span><span class=o>.</span><span class=na>SimpleTypeConverter</span> <span class=n>ActionEditor</span><span class=o>.</span><span class=na>typeConverter</span> <span class=o>=</span> <span class=k>new</span> <span class=n>org</span><span class=o>.</span><span class=na>springframework</span><span class=o>.</span><span class=na>beans</span><span class=o>.</span><span class=na>SimpleTypeConverter</span><span class=o>();</span>

<span class=kd>public</span> <span class=n>java</span><span class=o>.</span><span class=na>lang</span><span class=o>.</span><span class=na>String</span> <span class=n>ActionEditor</span><span class=o>.</span><span class=na>getAsText</span><span class=o>()</span> <span class=o>{</span>
 <span class=n>Object</span> <span class=n>obj</span> <span class=o>=</span> <span class=n>getValue</span><span class=o>();</span> 
 <span class=k>if</span> <span class=o>(</span><span class=n>obj</span> <span class=o>==</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span> 
     <span class=k>return</span> <span class=kc>null</span><span class=o>;</span>     
 <span class=o>}</span> 
 <span class=k>return</span> <span class=o>(</span><span class=n>String</span><span class=o>)</span> <span class=n>typeConverter</span><span class=o>.</span><span class=na>convertIfNecessary</span><span class=o>(((</span><span class=n>org</span><span class=o>.</span><span class=na>academ</span><span class=o>.</span><span class=na>uthark</span><span class=o>.</span><span class=na>research</span><span class=o>.</span><span class=na>roo</span><span class=o>.</span><span class=na>domain</span><span class=o>.</span><span class=na>Action</span><span class=o>)</span> <span class=n>obj</span><span class=o>).</span><span class=na>getId</span><span class=o>()</span> <span class=o>,</span> <span class=n>String</span><span class=o>.</span><span class=na>class</span><span class=o>);</span> 
<span class=o>}</span>

<span class=kd>public</span> <span class=kt>void</span> <span class=n>ActionEditor</span><span class=o>.</span><span class=na>setAsText</span><span class=o>(</span><span class=n>java</span><span class=o>.</span><span class=na>lang</span><span class=o>.</span><span class=na>String</span> <span class=n>text</span><span class=o>)</span> <span class=o>{</span>
 <span class=k>if</span> <span class=o>(</span><span class=n>text</span> <span class=o>==</span> <span class=kc>null</span> <span class=o>||</span> <span class=s>&#34;&#34;</span><span class=o>.</span><span class=na>equals</span><span class=o>(</span><span class=n>text</span><span class=o>))</span> <span class=o>{</span> 
     <span class=n>setValue</span><span class=o>(</span><span class=kc>null</span><span class=o>);</span>     
     <span class=k>return</span><span class=o>;</span>     
 <span class=o>}</span> 

 <span class=n>java</span><span class=o>.</span><span class=na>lang</span><span class=o>.</span><span class=na>Long</span> <span class=n>identifier</span> <span class=o>=</span> <span class=o>(</span><span class=n>java</span><span class=o>.</span><span class=na>lang</span><span class=o>.</span><span class=na>Long</span><span class=o>)</span> <span class=n>typeConverter</span><span class=o>.</span><span class=na>convertIfNecessary</span><span class=o>(</span><span class=n>text</span><span class=o>,</span> <span class=n>java</span><span class=o>.</span><span class=na>lang</span><span class=o>.</span><span class=na>Long</span><span class=o>.</span><span class=na>class</span><span class=o>);</span> 
 <span class=k>if</span> <span class=o>(</span><span class=n>identifier</span> <span class=o>==</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span> 
     <span class=n>setValue</span><span class=o>(</span><span class=kc>null</span><span class=o>);</span>     
     <span class=k>return</span><span class=o>;</span>     
 <span class=o>}</span> 

 <span class=n>setValue</span><span class=o>(</span><span class=n>org</span><span class=o>.</span><span class=na>academ</span><span class=o>.</span><span class=na>uthark</span><span class=o>.</span><span class=na>research</span><span class=o>.</span><span class=na>roo</span><span class=o>.</span><span class=na>domain</span><span class=o>.</span><span class=na>Action</span><span class=o>.</span><span class=na>findAction</span><span class=o>(</span><span class=n>identifier</span><span class=o>));</span> 
<span class=o>}</span>

<span class=o>}</span>

</code></pre></div><h3 id=а-где-же-equalshashcode>А где же equals()/hashCode()?</h3>
<p>Легко заметить, что Spring Roo забыл ещё про один важный аспект - про реализацию методов <code>equals()</code> и <code>hashCode()</code>. К релизу, я думаю, эта недоработка будет исправлена.</p>
<p>Как видно, код скрипта для генерации весьма и весьма лаконичен, а получающий java-код наглядно показывает всю многословность языка Java.</p>
<h3 id=apache-maven-integration>Apache Maven integration</h3>
<p>Spring Roo при создании проекта создаёт pom.xml, хорошо знакомый всем работавшим с maven. Кроме того, консоль позволяет добавлять и удалять зависимости, не правя файл вручную.</p>
<h3 id=расширения>Расширения</h3>
<p>Spring Roo поддерживает расширения, что ещё больше даёт возможностей. На сегодняшний день написано уже как минимум одно расширение - <a href=http://jira.springframework.org/browse/ROO-41>Sitemesh Addon</a>.</p>
<h3 id=критика>Критика</h3>
<p>В первую очередь критика относится к текущему релизу, а так как он ещё в глубокой альфе, то все может измениться к официальному релизу.</p>
<ol>
<li>Нет возможности подставлять свои JSP-шаблоны для сгенерированного CRUD</li>
<li>В сгенерированном коде есть ошибки, например, если заводим поле типа флоат, создаём контроллер, то при редактировании сущности возможна следующая ошибка: вводим достаточно большое число (1234567), сохраняем сущность, открываем на редактирование. В поле, хранящем флоат получаем 1.23456E7, и после этого невозможно сохранить сущность, так как получаем ошибку валидации.</li>
<li>Ещё одна ошибка связана с отношением один ко многим. Создаём пару сущностей с таким отношением. Запускаем, пробуем создать сущность. Roo умничает, если нет связанных сущностей в БД, то он даже не генерирует <code>&lt;select></code></li>
</ol>
<h3 id=вывод>Вывод</h3>
<p>В целом, Spring Roo достойное начинание, но пользоваться им в Production можно будет ещё нескоро.</p>
</div>
<footer>
<div class=social>
<ul>
<li class=sidebar-nav-item><a target=_blank href=https://github.com/uthark/ title=https://github.com/uthark/><i class="fa fa-github fa-2x"></i></a>
</li>
<li class=sidebar-nav-item> <a target=_blank href=https://bitbucket.org/uthark/ title=https://bitbucket.org/uthark/><i class="fa fa-bitbucket fa-2x"></i></a>
<li class=sidebar-nav-item><a target=_blank href=https://twitter.com/real_atamanenko title=https://twitter.com/real_atamanenko><i class="fa fa-twitter fa-2x"></i></a>
<li class=sidebar-nav-item><a target=_blank href=https://keybase.io/uthark/ title=https://keybase.io/uthark/><i class="fa fa-key fa-2x"></i></a>
<li class=sidebar-nav-item><a target=_blank href=http://stackoverflow.com/users/216764/uthark title=http://stackoverflow.com/users/216764/uthark><i class="fa fa-stack-overflow fa-2x"></i></a>
</li>
<li><a href=https://feeds.feedburner.com/atamanenko target=_blank type=application/rss+xml title=RSS><i class="fa fa-rss-square fa-2x"></i></a></li>
</ul>
</div>
<p>&copy;&nbsp;2009&nbsp;—&nbsp;2021 Oleg Atamanenko - <a href=https://uthark.github.io/license/>CC&nbsp;BY-SA&nbsp;4.0</a>
</p>
</footer>
<script>var _gaq=[['_setAccount','UA-8688665-1'],['_trackPageview']];(function(b,c){var d=b.createElement(c),a=b.getElementsByTagName(c)[0];a.async='async',d.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js',a.parentNode.insertBefore(d,a)})(document,'script')</script>
</body>
</html>
</body>
</html>