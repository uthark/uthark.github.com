<!doctype html><html>
<head>
<meta charset=utf-8>
<title>
Транзакции в реляционных базах данных &ndash; Oleg Atamanenko
</title>
<meta name=HandheldFriendly content="True">
<meta name=MobileOptimized content="320">
<meta name=theme-color content="#333" media="(prefers-color-scheme: dark)">
<meta name=theme-color content="#777" media="(prefers-color-scheme: light)">
<meta name=viewport content="width=device-width,minimum-scale=1,maximum-scale=1">
<link rel=stylesheet media=screen href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@300&family=Prata&display=swap" type=text/css>
<link rel=stylesheet href=https://uthark.github.io/css/theme.72254bdf9ec9fc2d8b013dd5c21997b2ab476af1a37ded5995aae71c4a63d57d.css>
<link rel=stylesheet href=//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css>
<link href=https://uthark.github.io/favicon.png rel=icon>
</head>
<body>
<header class=site>
<h1><a href=https://uthark.github.io/>Oleg Atamanenko</a></h1>
<h2>thoughts about programming</h2>
</header>
<nav>
<ul class=main-navigation>
<li><a href=https://uthark.github.io/ title=Posts>Posts</a></li>
<li><a href=https://uthark.github.io/categories/ title=Categories>Categories</a></li>
<li><a href=https://uthark.github.io/usefularticles/ title=Links>Links</a></li>
<li><a href=https://uthark.github.io/about/ title="About me">About me</a></li>
</ul>
</nav>
<div class=article>
<h1>Транзакции в реляционных базах данных</h1>
<p>При работе в многопользовательском окружении может возникнуть ситуация, когда разные пользователи или системы обновляют одни и те же данные. Это может привести к ситуации, когда один из пользователей изменит данные, которые уже изменял другой пользователь и приведёт либо к потере данных, либо к переводу данных в неконсистентное состояние.
Для решения этой проблемы были придуманы транзакции. Целью транзакции является создание абстракции того, что каждый пользователь - единственный в системе.</p>
<h3 id=характеристики-транзакций>Характеристики транзакций</h3>
<p>В конце 1970-х <a href=http://en.wikipedia.org/wiki/Jim_Gray_%28computer_scientist%29>Джим Грей</a> выделил следующие характеристики транзакций:</p>
<ul>
<li>Атомарность (<strong>A</strong>tomicity)</li>
<li>Непротиворечивость (<strong>C</strong>onsistency)</li>
<li>Изолированность (<strong>I</strong>solation)</li>
<li>Долговечность (<strong>D</strong>urability)</li>
</ul>
<p><strong>Атомарность</strong> означает, что все действия, производимые в рамках одной транзакции атомарны. Если транзакция заканчивается не успешно, то все изменения, сделанный в рамках этой транзакции откатываются назад. Если транзакция заканчивается успешно, то все её изменения сохраняются.</p>
<p><strong>Непротиворечивость</strong> означает, что транзакция переводит базу данных из одного непротиворечивого состояния в другое непротиворечивое состояние. При этом, внутри транзакции база данных <strong>может</strong> находиться в противоречивом состоянии.</p>
<p><strong>Изолированность</strong> означает, что во время работы одной транзакции ей недоступны (с поправками на уровень изоляции) изменения, происходящие в другой транзакции.</p>
<p>Под <strong>долговечностью</strong> подразумевают, что после окончания транзакции все изменения, сделанные транзакцией фиксируется навсегда, то есть, если происходит программно-аппаратный сбой, то после восстановления системы в рабочее состояние нет потерянных изменений.</p>
<h3 id=уровни-изоляции-транзакций>Уровни изоляции транзакций</h3>
<p>При параллельном выполнении нескольких транзакций могут возникнуть следующие проблемы:</p>
<ul>
<li>Потерянное обновление</li>
<li>&ldquo;Грязное&rdquo; чтение</li>
<li>Неповторяющееся чтение</li>
<li>Фантомная вставка</li>
</ul>
<p><strong>Потерянное обновление</strong> может возникнуть в ситуации, когда две транзакции обновляют одни и те же данные.</p>
<p><strong>&ldquo;Грязное&rdquo; чтение</strong> возникает, когда одна транзакция видит несохранённые изменения, сделанные другой транзакцией.</p>
<p><strong>Неповторяющееся чтение</strong> - это ситуация, когда в рамках одной транзакции один и тот же запрос на выборку возвращает разные результаты.</p>
<p><strong>Фантомная вставка</strong> - ситуация, похожая на неповторяющее чтение - заключается в том, что результаты одной и той же выборки в рамках одной транзакции имеют разное количество возвращаемых строк.</p>
<p><a href=http://www.contrib.andrew.cmu.edu/%7Eshadow/sql/sql1992.txt>Стандарт SQL-92</a> определяет следующие уровни изоляции транзакции:</p>
<ol>
<li>READ_UNCOMMITED</li>
<li>READ_COMMITED</li>
<li>REPEATABLE_READ</li>
<li>SERIALIZABLE</li>
</ol>
<p><strong>READ_UNCOMMITED</strong> - позволяет другим транзакциям видеть несохранённые изменения</p>
<p><strong>READ_COMMITED</strong> — транзакция во время выполенения видит только зафиксированные изменения. В большинстве баз данных это уровень изоляции по умолчанию.</p>
<p><strong>REPEATABLE_READ</strong> — данный уровень изоляции решает проблему неповторяющего чтения.</p>
<p><strong>SERIALIZABLE</strong> - данный уровень изоляции выполняет все транзакции последовательно. Это самый надёжный уровень изоляции, но, при этом, и наименее производительный.</p>
<p>Каждый уровень решает часть вышеперечисленных проблем.</p>
<div class=nobr>
<table>
<tbody><tr>
<th>Проблема
<p>Уровень изоляции</th></p>
<th>Потерянное обновление</th>
<th>Грязное чтение</th>
<th>Неповторяющееся чтение</th>
<th>Фантомная вставка</th>
</tr><tr>
<td>READ_UNCOMMITED</td>
<td>невозможно</td>
<td>возможно</td>
<td>возможно</td>
<td>возможна</td>
</tr><tr>
<td>READ_COMMITED</td>
<td>невозможно</td>
<td>невозможно</td>
<td>возможно</td>
<td>возможна</td>
</tr>
<tr>
<td>REPEATABLE_READ</td>
<td>невозможно</td>
<td>невозможно</td>
<td>невозможно</td>
<td>возможна</td>
</tr>
<tr>
<td>SERIALIZABLE</td>
<td>невозможно</td>
<td>невозможно</td>
<td>невозможно</td>
<td>невозможна</td>
</tr></tbody></table>
</div>
</div>
<footer>
<div class=social>
<ul>
<li class=sidebar-nav-item><a target=_blank href=https://github.com/uthark/ title=https://github.com/uthark/><i class="fa fa-github fa-2x"></i></a>
</li>
<li class=sidebar-nav-item> <a target=_blank href=https://bitbucket.org/uthark/ title=https://bitbucket.org/uthark/><i class="fa fa-bitbucket fa-2x"></i></a>
<li class=sidebar-nav-item><a target=_blank href=https://twitter.com/real_atamanenko title=https://twitter.com/real_atamanenko><i class="fa fa-twitter fa-2x"></i></a>
<li class=sidebar-nav-item><a target=_blank href=https://keybase.io/uthark/ title=https://keybase.io/uthark/><i class="fa fa-key fa-2x"></i></a>
<li class=sidebar-nav-item><a target=_blank href=http://stackoverflow.com/users/216764/uthark title=http://stackoverflow.com/users/216764/uthark><i class="fa fa-stack-overflow fa-2x"></i></a>
</li>
<li><a href=https://feeds.feedburner.com/atamanenko target=_blank type=application/rss+xml title=RSS><i class="fa fa-rss-square fa-2x"></i></a></li>
</ul>
</div>
<p>&copy;&nbsp;2009&nbsp;—&nbsp;2021 Oleg Atamanenko - <a href=https://uthark.github.io/license/>CC&nbsp;BY-SA&nbsp;4.0</a>
</p>
</footer>
<script>var _gaq=[['_setAccount','UA-8688665-1'],['_trackPageview']];(function(b,c){var d=b.createElement(c),a=b.getElementsByTagName(c)[0];a.async='async',d.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js',a.parentNode.insertBefore(d,a)})(document,'script')</script>
</body>
</html>
</body>
</html>