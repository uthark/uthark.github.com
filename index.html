<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns#" lang="en">
<head>
	<meta name="generator" content="Hugo 0.74.3" />
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width,minimum-scale=1,maximum-scale=5">

  
  <title>Sharing knowledge</title>


  <meta name="description" content="">
  <meta name="keywords" content="">

  <meta name="author" content="Oleg Atamanenko">


  <link rel="stylesheet" media="screen" href="https://fontlibrary.org/face/go-mono" type="text/css"/>
  <link rel="stylesheet" media="screen" href="https://fonts.googleapis.com/css?family=Arvo" type="text/css"/>


  
  
  <link rel="stylesheet" href="https://uthark.github.io/css/uthark.css">

  
  

  
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css">

  
  <link href="https://uthark.github.io/favicon.png" rel="icon">

  
  
  


  


  
  <link href="https://feeds.feedburner.com/atamanenko" rel="alternate" type="application/rss+xml" title="Sharing knowledge" />
  

  


</head>
<body>

<header>
  
  <h1><a href="https://uthark.github.io/">Sharing knowledge</a></h1>
    <h2>by Oleg Atamanenko</h2>
</header>


<nav>

<ul class="main-navigation">
  
  
    
      <li><a href="https://uthark.github.io/" title="Blog">Blog</a></li>
    
  
    
      <li><a href="https://uthark.github.io/usefularticles/" title="Useful Articles" >Useful Articles</a></li>
    
  
    
      <li><a href="https://uthark.github.io/categories/" title="Categories" >Categories</a></li>
    
  
    
      <li><a href="https://uthark.github.io/readinglist/" title="Reading Lists" >Reading Lists</a></li>
    
  
    
      <li><a href="https://uthark.github.io/about/" title="About" >About</a></li>
    
  
</ul>


<ul class="subscription">
  
    
        
        
        <li><a href="https://feeds.feedburner.com/atamanenko" target="_blank" type="application/rss+xml" title="RSS"><i class="fa fa-rss-square fa-lg"></i></a></li>
        

    
  

</ul>


<form action="https://www.google.com/search" method="get" target="_blank">
  <fieldset role="search">
  	<input class="search" type="text" name="q" placeholder="Search"/>
    <input type="hidden" name="q" value="site:https://uthark.github.io/" />
  </fieldset>
</form>

</nav>


<div id="main">
 <div id="content">
  <div class="blog-index">
    
    
    <article>

        
        
<div class="sharing">
    <a href="https://getpocket.com/save?url=https%3a%2f%2futhark.github.io%2fpost%2f2020-09-02-installing-kubernetes-raspberrypi%2f" target="_blank" ><i class="fa fa-get-pocket" title="Save to Pocket" aria-hidden="true"></i></a>
    <a href="https://twitter.com/intent/tweet?text=Installing%20Kubernetes%20on%20Raspberry%20Pi&url=https%3a%2f%2futhark.github.io%2fpost%2f2020-09-02-installing-kubernetes-raspberrypi%2f" target="_blank" title="Post to Twitter" aria-hidden="true"><i class="fa fa-twitter"></i></a>
</div>
<header>
    <h1 class="entry-title">
        <a href="https://uthark.github.io/post/2020-09-02-installing-kubernetes-raspberrypi/">Installing Kubernetes on Raspberry Pi</a>
    </h1>

</header>


        
        <p>Installing kubernetes on Raspberry Pi is easy, but there are few caveats that you need to be aware of.</p>
<p><code>arm64</code> is preferred, because 64-bit allows you to use &gt; 4GB of RAM per process.</p>
<h2 id="enable-cgroups">Enable cgroups</h2>
<p>Kubernetes relies on cgroups for enforcing limits for the containers, so kernel needs to be booted with cgroups support.
On Raspberry, edit <code>/boot/firmware/cmdline.txt</code> and add the following options:</p>
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback">cgroup_enable=memory swapaccount=1 cgroup_memory=1 cgroup_enable=cpuset
</code></pre></div><p>Reboot after making the changes.</p>
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback">sudo shutdown -r now
</code></pre></div><h2 id="install-and-configure-docker">Install and configure docker</h2>
<p>Allow to use HTTPS transport for downloading packages:</p>
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback">sudo apt update
sudo apt install apt-transport-https ca-certificates curl gnupg-agent software-properties-common
</code></pre></div><p>Add docker GPG key used for verifying <code>Packages</code> file used by apt.</p>
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback">curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -
</code></pre></div><p>Add docker repository:</p>
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback">echo &#34;deb [arch=arm64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable&#34; | sudo tee /etc/apt/sources.list.d/docker.list
</code></pre></div><p>Update apt repository index and install docker</p>
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback">sudo apt update
sudo apt install docker-ce docker-ce-cli containerd.io
</code></pre></div><p>If you want to communicate with docker with non-root user:</p>
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback">sudo usermod -aG docker &#34;your user&#34;
</code></pre></div><p>To apply changes - logout and login again. If you want to reflect changes immediately run:</p>
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback">newgrp docker
</code></pre></div><p>Configure docker to use systemd as a cgroups driver, put in <code>/etc/docker/daemon.json</code>:</p>
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback">{
  &#34;exec-opts&#34;: [&#34;native.cgroupdriver=systemd&#34;],
  &#34;log-driver&#34;: &#34;json-file&#34;,
  &#34;log-opts&#34;: {
    &#34;max-size&#34;: &#34;100m&#34;
  },
  &#34;storage-driver&#34;: &#34;overlay2&#34;
}

</code></pre></div><h2 id="installing-kubeadm">Installing kubeadm</h2>
<p>Add kubernetes repository:</p>
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback">echo &#34;deb https://apt.kubernetes.io/ kubernetes-xenial main&#34; | sudo tee /etc/apt/sources.list.d/kubernetes.list
</code></pre></div><p>To allow iptables properly work with bridged traffic:</p>
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback">cat &lt;&lt;EOF | sudo tee /etc/sysctl.d/k8s.conf
net.bridge.bridge-nf-call-ip6tables = 1
net.bridge.bridge-nf-call-iptables = 1
EOF
sudo sysctl --system
</code></pre></div><p>Install kubeadm, kubelet and kubectl:</p>
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback">sudo apt update
sudo apt install -y kubelet kubeadm kubectl
</code></pre></div><p>Minor updates of kubernetes may require extra steps, so we need to prevent packages from auto-updating:</p>
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback">sudo apt-mark hold kubelet kubeadm kubectl
</code></pre></div><h2 id="installing-kubernetes-control-plane">Installing Kubernetes Control Plane</h2>
<p>Generate token for installation</p>
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback">TOKEN=$(sudo kubeadm token generate)
</code></pre></div><p>Install control plane with kubeadm:</p>
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback">sudo kubeadm init --token=${TOKEN} --kubernetes-version=v1.19.0
</code></pre></div><p>If installation is successful, output will look similar to this:</p>
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback">W0903 00:29:04.934934  417169 configset.go:348] WARNING: kubeadm cannot validate component configs for API groups [kubelet.config.k8s.io kubeproxy.config.k8s.io]
[init] Using Kubernetes version: v1.19.0
[preflight] Running pre-flight checks
	[WARNING SystemVerification]: missing optional cgroups: hugetlb
[preflight] Pulling images required for setting up a Kubernetes cluster
[preflight] This might take a minute or two, depending on the speed of your internet connection
[preflight] You can also perform this action in beforehand using &#39;kubeadm config images pull&#39;
[certs] Using certificateDir folder &#34;/etc/kubernetes/pki&#34;
[certs] Generating &#34;ca&#34; certificate and key
[certs] Generating &#34;apiserver&#34; certificate and key
[certs] apiserver serving cert is signed for DNS names [kubernetes kubernetes.default kubernetes.default.svc kubernetes.default.svc.cluster.local ubuntu] and IPs [10.96.0.1 192.168.1.153]
[certs] Generating &#34;apiserver-kubelet-client&#34; certificate and key
[certs] Generating &#34;front-proxy-ca&#34; certificate and key
[certs] Generating &#34;front-proxy-client&#34; certificate and key
[certs] Generating &#34;etcd/ca&#34; certificate and key
[certs] Generating &#34;etcd/server&#34; certificate and key
[certs] etcd/server serving cert is signed for DNS names [localhost ubuntu] and IPs [192.168.1.153 127.0.0.1 ::1]
[certs] Generating &#34;etcd/peer&#34; certificate and key
[certs] etcd/peer serving cert is signed for DNS names [localhost ubuntu] and IPs [192.168.1.153 127.0.0.1 ::1]
[certs] Generating &#34;etcd/healthcheck-client&#34; certificate and key
[certs] Generating &#34;apiserver-etcd-client&#34; certificate and key
[certs] Generating &#34;sa&#34; key and public key
[kubeconfig] Using kubeconfig folder &#34;/etc/kubernetes&#34;
[kubeconfig] Writing &#34;admin.conf&#34; kubeconfig file
[kubeconfig] Writing &#34;kubelet.conf&#34; kubeconfig file
[kubeconfig] Writing &#34;controller-manager.conf&#34; kubeconfig file
[kubeconfig] Writing &#34;scheduler.conf&#34; kubeconfig file
[kubelet-start] Writing kubelet environment file with flags to file &#34;/var/lib/kubelet/kubeadm-flags.env&#34;
[kubelet-start] Writing kubelet configuration to file &#34;/var/lib/kubelet/config.yaml&#34;
[kubelet-start] Starting the kubelet
[control-plane] Using manifest folder &#34;/etc/kubernetes/manifests&#34;
[control-plane] Creating static Pod manifest for &#34;kube-apiserver&#34;
[control-plane] Creating static Pod manifest for &#34;kube-controller-manager&#34;
[control-plane] Creating static Pod manifest for &#34;kube-scheduler&#34;
[etcd] Creating static Pod manifest for local etcd in &#34;/etc/kubernetes/manifests&#34;
[wait-control-plane] Waiting for the kubelet to boot up the control plane as static Pods from directory &#34;/etc/kubernetes/manifests&#34;. This can take up to 4m0s
[apiclient] All control plane components are healthy after 30.007706 seconds
[upload-config] Storing the configuration used in ConfigMap &#34;kubeadm-config&#34; in the &#34;kube-system&#34; Namespace
[kubelet] Creating a ConfigMap &#34;kubelet-config-1.19&#34; in namespace kube-system with the configuration for the kubelets in the cluster
[upload-certs] Skipping phase. Please see --upload-certs
[mark-control-plane] Marking the node ubuntu as control-plane by adding the label &#34;node-role.kubernetes.io/master=&#39;&#39;&#34;
[mark-control-plane] Marking the node ubuntu as control-plane by adding the taints [node-role.kubernetes.io/master:NoSchedule]
[bootstrap-token] Using token: 5p4y2w.xxivtzh1lvuukdk7
[bootstrap-token] Configuring bootstrap tokens, cluster-info ConfigMap, RBAC Roles
[bootstrap-token] configured RBAC rules to allow Node Bootstrap tokens to get nodes
[bootstrap-token] configured RBAC rules to allow Node Bootstrap tokens to post CSRs in order for nodes to get long term certificate credentials
[bootstrap-token] configured RBAC rules to allow the csrapprover controller automatically approve CSRs from a Node Bootstrap Token
[bootstrap-token] configured RBAC rules to allow certificate rotation for all node client certificates in the cluster
[bootstrap-token] Creating the &#34;cluster-info&#34; ConfigMap in the &#34;kube-public&#34; namespace
[kubelet-finalize] Updating &#34;/etc/kubernetes/kubelet.conf&#34; to point to a rotatable kubelet client certificate and key
[addons] Applied essential addon: CoreDNS
[addons] Applied essential addon: kube-proxy

Your Kubernetes control-plane has initialized successfully!

To start using your cluster, you need to run the following as a regular user:

  mkdir -p $HOME/.kube
  sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
  sudo chown $(id -u):$(id -g) $HOME/.kube/config

You should now deploy a pod network to the cluster.
Run &#34;kubectl apply -f [podnetwork].yaml&#34; with one of the options listed at:
  https://kubernetes.io/docs/concepts/cluster-administration/addons/

Then you can join any number of worker nodes by running the following on each as root:

kubeadm join 192.168.1.153:6443 --token 5p4y2w.xxivtzh1lvuukdk7 \
    --discovery-token-ca-cert-hash sha256:5638c83bec2b62b5f01d85bc2f4330b03b7e3c4682fe3f5e7e4189fbb63c5a17
</code></pre></div><h2 id="configure-kubectl-to-communicate-with-the-cluster">Configure kubectl to communicate with the cluster</h2>
<p>Put kubeconfig file in user&rsquo;s home directory:</p>
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback">mkdir -p $HOME/.kube
sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
sudo chown $(id -u):$(id -g) $HOME/.kube/config

</code></pre></div><p>Verify it works:</p>
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback">kubectl get nodes
</code></pre></div><p>In my case output was:</p>
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback">NAME     STATUS   ROLES    AGE     VERSION
ubuntu   Ready    master   3h42m   v1.19.0

</code></pre></div><p>As a CNI network provider I use Calico, but you can use any you like. <a href="https://kubernetes.io/docs/concepts/cluster-administration/networking/#how-to-implement-the-kubernetes-networking-model">List of available implementations</a></p>
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback">curl https://docs.projectcalico.org/manifests/calico.yaml -O
kubectl apply -f calico.yaml
</code></pre></div><p>Now you have working single node kubernetes cluster. Next things you might need to do:</p>
<ol>
<li>Add worker nodes: use <code>kubeadm join</code>.</li>
<li>Install <a href="https://metallb.universe.tf/">MetalLB</a> – Loadbalancer for bare-metal kubernetes clusters</li>
<li>Install <a href="https://helm.sh/">Helm</a> to install kubernetes packages.</li>
<li>If you have only single raspberry pi, you need to remove taint from your control plane node so that it regular workload can be scheduled on it:
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback">kubectl taint nodes --all node-role.kubernetes.io/master-
</code></pre></div></li>
</ol>
<h2 id="references">References</h2>
<ul>
<li><a href="https://docs.docker.com/engine/install/ubuntu/">Docker Installation</a></li>
<li><a href="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/">Bootstrapping clusters with kubeadm</a></li>
<li><a href="https://kubernetes.io/docs/concepts/cluster-administration/networking/#how-to-implement-the-kubernetes-networking-model">Kubernetes Cluster Networking</a></li>
</ul>

        

    </article>
    
    <article>

        
        
<div class="sharing">
    <a href="https://getpocket.com/save?url=https%3a%2f%2futhark.github.io%2fpost%2f2020-09-01-raspberry-pi-ubuntu-arm64%2f" target="_blank" ><i class="fa fa-get-pocket" title="Save to Pocket" aria-hidden="true"></i></a>
    <a href="https://twitter.com/intent/tweet?text=Configuring%20Wi-Fi%20on%20Ubuntu%20Server%2064-bit%20on%20Raspberry%20Pi%204&url=https%3a%2f%2futhark.github.io%2fpost%2f2020-09-01-raspberry-pi-ubuntu-arm64%2f" target="_blank" title="Post to Twitter" aria-hidden="true"><i class="fa fa-twitter"></i></a>
</div>
<header>
    <h1 class="entry-title">
        <a href="https://uthark.github.io/post/2020-09-01-raspberry-pi-ubuntu-arm64/">Configuring Wi-Fi on Ubuntu Server 64-bit on Raspberry Pi 4</a>
    </h1>

</header>


        
        <p>After discovering that by default Raspberry installs <a href="https://www.raspberrypi.org/downloads/raspberry-pi-os/">32-bit Raspbian OS</a>, I wanted to reinstall it with a 64 bit - this would allow to run Kubernetes on Raspberry</p>
<p>Decided to go with <a href="https://ubuntu.com/download/raspberry-pi">Ubuntu Server 64</a>.</p>
<p>Installed it on SD Card with <a href="https://www.raspberrypi.org/downloads/">Raspberry Pi Imager</a>.</p>
<p>After boot found out that need to connect it to WI-FI.</p>
<p>Configuring <code>wpa_supplicant</code> didn&rsquo;t help, still had issues with not getting IP Address from DHCP.</p>
<p>Finally, did the following:</p>
<ol>
<li>
<p>Create <code>/etc/netplan/01-netcfg.yaml</code> and put the following content there:</p>
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback">network:
  version: 2
  renderer: networkd
  wifis:
    wlan0:
      dhcp4: true
      dhcp6: true
      optional: true
      access-points:
        &#34;&lt;replace with your wifi network name/SSID&gt;&#34;:
          password: &#34;&lt;replace with your password&gt;&#34;
</code></pre></div></li>
<li>
<p>Change permissions to make file accessible only to <code>root</code> user:</p>
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback">chmod 600 /etc/netplan/01-netcfg.yaml
</code></pre></div></li>
<li>
<p>Configure <a href="https://linux.die.net/man/8/crda">Linux wireless central regulatory domain agent</a>. Put your country code in <code>/etc/default/crda</code></p>
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback">REGDOMAIN=US
</code></pre></div></li>
<li>
<p>After that, need to generate and apply netplan:</p>
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback">sudo netplan --debug generate
sudo netplan --debug apply
</code></pre></div></li>
</ol>

        

    </article>
    
    <article>

        
        
<div class="sharing">
    <a href="https://getpocket.com/save?url=https%3a%2f%2futhark.github.io%2fpost%2f2020-08-31-pihole%2f" target="_blank" ><i class="fa fa-get-pocket" title="Save to Pocket" aria-hidden="true"></i></a>
    <a href="https://twitter.com/intent/tweet?text=Raspberry%20Pi%20with%20pi-hole&url=https%3a%2f%2futhark.github.io%2fpost%2f2020-08-31-pihole%2f" target="_blank" title="Post to Twitter" aria-hidden="true"><i class="fa fa-twitter"></i></a>
</div>
<header>
    <h1 class="entry-title">
        <a href="https://uthark.github.io/post/2020-08-31-pihole/">Raspberry Pi with pi-hole</a>
    </h1>

</header>


        
        <p>Several years ago I bought Raspberry Pi 3. It was a nice toy, but it was very slow and almost impossible to use, so it didn&rsquo;t stick. Recently I bought new Raspberry Pi 4 because it has much better hardware (especially 8GB RAM option).</p>
<p>Idea was to use it as a mini-server and run <a href="https://pi-hole.net">pi-hole</a> on it. In general, it was a success, after installing raspbian, I installed docker on it and run pi-hole docker installation. Few tweaks were required to configure my router to update DNS, but I&rsquo;m still not happy with the result. My router doesn&rsquo;t allow to customize DNS servers that are distributed via DHCP, so all clients get default DNS which is my router, and router uses Pi Hole. As a result, in pi-hole I see only 2 clients - <code>localhost</code> and my router.</p>
<p>But still get a lot of benefits by blocking most of the ads on most of my devices, which is really nice, especially in 2020, when amount of ads on the websites is enormous.</p>
<p>The next idea to try is to install <code>arm64</code> kernel and try to install kubernetes (or at least a <code>kubelet</code>).</p>

        

    </article>
    
    <article>

        
        
<div class="sharing">
    <a href="https://getpocket.com/save?url=https%3a%2f%2futhark.github.io%2fpost%2f2018-02-24-used-stuff%2f" target="_blank" ><i class="fa fa-get-pocket" title="Save to Pocket" aria-hidden="true"></i></a>
    <a href="https://twitter.com/intent/tweet?text=My%20Setup&url=https%3a%2f%2futhark.github.io%2fpost%2f2018-02-24-used-stuff%2f" target="_blank" title="Post to Twitter" aria-hidden="true"><i class="fa fa-twitter"></i></a>
</div>
<header>
    <h1 class="entry-title">
        <a href="https://uthark.github.io/post/2018-02-24-used-stuff/">My Setup</a>
    </h1>

</header>


        
        <h2 id="introduction">Introduction</h2>
<p>This is a dump of different things and apps I use on a daily basis.
Hope you will find it useful.</p>
<h2 id="shellterminal-applications">Shell/Terminal Applications</h2>
<ul>
<li><a href="http://zsh.sourceforge.net/">zsh</a> — ZSH is a shell. It is very good alternative to <a href="https://www.gnu.org/software/bash/">bash</a> which is used by default in most Linux distributions and in macOS. macOS uses very old version of bash because bash changed it&rsquo;s license and Apple doesn&rsquo;t like GPL.</li>
<li><a href="http://ohmyz.sh/">oh-my-zsh</a> — framework for easy customization of ZSH. Has a lot of additional plugins. Try not to overuse it, otherwise new ZSH session may start several seconds even on a modern hardware.</li>
<li><a href="https://github.com/junegunn/fzf">fzf</a> — A command-line fuzzy finder. I bind it to <code>Cmd+R</code> to do search in history.</li>
<li><a href="https://github.com/kennethreitz/autoenv">autoenv</a> — Directory-based environments.</li>
<li><a href="https://github.com/wting/autojump">autojump</a> — A cd command that learns - easily navigate directories from the command line</li>
<li><a href="https://brew.sh/">brew</a> — Package Manager for macOS. Must have application for mac. Allows to easily install applications via CLI. Also <code>Brewfile</code> is a lifesaver.</li>
</ul>
<h2 id="desktop-applications">Desktop Applications</h2>
<p>Nowadays I use Apple MacBook Pro primarily, so most applications listed here are macOS specific.</p>
<h3 id="generic-apps">Generic apps</h3>
<ul>
<li><a href="https://www.iterm2.com/">iterm</a> — Very good replacement of macOS Terminal.app.</li>
<li><a href="http://ilyabirman.ru/projects/typography-layout/">Ilya Birman&rsquo;s Typography Layout</a> — this layout provides improvements over standard layout to allow easy input of specific symbols.</li>
<li><a href="https://www.alfredapp.com/">alfred</a> - replacement for Spotlight.</li>
</ul>
<h3 id="productivity">Productivity</h3>
<ul>
<li><a href="https://evernote.com/">Evernote</a> — I used it for storing various information, articles from the web, notes and so on. UI is not very friendly, but it works across web, mobile and desktop, synchronisation works most of the time.</li>
<li><a href="https://drive.google.com/">Google Drive</a> - Cloud synchronisation.</li>
<li><a href="https://www.omnigroup.com/omnifocus">OmniFocus</a> — Awesome task manager application for macOS and iOS.</li>
<li><a href="https://www.omnigroup.com/omnioutliner">OmniOutliner</a> - outline software. I use it for tracking various lists, then move to archive in Evernote.</li>
<li><a href="https://getpocket.com/">Pocket</a> - Read it later service.</li>
<li><a href="https://1password.com/">1Password</a> - Password Manager.</li>
<li><a href="https://ifttt.com/">ifttt</a> - Internet automation across different applications and services.</li>
<li><a href="https://heyfocus.com/">Focus.app</a> - Blocks web sites and specific apps. When you need to focus and don&rsquo;t want any distractions.</li>
<li><a href="https://www.macbartender.com/">Bartender</a> — This small application clean top toolbar icons. You can hide those you don&rsquo;t need.</li>
<li><a href="https://ia.net/writer/">ia Writer</a> — Distraction-free text editor</li>
<li><a href="https://mindnode.com">MindNode</a> - Mind mapping software.</li>
<li><a href="http://magnet.crowdcafe.com/">Magnet</a> - application which improves behaviour of standard window manager on macOS. With this app you can easily snap windows, split them and so on. Small and useful utility.</li>
</ul>
<h3 id="text-editors--ides">Text Editors / IDEs</h3>
<ul>
<li><a href="https://www.jetbrains.com/idea/">IntelliJ IDEA</a> - this my work horse. Most of my code is written in this app.</li>
<li><a href="https://www.vim.org">vim</a> - exists on most servers and linuxes.</li>
<li><a href="https://code.visualstudio.com">VSCode</a> – use it for some temporary notes/drafts</li>
</ul>
<h3 id="monospace-fonts">Monospace Fonts</h3>
<ul>
<li><a href="https://fontlibrary.org/en/font/go-mono">go mono</a> - Monospace font I use in terminal and text editors/IDEs.</li>
</ul>
<h4 id="other-good-monospace-fonts">Other good monospace fonts</h4>
<ul>
<li><a href="https://github.com/adobe-fonts/source-code-pro">source code pro</a></li>
<li><a href="https://fonts.google.com/specimen/Anonymous+Pro">anonymous pro</a></li>
</ul>
<h4 id="reading">Reading</h4>
<p>Unfortunately, have books bought via different books stores, so use different devices and applications.</p>
<ul>
<li>Amazon Kindle</li>
<li>Apple Books</li>
<li>Google Play Books</li>
<li>Pocket</li>
</ul>
<h3 id="games">Games</h3>
<p>Although, I don&rsquo;t play games heavily, I have few games installed that I would recommend:</p>
<ul>
<li>Monument Valley and Monument Valley 2.</li>
<li>Lumino City</li>
<li>Shadowmatic</li>
<li>Machinarium</li>
<li>Thomas was alone</li>
<li>Lode Runner</li>
<li>Limbo</li>
</ul>
<h2 id="physical-stuff">Physical stuff</h2>
<p>In addition to digital things, I continue to use physical things too. We are not completely in Matrix yet.</p>
<ul>
<li>
<p>Backpack North Face Microbyte — my daily backpack. It is small, it holds laptop and a few other things. Probably, I need to make another blog post about the things I have in my backpack. Earlier I used North Face Router a lot, but it is quite bulky. I use it now if we go with my family outside or if I have a work trip.</p>
</li>
<li>
<p>Water Bottle - clean kanteen</p>
</li>
<li>
<p>External USB Charger - anker e4</p>
</li>
<li>
<p>Headphones
I have several pairs for different use cases:</p>
<ul>
<li>Noise cancelling: Bose QC25/QC35</li>
<li>Music listening: AKG Q701</li>
<li>Outdoor/to-go: Apple Earpods</li>
</ul>
</li>
<li>
<p>Kindle Paperwhite</p>
</li>
<li>
<p>For jotting on paper: Moleskine and Pilot precise V5 RT</p>
</li>
</ul>

        

    </article>
    
    <article>

        
        
<div class="sharing">
    <a href="https://getpocket.com/save?url=https%3a%2f%2futhark.github.io%2fpost%2f2018-01-22-go-restful-yaml%2f" target="_blank" ><i class="fa fa-get-pocket" title="Save to Pocket" aria-hidden="true"></i></a>
    <a href="https://twitter.com/intent/tweet?text=How%20to%20add%20YAML%20support%20to%20go-restful&url=https%3a%2f%2futhark.github.io%2fpost%2f2018-01-22-go-restful-yaml%2f" target="_blank" title="Post to Twitter" aria-hidden="true"><i class="fa fa-twitter"></i></a>
</div>
<header>
    <h1 class="entry-title">
        <a href="https://uthark.github.io/post/2018-01-22-go-restful-yaml/">How to add YAML support to go-restful</a>
    </h1>

</header>


        
        <p><a href="https://github.com/emicklei/go-restful">go-restful</a> is a <a href="https://golang.org">go</a> package used for building REST-style web services.
It is very powerful, but it supports JSON and XML out of the box only. Fortunately, go-restful allows to register custom serialization schemes.</p>
<p>To do so, it provides a handy interface <a href="https://godoc.org/github.com/emicklei/go-restful#EntityReaderWriter">EntityReaderWriter</a>, which contains only two methods:</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="c1">// EntityReaderWriter can read and write values using an encoding such as JSON,XML.
</span><span class="c1"></span><span class="kd">type</span> <span class="nx">EntityReaderWriter</span> <span class="kd">interface</span> <span class="p">{</span>
    <span class="c1">// Read a serialized version of the value from the request.
</span><span class="c1"></span>    <span class="c1">// The Request may have a decompressing reader. Depends on Content-Encoding.
</span><span class="c1"></span>    <span class="nf">Read</span><span class="p">(</span><span class="nx">req</span> <span class="o">*</span><span class="nx">Request</span><span class="p">,</span> <span class="nx">v</span> <span class="kd">interface</span><span class="p">{})</span> <span class="kt">error</span>

    <span class="c1">// Write a serialized version of the value on the response.
</span><span class="c1"></span>    <span class="c1">// The Response may have a compressing writer. Depends on Accept-Encoding.
</span><span class="c1"></span>    <span class="c1">// status should be a valid Http Status code
</span><span class="c1"></span>    <span class="nf">Write</span><span class="p">(</span><span class="nx">resp</span> <span class="o">*</span><span class="nx">Response</span><span class="p">,</span> <span class="nx">status</span> <span class="kt">int</span><span class="p">,</span> <span class="nx">v</span> <span class="kd">interface</span><span class="p">{})</span> <span class="kt">error</span>
<span class="p">}</span>
</code></pre></div><p>What we need to do is to implement this interface and register it in go-restful.</p>
<p>Let’s implement the interface:</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">restyaml</span>

<span class="kn">import</span> <span class="p">(</span>
	<span class="s">&#34;io&#34;</span>
	<span class="s">&#34;io/ioutil&#34;</span>

	<span class="s">&#34;github.com/emicklei/go-restful&#34;</span>
	<span class="s">&#34;gopkg.in/yaml.v2&#34;</span>
<span class="p">)</span>

<span class="c1">// MediaTypeApplicationYaml is a Mime Type for YAML.
</span><span class="c1"></span><span class="kd">const</span> <span class="nx">MediaTypeApplicationYaml</span> <span class="p">=</span> <span class="s">&#34;application/x-yaml&#34;</span>

<span class="c1">// YamlReaderWriter implements EntityReaderWriter for YAML objects to be used by restful.
</span><span class="c1"></span><span class="kd">type</span> <span class="nx">YamlReaderWriter</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="nx">contentType</span> <span class="kt">string</span>
<span class="p">}</span>

<span class="c1">// NewYamlReaderWriter creates new instance.
</span><span class="c1"></span><span class="kd">func</span> <span class="nf">NewYamlReaderWriter</span><span class="p">(</span><span class="nx">contentType</span> <span class="kt">string</span><span class="p">)</span> <span class="nx">restful</span><span class="p">.</span><span class="nx">EntityReaderWriter</span> <span class="p">{</span>
	<span class="k">return</span> <span class="nx">YamlReaderWriter</span><span class="p">{</span><span class="nx">contentType</span><span class="p">:</span> <span class="nx">contentType</span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">closeWithErrHandle</span><span class="p">(</span><span class="nx">c</span> <span class="nx">io</span><span class="p">.</span><span class="nx">Closer</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">err</span> <span class="o">:=</span> <span class="nx">c</span><span class="p">.</span><span class="nf">Close</span><span class="p">()</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="nx">logger</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Unable to close resource: &#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Read a serialized version of the value from the request.
</span><span class="c1">// The Request may have a decompressing reader. Depends on Content-Encoding.
</span><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">e</span> <span class="nx">YamlReaderWriter</span><span class="p">)</span> <span class="nf">Read</span><span class="p">(</span><span class="nx">req</span> <span class="o">*</span><span class="nx">restful</span><span class="p">.</span><span class="nx">Request</span><span class="p">,</span> <span class="nx">v</span> <span class="kd">interface</span><span class="p">{})</span> <span class="kt">error</span> <span class="p">{</span>
	<span class="k">defer</span> <span class="nf">closeWithErrHandle</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">Request</span><span class="p">.</span><span class="nx">Body</span><span class="p">)</span>
	<span class="nx">bytes</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">ioutil</span><span class="p">.</span><span class="nf">ReadAll</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">Request</span><span class="p">.</span><span class="nx">Body</span><span class="p">)</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="k">return</span> <span class="nx">err</span>
	<span class="p">}</span>
	<span class="nx">err</span> <span class="p">=</span> <span class="nx">yaml</span><span class="p">.</span><span class="nf">Unmarshal</span><span class="p">(</span><span class="nx">bytes</span><span class="p">,</span> <span class="nx">v</span><span class="p">)</span>
	<span class="k">return</span> <span class="nx">err</span>
<span class="p">}</span>

<span class="c1">// Write a serialized version of the value on the response.
</span><span class="c1">// The Response may have a compressing writer. Depends on Accept-Encoding.
</span><span class="c1">// status should be a valid Http Status code
</span><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">e</span> <span class="nx">YamlReaderWriter</span><span class="p">)</span> <span class="nf">Write</span><span class="p">(</span><span class="nx">resp</span> <span class="o">*</span><span class="nx">restful</span><span class="p">.</span><span class="nx">Response</span><span class="p">,</span> <span class="nx">status</span> <span class="kt">int</span><span class="p">,</span> <span class="nx">v</span> <span class="kd">interface</span><span class="p">{})</span> <span class="kt">error</span> <span class="p">{</span>
	<span class="nx">bytes</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">yaml</span><span class="p">.</span><span class="nf">Marshal</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="k">return</span> <span class="nx">err</span>
	<span class="p">}</span>

	<span class="nx">resp</span><span class="p">.</span><span class="nf">WriteHeader</span><span class="p">(</span><span class="nx">status</span><span class="p">)</span>
	<span class="nx">_</span><span class="p">,</span> <span class="nx">err</span> <span class="p">=</span> <span class="nx">resp</span><span class="p">.</span><span class="nf">Write</span><span class="p">(</span><span class="nx">bytes</span><span class="p">)</span>
	<span class="k">return</span> <span class="nx">err</span>
<span class="p">}</span>

</code></pre></div><p>For implementing actual reading/writing of YAML I use library called <a href="https://github.com/go-yaml/yaml">go-yaml</a>. The implementation is straightforward, just call <a href="https://godoc.org/gopkg.in/yaml.v2#Marshal"><code>Marshal</code></a> and <a href="https://godoc.org/gopkg.in/yaml.v2#Unmarshal"><code>Unmarshal</code></a> methods and do an error processing.</p>
<p>The final step is to register newly written <code>YamlReaderWriter</code> in go-restful container during application startup.</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go">
<span class="kn">package</span> <span class="nx">rest</span>

<span class="kn">import</span> <span class="p">(</span>
	<span class="s">&#34;context&#34;</span>
	<span class="s">&#34;fmt&#34;</span>
	<span class="s">&#34;net/http&#34;</span>
	<span class="s">&#34;os&#34;</span>
	<span class="s">&#34;os/signal&#34;</span>
	<span class="s">&#34;strconv&#34;</span>
	<span class="s">&#34;syscall&#34;</span>
	<span class="s">&#34;time&#34;</span>

	<span class="s">&#34;bitbucket.org/uthark/yttrium/internal/config&#34;</span>
	<span class="s">&#34;bitbucket.org/uthark/yttrium/internal/mime&#34;</span>
	<span class="s">&#34;github.com/emicklei/go-restful&#34;</span>
<span class="p">)</span>

<span class="c1">// Init initializes server.
</span><span class="c1"></span><span class="kd">func</span> <span class="nf">init</span><span class="p">()</span> <span class="p">{</span>

	<span class="nx">restful</span><span class="p">.</span><span class="nf">SetLogger</span><span class="p">(</span><span class="nx">logger</span><span class="p">)</span>
	<span class="nx">restful</span><span class="p">.</span><span class="nf">DefaultResponseContentType</span><span class="p">(</span><span class="nx">restful</span><span class="p">.</span><span class="nx">MIME_JSON</span><span class="p">)</span>
	<span class="nx">restful</span><span class="p">.</span><span class="nf">RegisterEntityAccessor</span><span class="p">(</span><span class="nx">restyaml</span><span class="p">.</span><span class="nx">MediaTypeApplicationYaml</span><span class="p">,</span> <span class="nx">restyaml</span><span class="p">.</span><span class="nf">NewYamlReaderWriter</span><span class="p">(</span><span class="nx">restyaml</span><span class="p">.</span><span class="nx">MediaTypeApplicationYaml</span><span class="p">))</span>

	<span class="c1">// register web-services in restful and start http…
</span><span class="c1"></span>	<span class="c1">// omitted for brevity
</span><span class="c1"></span><span class="p">}</span>

</code></pre></div><p>Now, we can submit requests in YAML format to our API:</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">$ curl -H <span class="s2">&#34;Accept: application/x-yaml&#34;</span> http://localhost:8080/task
- id: dd453ac9-6e8d-4f37-88a9-4e6d5b653e8d
  name: Another Task
  dateAdded: 2018-01-20T20:05:09.378Z
  dateCompleted: 0001-01-01T00:00:00Z
</code></pre></div><p>If we don’t specify header, the output will be in JSON:</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">$ curl http://localhost:8080/task
<span class="o">[</span>
  <span class="o">{</span>
   <span class="s2">&#34;id&#34;</span>: <span class="s2">&#34;dd453ac9-6e8d-4f37-88a9-4e6d5b653e8d&#34;</span>,
   <span class="s2">&#34;name&#34;</span>: <span class="s2">&#34;Another Task&#34;</span>,
   <span class="s2">&#34;dateAdded&#34;</span>: <span class="s2">&#34;2018-01-20T20:05:09.378Z&#34;</span>,
   <span class="s2">&#34;dateCompleted&#34;</span>: <span class="s2">&#34;0001-01-01T00:00:00Z&#34;</span>
  <span class="o">}</span>
 <span class="o">]</span>
</code></pre></div>
        

    </article>
    
    <article>

        
        
<div class="sharing">
    <a href="https://getpocket.com/save?url=https%3a%2f%2futhark.github.io%2f2017%2f11%2f21%2fmigrate-to-hugo%2f" target="_blank" ><i class="fa fa-get-pocket" title="Save to Pocket" aria-hidden="true"></i></a>
    <a href="https://twitter.com/intent/tweet?text=Migration%20to%20hugo%20completed&url=https%3a%2f%2futhark.github.io%2f2017%2f11%2f21%2fmigrate-to-hugo%2f" target="_blank" title="Post to Twitter" aria-hidden="true"><i class="fa fa-twitter"></i></a>
</div>
<header>
    <h1 class="entry-title">
        <a href="https://uthark.github.io/2017/11/21/migrate-to-hugo/">Migration to hugo completed</a>
    </h1>

</header>


        
        <p>Good news, everyone. Migration from octopress to <a href="https://gohugo.io/">hugo</a> was completed. If you find any broken  layout and/or links, please contact me.</p>

        

    </article>
    
    <article>

        
        
<div class="sharing">
    <a href="https://getpocket.com/save?url=https%3a%2f%2futhark.github.io%2f2014%2f04%2f23%2fpocket-is-down%2f" target="_blank" ><i class="fa fa-get-pocket" title="Save to Pocket" aria-hidden="true"></i></a>
    <a href="https://twitter.com/intent/tweet?text=Pocket%20is%20down&url=https%3a%2f%2futhark.github.io%2f2014%2f04%2f23%2fpocket-is-down%2f" target="_blank" title="Post to Twitter" aria-hidden="true"><i class="fa fa-twitter"></i></a>
</div>
<header>
    <h1 class="entry-title">
        <a href="https://uthark.github.io/2014/04/23/pocket-is-down/">Pocket is down</a>
    </h1>

</header>


        
        <p>Hi. <a href="https://twitter.com/Pocket/status/458989752432091136">Pocket is down</a> so it means there is no reading list for today. Everyone have a nice day.</p>

        

    </article>
    
    
    




<div class="pagination">

    
        
        
        
        <a href="/" aria-label="First" class="label-pagination"><i class="fa fa-angle-double-left fa-lg"></i></a>
    

    

    
        <a href="/" class="label-pagination">1</a>
    
        <a href="/page/2/" class="label-pagination">2</a>
    
        <a href="/page/3/" class="label-pagination">3</a>
    
        <a href="/page/4/" class="label-pagination">4</a>
    
        <a href="/page/5/" class="label-pagination">5</a>
    
        <a href="/page/6/" class="label-pagination">6</a>
    
        <a href="/page/7/" class="label-pagination">7</a>
    
        <a href="/page/8/" class="label-pagination">8</a>
    
        <a href="/page/9/" class="label-pagination">9</a>
    
        <a href="/page/10/" class="label-pagination">10</a>
    
        <a href="/page/11/" class="label-pagination">11</a>
    

    
    
        <a href="/page/2/" aria-label="Next" class="label-pagination"><i class="fa fa-angle-right fa-lg"></i></a>
    

    
    
        <a href="/page/11/" aria-label="Last"><i class="fa fa-angle-double-right fa-lg"></i></a>
    

</div>

  

  </div>

  

<aside class="sidebar thirds">
  <section class="first odd">

    

    <p>
      
    </p>
  </section>






  

  

  
  
  

</aside>
    
 </div>
</div>

<footer>
    
    <div class="center">
        <ul class="sidebar-nav">
            <li class="sidebar-nav-item">
                <a target="_blank" href="https://github.com/uthark/" title="https://github.com/uthark/"><i
                    class="fa fa-github fa-3x"></i></a></li>
            <li class="sidebar-nav-item">    <a target="_blank" href="https://bitbucket.org/uthark/" title="https://bitbucket.org/uthark/"><i
                    class="fa fa-bitbucket fa-3x"></i></a>
            <li class="sidebar-nav-item">
            <li class="sidebar-nav-item"><a target="_blank" href="#ZgotmplZ" title="map[card:summary creator:@LinkageError site:@LinkageError]"><i
                    class="fa fa-twitter fa-3x"></i></a>
            <li class="sidebar-nav-item"><a target="_blank" href="https://keybase.io/uthark/" title="https://keybase.io/uthark/"><i
                    class="fa fa-key fa-3x"></i></a> 
            <li class="sidebar-nav-item">
            <li class="sidebar-nav-item"><a target="_blank" href="http://stackoverflow.com/users/216764/uthark" title="http://stackoverflow.com/users/216764/uthark"><i
                    class="fa fa-stack-overflow fa-3x"></i></a>
            <li class="sidebar-nav-item">
            <li class="sidebar-nav-item">
            <li class="sidebar-nav-item">
            <li class="sidebar-nav-item">
                
                
            </li>
        </ul>
    </div>
    <p>Copyright &copy; 2009&nbsp;—&nbsp;2020 Oleg Atamanenko - <a href="https://uthark.github.io/license/">License</a> -
        <span class="credit">Powered by <a target="_blank" href="https://gohugo.io">Hugo</a>, uses custom theme based on
            <a target="_blank" href="https://github.com/parsiya/hugo-octopress/">Hugo-Octopress</a> theme.</span>
    </p>

</footer>


<script>
    var _gaq = [['_setAccount', 'UA-8688665-1'], ['_trackPageview']];
    (function (d, t) {
        var g = d.createElement(t), s = d.getElementsByTagName(t)[0];
        s.async = 'async'
        g.src = ('https:' == location.protocol ? '//ssl' : '//www') + '.google-analytics.com/ga.js';
        s.parentNode.insertBefore(g, s)
    }(document, 'script'));
</script>


</body>
</html>
   
