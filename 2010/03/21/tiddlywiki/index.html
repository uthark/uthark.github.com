<!doctype html><html>
<head>
<meta charset=utf-8>
<title>
Разработка макроса для TiddlyWiki &ndash; Oleg Atamanenko
</title>
<link rel=stylesheet media=screen href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@300&family=Prata&display=swap" type=text/css>
<link rel=stylesheet href=https://uthark.github.io/css/theme.6e6c1b2c79e89e36c8ab0a167a615efa6b0320017c80244b0c72043ea3ac4bcf.css>
<link rel=stylesheet href=//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css>
<link href=https://uthark.github.io/favicon.png rel=icon>
</head>
<body>
<header class=site>
<h1><a href=https://uthark.github.io/>Oleg Atamanenko</a></h1>
<h2>thoughts about programming</h2>
</header>
<nav>
<ul class=main-navigation>
<li><a href=https://uthark.github.io/ title=Posts>Posts</a></li>
<li><a href=https://uthark.github.io/categories/ title=Categories>Categories</a></li>
<li><a href=https://uthark.github.io/usefularticles/ title=Links>Links</a></li>
<li><a href=https://uthark.github.io/about/ title="About me">About me</a></li>
</ul>
</nav>
<div class=article>
<h1>Разработка макроса для TiddlyWiki</h1>
<p><b>Summary</b>: Пример разработки плагина для TiddlyWiki</p>
<h4>Вступление</h4>
<p><a href=http://www.tiddlywiki.com/>TiddlyWiki</a> - это вики-движок, полностью написанный на <a href=http://en.wikipedia.org/wiki/JavaScript>JavaScript</a> и хранящийся в одном файле (как сам движок, так и содержимое). Создатели позиционируют его как "переиспользуемую нелинейную персональную веб записную книжку".</p>
<p>Я давно использую TiddlyWiki в различных целях:</p>
<ol><li>По прямому назначению.</li>
<li>Как систему <a href=http://mgsd.tiddlyspot.com/#mGSD>GTD</a>.</li>
<li>Как домашнюю страницу на компьютере.</li>
</ol>
<p>Моя домашняя страница на компьютере - это, если говорить терминами TiddlyWiki, <a href=http://en.wikipedia.org/wiki/Tiddler>тиддлер</a>, содержащий ссылки на страницы, которые я часто посещаю.</p>
<p>Для удобства использования я разработал пару стилей CSS, так что ссылки были крупными.</p>
<a onblur=try{parent.deselectBloggerImageGracefully()}catch(a){} href=http://2.bp.blogspot.com/_y8p0_dtMJ38/S6Y0rP2J0eI/AAAAAAAAA9I/xrZhzZf2ad0/s1600-h/tiddly-before.png><img style="display:block;margin:0 auto 10px;text-align:center;cursor:pointer;cursor:hand;width:172px;height:132px" src=http://2.bp.blogspot.com/_y8p0_dtMJ38/S6Y0rP2J0eI/AAAAAAAAA9I/xrZhzZf2ad0/s400/tiddly-before.png border=0 alt id=BLOGGER_PHOTO_ID_5451102316571251170></a>
<h4>Исходный код плагина</h4>
<p>После длительного использования tiddlywiki в качестве домашней страницы я понял, что мне хочется, чтобы с каждой ссылкой была иконка сайта. Вручную вставлять картинки мне не хотелось, поэтому было решено написать собственный плагин.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=cm>/*{{{*/</span>
<span class=nx>version</span><span class=p>.</span><span class=nx>extensions</span><span class=p>.</span><span class=nx>faviconLinkMacro</span> <span class=o>=</span> <span class=p>{</span><span class=nx>major</span><span class=o>:</span> <span class=mi>0</span><span class=p>,</span> <span class=nx>minor</span><span class=o>:</span> <span class=mi>1</span><span class=p>,</span> <span class=nx>revision</span><span class=o>:</span> <span class=mi>0</span><span class=p>,</span> <span class=nx>date</span><span class=o>:</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>(</span><span class=mi>2010</span><span class=p>,</span><span class=mi>3</span><span class=p>,</span><span class=mi>21</span><span class=p>)};</span>
<span class=c1>// Author: Oleg Atamanenko
</span><span class=c1></span><span class=nx>config</span><span class=p>.</span><span class=nx>macros</span><span class=p>.</span><span class=nx>faviconLink</span> <span class=o>=</span> <span class=p>{}</span>
<span class=nx>config</span><span class=p>.</span><span class=nx>macros</span><span class=p>.</span><span class=nx>faviconLink</span><span class=p>.</span><span class=nx>handler</span> <span class=o>=</span> <span class=kd>function</span><span class=p>(</span><span class=nx>place</span><span class=p>,</span> <span class=nx>macroName</span><span class=p>,</span>  <span class=nx>params</span><span class=p>,</span> <span class=nx>wikifier</span><span class=p>,</span> <span class=nx>paramString</span><span class=p>)</span> <span class=p>{</span>
  <span class=kd>var</span> <span class=nx>linkBox</span> <span class=o>=</span> <span class=nx>createTiddlyElement</span><span class=p>(</span><span class=nx>place</span><span class=p>,</span> <span class=o>&amp;</span><span class=nx>quot</span><span class=p>;</span><span class=nx>span</span><span class=o>&amp;</span><span class=nx>quot</span><span class=p>;,</span> <span class=kc>null</span><span class=p>,</span> <span class=o>&amp;</span><span class=nx>quot</span><span class=p>;</span><span class=nx>favIcon</span><span class=o>&amp;</span><span class=nx>quot</span><span class=p>;,</span> <span class=o>&amp;</span><span class=nx>quot</span><span class=p>;</span><span class=o>&amp;</span><span class=nx>quot</span><span class=p>;);</span>

  <span class=kd>var</span> <span class=nx>args</span> <span class=o>=</span> <span class=nx>paramString</span><span class=p>.</span><span class=nx>parseParams</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>quot</span><span class=p>;</span><span class=nx>list</span><span class=o>&amp;</span><span class=nx>quot</span><span class=p>;,</span><span class=kc>null</span><span class=p>,</span><span class=kc>true</span><span class=p>);</span>
  <span class=kd>var</span> <span class=nx>link</span> <span class=o>=</span> <span class=nx>getParam</span><span class=p>(</span><span class=nx>args</span><span class=p>,</span> <span class=o>&amp;</span><span class=nx>quot</span><span class=p>;</span><span class=nx>link</span><span class=o>&amp;</span><span class=nx>quot</span><span class=p>;,</span> <span class=s1>&#39;false&#39;</span><span class=p>);</span>

  <span class=k>if</span> <span class=p>(</span><span class=nx>link</span> <span class=o>!=</span> <span class=s1>&#39;false&#39;</span><span class=p>){</span>
    <span class=nx>urlParts</span> <span class=o>=</span> <span class=nx>link</span><span class=p>.</span><span class=nx>split</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=p>);</span>
    <span class=nx>imgLink</span> <span class=o>=</span> <span class=nx>urlParts</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>+</span> <span class=o>&amp;</span><span class=nx>quot</span><span class=p>;</span><span class=c1>//&amp;quot; + urlParts[2] + &amp;quot;/favicon.ico&amp;quot;;
</span><span class=c1></span>
    <span class=kd>var</span> <span class=nx>imgElement</span> <span class=o>=</span> <span class=nx>createTiddlyElement</span><span class=p>(</span><span class=nx>linkBox</span><span class=p>,</span> <span class=o>&amp;</span><span class=nx>quot</span><span class=p>;</span><span class=nx>img</span><span class=o>&amp;</span><span class=nx>quot</span><span class=p>;,</span> <span class=kc>null</span><span class=p>,</span> <span class=o>&amp;</span><span class=nx>quot</span><span class=p>;</span><span class=nx>faviconImage</span><span class=o>&amp;</span><span class=nx>quot</span><span class=p>;,</span> <span class=o>&amp;</span><span class=nx>quot</span><span class=p>;</span><span class=o>&amp;</span><span class=nx>quot</span><span class=p>;);</span>
    <span class=nx>imgElement</span><span class=p>.</span><span class=nx>src</span> <span class=o>=</span> <span class=nx>imgLink</span><span class=p>;</span>
    <span class=nx>imgElement</span><span class=p>.</span><span class=nx>width</span> <span class=o>=</span> <span class=mi>16</span><span class=p>;</span>
    <span class=nx>imgElement</span><span class=p>.</span><span class=nx>height</span> <span class=o>=</span> <span class=mi>16</span><span class=p>;</span>

    <span class=kd>var</span> <span class=nx>linkTitle</span> <span class=o>=</span> <span class=nx>getParam</span><span class=p>(</span><span class=nx>args</span><span class=p>,</span> <span class=o>&amp;</span><span class=nx>quot</span><span class=p>;</span><span class=nx>title</span><span class=o>&amp;</span><span class=nx>quot</span><span class=p>;,</span> <span class=s1>&#39;false&#39;</span><span class=p>);</span>

    <span class=k>if</span><span class=p>(</span><span class=nx>linkTitle</span> <span class=o>==</span> <span class=s1>&#39;false&#39;</span><span class=p>){</span>
      <span class=nx>linkTitle</span> <span class=o>=</span> <span class=nx>link</span><span class=p>;</span>
    <span class=p>}</span>
    <span class=kd>var</span> <span class=nx>linkElement</span> <span class=o>=</span> <span class=nx>createTiddlyElement</span><span class=p>(</span><span class=nx>linkBox</span><span class=p>,</span> <span class=o>&amp;</span><span class=nx>quot</span><span class=p>;</span><span class=nx>a</span><span class=o>&amp;</span><span class=nx>quot</span><span class=p>;,</span> <span class=kc>null</span><span class=p>,</span> <span class=o>&amp;</span><span class=nx>quot</span><span class=p>;</span><span class=nx>faviconLink</span><span class=o>&amp;</span><span class=nx>quot</span><span class=p>;,</span> <span class=nx>linkTitle</span><span class=p>);</span>
    <span class=nx>linkElement</span><span class=p>.</span><span class=nx>href</span> <span class=o>=</span> <span class=nx>link</span><span class=p>;</span>
    <span class=nx>linkElement</span><span class=p>.</span><span class=nx>target</span> <span class=o>=</span> <span class=s1>&#39;_blank&#39;</span><span class=p>;</span>
  <span class=p>}</span>
<span class=p>}</span>

<span class=cm>/*}&amp;nbsp;}&amp;nbsp;}*/</span>
</code></pre></div><h4> Установка плагина</h4>
<ol><li>Создаём новый тиддлер, называем его faviconLinkMacro</li>
<li>Помечаем тиддлер тегом systemConfig, тогда TiddlyWiki при открытии страницы его подгрузит.</li>
</ol>
<h4>Использование плагина</h4>
<ol><li>Плагин создаёт новый макрос, faviconLink, с двумя параметрами link и title.</li>
<li>Вызов <tt>&lt;&lt;faviconLink link:'https://mail.google.com/mail' title:'mail'>></tt> создаёт ссылку с картинкой с GMail</li>
</ol>
<a onblur=try{parent.deselectBloggerImageGracefully()}catch(a){} href=http://1.bp.blogspot.com/_y8p0_dtMJ38/S6Y0qnki7nI/AAAAAAAAA9A/Ic3skFoirY8/s1600-h/favicon-sample.png><img style="display:block;margin:0 auto 10px;text-align:center;cursor:pointer;cursor:hand;width:161px;height:64px" src=http://1.bp.blogspot.com/_y8p0_dtMJ38/S6Y0qnki7nI/AAAAAAAAA9A/Ic3skFoirY8/s400/favicon-sample.png border=0 alt id=BLOGGER_PHOTO_ID_5451102305759981170></a>
<h4>Настройка визульных стилей плагина</h4>
<p>Макрос создаёт следующие классы:</p>
<ol><li>span.favIcon</li>
<li>img.faviconImage</li>
<li>a.faviconLink</li>
</ol>
<h4> Пример стилей</h4>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-css data-lang=css><span class=p>.</span><span class=nc>links</span> <span class=nt>span</span> <span class=p>{</span>
  <span class=k>display</span><span class=p>:</span> <span class=kc>block</span><span class=p>;</span>
  <span class=k>position</span><span class=p>:</span> <span class=kc>relative</span><span class=p>;</span>
  <span class=k>padding</span><span class=p>:</span> <span class=mf>0.7</span><span class=kt>em</span><span class=p>;</span>
  <span class=k>margin</span><span class=p>:</span> <span class=mf>0.3</span><span class=kt>em</span><span class=p>;</span>
  <span class=k>min-width</span><span class=p>:</span> <span class=mi>6</span><span class=kt>em</span><span class=p>;</span>
  <span class=k>float</span><span class=p>:</span><span class=kc>left</span><span class=p>;</span>
  <span class=k>text-align</span><span class=p>:</span> <span class=kc>center</span><span class=p>;</span>
  <span class=k>font-weight</span><span class=p>:</span> <span class=kc>bold</span><span class=p>;</span>
  <span class=k>font-size</span><span class=p>:</span> <span class=mf>1.5</span><span class=kt>em</span><span class=p>;</span>
  <span class=k>font-family</span><span class=p>:</span> <span class=o>&amp;</span><span class=n>quot</span><span class=p>;</span><span class=err>Gill</span> <span class=err>Sans</span> <span class=err>MT&amp;quot</span><span class=p>;</span><span class=err>,</span> <span class=err>&amp;quot</span><span class=p>;</span><span class=err>Candara&amp;quot</span><span class=p>;</span><span class=err>,</span> <span class=err>&amp;quot</span><span class=p>;</span><span class=err>Arial&amp;quot</span><span class=p>;;</span>
  <span class=k>border</span><span class=p>:</span> <span class=mi>2</span><span class=kt>px</span> <span class=kc>solid</span> <span class=p>[[</span><span class=n>ColorPalette</span><span class=o>::</span><span class=n>SecondaryLight</span><span class=p>]];</span>
  <span class=k>background-color</span><span class=p>:</span> <span class=p>[[</span><span class=n>ColorPalette</span><span class=o>::</span><span class=n>SecondaryPale</span><span class=p>]];</span>
<span class=p>}</span>

<span class=p>.</span><span class=nc>links</span> <span class=nt>span</span><span class=p>:</span><span class=nd>hover</span> <span class=p>{</span>
  <span class=k>border</span><span class=p>:</span> <span class=mi>2</span><span class=kt>px</span> <span class=kc>solid</span> <span class=p>[[</span><span class=n>ColorPalette</span><span class=o>::</span><span class=n>SecondaryMid</span><span class=p>]];</span>
  <span class=k>background-color</span><span class=p>:</span> <span class=p>[[</span><span class=n>ColorPalette</span><span class=o>::</span><span class=n>SecondaryLight</span><span class=p>]];</span>
  <span class=k>color</span><span class=p>:</span> <span class=p>[[</span><span class=n>ColorPalette</span><span class=o>::</span><span class=n>PrimaryMid</span><span class=p>]];</span>
<span class=p>}</span>

<span class=p>.</span><span class=nc>links</span> <span class=nt>img</span><span class=p>.</span><span class=nc>faviconImage</span> <span class=p>{</span>
  <span class=k>position</span><span class=p>:</span> <span class=kc>relative</span><span class=p>;</span>
  <span class=k>padding-right</span><span class=p>:</span> <span class=mi>10</span><span class=kt>px</span><span class=p>;</span>
<span class=p>}</span>

</code></pre></div><p> Данный CSS необходимо добавить в тиддлер с именем StyleSheet</p>
<h4>Пример тиддлера со ссылками</h4>
```html
{{links{
&lt;&lt;faviconLink link:'http://delicious.com/dark.schakal/2read' title:'2read'>> &lt;&lt;faviconLink link:'https://mail.google.com/mail' title:'mail'>> &lt;&lt;faviconLink link:'http://www.google.com/reader/view' title:'rss'>> &lt;&lt;faviconLink link:'http://atamanenko.blogspot.com/' title:'blog'>> &lt;&lt;faviconLink link:'http://feedburner.google.com/fb/a/myfeeds' title:'feedburner'>> &lt;&lt;faviconLink link:'https://www.google.com/analytics/settings/' title:'analytics'>> &lt;&lt;faviconLink link:'http://wave.google.com' title:'wave'>> &lt;&lt;faviconLink link:'http://www.blogger.com/home' title:'blogger'>> &lt;&lt;faviconLink link:'http://twitter.com/' title:'twitter'>> &lt;&lt;faviconLink link:'https://www.dropbox.com/home#/' title:'dropbox'>> &lt;&lt;faviconLink link:'http://translate.google.com/toolkit/' title:'translator'>> &lt;&lt;faviconLink link:'http://sibir.megafon.ru/sendsms/' title:'SendSMS'>>
}}}
```
Вышеприведённый код тиддлера создаёт следующую страницу:
<p><a onblur=try{parent.deselectBloggerImageGracefully()}catch(a){} href=http://1.bp.blogspot.com/_y8p0_dtMJ38/S6Y0qOLAO4I/AAAAAAAAA84/DFkORdMO8gE/s1600-h/favicon-sample-big.png>&lt;img style=&ldquo;display:block; margin:0px auto 10px; text-align:center;cursor:pointer; cursor:hand;width: 400px; height: 157px;&rdquo; src=&ldquo;<a href=http://1.bp.blogspot.com/_y8p0_dtMJ38/S6Y0qOLAO4I/AAAAAAAAA84/DFkORdMO8gE/s400/favicon-sample-big.png%22>http://1.bp.blogspot.com/_y8p0_dtMJ38/S6Y0qOLAO4I/AAAAAAAAA84/DFkORdMO8gE/s400/favicon-sample-big.png"</a> border=&ldquo;0&rdquo; alt=&ldquo;&ldquo;id=&ldquo;BLOGGER_PHOTO_ID_5451102298941963138&rdquo; /></a></p>
</div>
<footer>
<div class=social>
<ul>
<li class=sidebar-nav-item><a target=_blank href=https://github.com/uthark/ title=https://github.com/uthark/><i class="fa fa-github fa-2x"></i></a>
</li>
<li class=sidebar-nav-item> <a target=_blank href=https://bitbucket.org/uthark/ title=https://bitbucket.org/uthark/><i class="fa fa-bitbucket fa-2x"></i></a>
<li class=sidebar-nav-item><a target=_blank href=https://twitter.com/real_atamanenko title=https://twitter.com/real_atamanenko><i class="fa fa-twitter fa-2x"></i></a>
<li class=sidebar-nav-item><a target=_blank href=https://keybase.io/uthark/ title=https://keybase.io/uthark/><i class="fa fa-key fa-2x"></i></a>
<li class=sidebar-nav-item><a target=_blank href=http://stackoverflow.com/users/216764/uthark title=http://stackoverflow.com/users/216764/uthark><i class="fa fa-stack-overflow fa-2x"></i></a>
</li>
<li><a href=https://feeds.feedburner.com/atamanenko target=_blank type=application/rss+xml title=RSS><i class="fa fa-rss-square fa-2x"></i></a></li>
</ul>
</div>
<p>&copy;&nbsp;2009&nbsp;—&nbsp;2021 Oleg Atamanenko - <a href=https://uthark.github.io/license/>CC&nbsp;BY-SA&nbsp;4.0</a>
</p>
</footer>
<script>var _gaq=[['_setAccount','UA-8688665-1'],['_trackPageview']];(function(b,c){var d=b.createElement(c),a=b.getElementsByTagName(c)[0];a.async='async',d.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js',a.parentNode.insertBefore(d,a)})(document,'script')</script>
</body>
</html>
</body>
</html>