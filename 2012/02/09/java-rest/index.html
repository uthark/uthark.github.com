<!DOCTYPE html>
<html prefix="og: https://ogp.me/ns#" lang="en">
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">

    
        <link rel="canonical" href="https://uthark.github.io/2012/02/09/java-rest/">
    

    
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="viewport" content="width=device-width,minimum-scale=1,maximum-scale=5">

    
    <title>Разработка и тестирование Java REST веб-сервисов</title>

    <meta name="description"
          content="">
    <meta name="keywords"
          content="">

    <meta name="author" content="Oleg Atamanenko">


    <link rel="stylesheet" media="screen" href="https://fonts.googleapis.com/css2?family=Lora:wght@500&family=Source+Code+Pro:wght@300&family=Bitter&display=swap" type="text/css"/>

    
    
    
    <link rel="stylesheet" href="https://uthark.github.io/css/theme.f98ae173ea806bb32a531ccc162d9ad4120465789080cf2bdb4f6fa2214f0e68.css">
    <link rel="stylesheet" href="https://uthark.github.io/css/uthark.css">


    
    

    
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css">

    
    <link href="https://uthark.github.io/favicon.png" rel="icon">

    
    
    


    


    
        <link href="https://feeds.feedburner.com/atamanenko" rel="alternate" type="application/rss+xml" title="Sharing knowledge"/>
    

    
  
  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="@real_atamanenko">
  <meta name="twitter:creator" content="@real_atamanenko">

  <meta name="twitter:title" content="Разработка и тестирование Java REST веб-сервисов">

  

  <meta property="og:title" content="Разработка и тестирование Java REST веб-сервисов" />
  <meta property="og:url" content="https://uthark.github.io/2012/02/09/java-rest/" />
  <meta property="og:description" content="Введение Для разработки REST веб-сервисов Java предлагает JSR-311 - JAX-RS: The Java&trade; API for RESTful Web Services Как это обычно бывает в мире Enterprise Java, существует несколько реализаций данной спецификации:  Jersey - это эталонная реализация спецификации от компании Sun Oracle Apache CXF JBoss RESTEasy  На примере последней реализации, я и расскажу, каким образом можно написать REST-сервис." />

  




</head>
<body>

<header class="site">
    
    <h1><a href="https://uthark.github.io/">Sharing knowledge</a></h1>
    <h2>by Oleg Atamanenko</h2>
</header>


<nav>
<div class="menu">
  <input type="checkbox" id="menu" class="fa fa-bars">
  <label for="menu" aria-label="Menu"></label>

  <div class="menu-container">

<ul class="main-navigation">
  
  
    
      <li><a href="https://uthark.github.io/" title="Posts">Posts</a></li>
    
  
    
      <li><a href="https://uthark.github.io/usefularticles/" title="Links" >Links</a></li>
    
  
    
      <li><a href="https://uthark.github.io/categories/" title="Categories" >Categories</a></li>
    
  
    
      <li><a href="https://uthark.github.io/readinglist/" title="Reading Lists" >Reading Lists</a></li>
    
  
    
      <li><a href="https://uthark.github.io/about/" title="About" >About</a></li>
    
  
</ul>


<ul class="subscription">
    
        
            
            
                <li><a href="https://feeds.feedburner.com/atamanenko" target="_blank" type="application/rss+xml" title="RSS"><i class="fa fa-rss-square fa-lg"></i></a></li>
            

        
    

</ul>



<form action="https://www.google.com/search" method="get" target="_blank">
  <fieldset role="search">
  	<input class="search" type="text" name="q" placeholder="Search"/>
    <input type="hidden" name="q" value="site:https://uthark.github.io/" />
  </fieldset>
</form>

</div>
</div>
</nav>


<div id="main">
  <div id="content">
    <div>
      <article class="hentry">

        
        

<header>
    <h1 class="entry-title">
         Разработка и тестирование Java REST веб-сервисов 
    </h1>

</header>


        <div class="entry-content">
          
          
          
          
          <h4>Введение</h4>
Для разработки <a href="http://restpatterns.org/">REST</a> веб-сервисов Java предлагает <a href="http://jcp.org/en/jsr/detail?id=311">JSR-311 - JAX-RS: The Java&trade; API for RESTful Web Services</a>
Как это обычно бывает в мире Enterprise Java, существует несколько реализаций данной спецификации:
<ul>
<li><a href="http://jersey.java.net/">Jersey</a> - это эталонная реализация спецификации от компании <strike>Sun</strike> Oracle</li>
<li><a href="http://cxf.apache.org/">Apache CXF</a></li>
<li><a href="http://www.jboss.org/resteasy">JBoss RESTEasy</a></li>
</ul>
На примере последней реализации, я и расскажу, каким образом можно написать REST-сервис.
<h4>Пишем REST-сервис</h4>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java">
<span class="kn">import</span> <span class="nn">javax.ws.rs.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.ws.rs.core.MediaType</span><span class="o">;</span>

<span class="nd">@Path</span><span class="o">(</span><span class="s">&#34;/service/entity&#34;</span><span class="o">)</span>
<span class="nd">@Produces</span><span class="o">({</span><span class="n">MediaType</span><span class="o">.</span><span class="na">APPLICATION_XML</span><span class="o">,</span> <span class="n">MediaType</span><span class="o">.</span><span class="na">APPLICATION_JSON</span><span class="o">})</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">EntityRestService</span> <span class="o">{</span>

 <span class="nd">@GET</span>
 <span class="nd">@Path</span><span class="o">(</span><span class="s">&#34;/all&#34;</span><span class="o">)</span>
 <span class="n">EntityList</span> <span class="nf">listAll</span><span class="o">();</span>

 <span class="nd">@GET</span>
 <span class="nd">@Path</span><span class="o">(</span><span class="s">&#34;/{id}&#34;</span><span class="o">)</span>
 <span class="n">Entity</span> <span class="nf">findById</span><span class="o">(</span><span class="nd">@PathParam</span><span class="o">(</span><span class="s">&#34;id&#34;</span><span class="o">)</span> <span class="n">Integer</span> <span class="n">id</span><span class="o">);</span>


<span class="o">}</span>
</code></pre></div><p>Создаём интерфейс, в котором расставляем JAX-RS аннотации. Аннотация <a href="http://jsr311.java.net/nonav/releases/1.1/javax/ws/rs/Path.html">@Path</a> указывает путь, по которому будет доступен наш сервис. Аннотация <a href="http://jsr311.java.net/nonav/releases/1.1/javax/ws/rs/GET.html">@GET</a> определяет, какой HTTP-запрос будет обрабатываться данным методом. Аннотация <a href="http://jsr311.java.net/nonav/releases/1.1/javax/ws/rs/Produces.html">@Produces</a> позволяет указать, в каком формате данный сервис предоставляет результаты.</p>
<h4>Конфигурация JBoss RESTEasy</h4>
<p>Конфигурация очень проста, во-первых, нам нужно добавить обновить <tt>pom.xml</tt> и добавить необходимые зависимости:</p>
<h5>Обновляем <tt>pom.xml</tt></h5>
<p>Добавляем compile-time зависимость на JAX-RS API</p>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="ni">&amp;lt;</span>dependency<span class="ni">&amp;gt;</span>
    <span class="ni">&amp;lt;</span>groupId<span class="ni">&amp;gt;</span>org.jboss.resteasy<span class="ni">&amp;lt;</span>/groupId<span class="ni">&amp;gt;</span>
    <span class="ni">&amp;lt;</span>artifactId<span class="ni">&amp;gt;</span>jaxrs-api<span class="ni">&amp;lt;</span>/artifactId<span class="ni">&amp;gt;</span>
<span class="ni">&amp;lt;</span>/dependency<span class="ni">&amp;gt;</span>
</code></pre></div><p>и runtime зависимости на реализацию</p>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="ni">&amp;lt;</span>dependency<span class="ni">&amp;gt;</span>
    <span class="ni">&amp;lt;</span>groupId<span class="ni">&amp;gt;</span>org.jboss.resteasy<span class="ni">&amp;lt;</span>/groupId<span class="ni">&amp;gt;</span>
    <span class="ni">&amp;lt;</span>artifactId<span class="ni">&amp;gt;</span>resteasy-jaxrs<span class="ni">&amp;lt;</span>/artifactId<span class="ni">&amp;gt;</span>
    <span class="ni">&amp;lt;</span>version<span class="ni">&amp;gt;</span>${resteasy-jaxrs.version}<span class="ni">&amp;lt;</span>/version<span class="ni">&amp;gt;</span>
    <span class="ni">&amp;lt;</span>scope<span class="ni">&amp;gt;</span>runtime<span class="ni">&amp;lt;</span>/scope<span class="ni">&amp;gt;</span>
<span class="ni">&amp;lt;</span>/dependency<span class="ni">&amp;gt;</span>
<span class="ni">&amp;lt;</span>dependency<span class="ni">&amp;gt;</span>
    <span class="ni">&amp;lt;</span>groupId<span class="ni">&amp;gt;</span>org.jboss.resteasy<span class="ni">&amp;lt;</span>/groupId<span class="ni">&amp;gt;</span>
    <span class="ni">&amp;lt;</span>artifactId<span class="ni">&amp;gt;</span>resteasy-jackson-provider<span class="ni">&amp;lt;</span>/artifactId<span class="ni">&amp;gt;</span>
    <span class="ni">&amp;lt;</span>version<span class="ni">&amp;gt;</span>${resteasy-jaxrs.version}<span class="ni">&amp;lt;</span>/version<span class="ni">&amp;gt;</span>
    <span class="ni">&amp;lt;</span>scope<span class="ni">&amp;gt;</span>runtime<span class="ni">&amp;lt;</span>/scope<span class="ni">&amp;gt;</span>
<span class="ni">&amp;lt;</span>/dependency<span class="ni">&amp;gt;</span>

</code></pre></div><h5>Обновляем конфигурацию веб-приложения в <tt>web.xml</tt></h5>
Необходимо выполнить следующую модификацию <tt>web.xml</tt>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"> <span class="ni">&amp;lt;</span>listener<span class="ni">&amp;gt;</span>
  <span class="ni">&amp;lt;</span>listener-class<span class="ni">&amp;gt;</span>org.jboss.resteasy.plugins.server.servlet.ResteasyBootstrap<span class="ni">&amp;lt;</span>/listener-class<span class="ni">&amp;gt;</span>
 <span class="ni">&amp;lt;</span>/listener<span class="ni">&amp;gt;</span>

 <span class="ni">&amp;lt;</span>context-param<span class="ni">&amp;gt;</span>
  <span class="ni">&amp;lt;</span>param-name<span class="ni">&amp;gt;</span>resteasy.servlet.mapping.prefix<span class="ni">&amp;lt;</span>/param-name<span class="ni">&amp;gt;</span>
  <span class="ni">&amp;lt;</span>param-value<span class="ni">&amp;gt;</span>/rest<span class="ni">&amp;lt;</span>/param-value<span class="ni">&amp;gt;</span>
 <span class="ni">&amp;lt;</span>/context-param<span class="ni">&amp;gt;</span>
 <span class="ni">&amp;lt;</span>servlet<span class="ni">&amp;gt;</span>
  <span class="ni">&amp;lt;</span>servlet-name<span class="ni">&amp;gt;</span>REST Easy<span class="ni">&amp;lt;</span>/servlet-name<span class="ni">&amp;gt;</span>
  <span class="ni">&amp;lt;</span>servlet-class<span class="ni">&amp;gt;</span>org.jboss.resteasy.plugins.server.servlet.HttpServletDispatcher<span class="ni">&amp;lt;</span>/servlet-class<span class="ni">&amp;gt;</span>
 <span class="ni">&amp;lt;</span>/servlet<span class="ni">&amp;gt;</span>
 <span class="ni">&amp;lt;</span>servlet-mapping<span class="ni">&amp;gt;</span>
  <span class="ni">&amp;lt;</span>servlet-name<span class="ni">&amp;gt;</span>REST Easy<span class="ni">&amp;lt;</span>/servlet-name<span class="ni">&amp;gt;</span>
  <span class="ni">&amp;lt;</span>url-pattern<span class="ni">&amp;gt;</span>/rest/*<span class="ni">&amp;lt;</span>/url-pattern<span class="ni">&amp;gt;</span>
 <span class="ni">&amp;lt;</span>/servlet-mapping<span class="ni">&amp;gt;</span>
</code></pre></div><p>Данный код объявляет <a href="http://docs.jboss.org/resteasy/docs/2.3.1.GA/javadocs/org/jboss/resteasy/plugins/server/servlet/HttpServletDispatcher.html">сервлет HttpServletDispatcher</a>, который будет обрабатывать все запросы, которые приходят на <tt>/rest/*</tt>. Слушатель <tt><a href="http://docs.jboss.org/resteasy/docs/2.3.1.GA/javadocs/org/jboss/resteasy/plugins/server/servlet/ResteasyBootstrap.html">ResteasyBootstrap</a></tt> выполняет всю необходимую инициализацию JBoss RESTEasy.</p>
<h5>Поддержка Spring</h5>
Для того, чтобы использовать <a href="http://www.springsource.org/spring-framework">Spring Framework</a>, нам необходимо сделать следующие изменения:
<ol>
<li>Добавить зависимость в <tt>pom.xml</tt></li>
</ol>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="ni">&amp;lt;</span>dependency<span class="ni">&amp;gt;</span>
    <span class="ni">&amp;lt;</span>groupId<span class="ni">&amp;gt;</span>org.jboss.resteasy<span class="ni">&amp;lt;</span>/groupId<span class="ni">&amp;gt;</span>
    <span class="ni">&amp;lt;</span>artifactId<span class="ni">&amp;gt;</span>resteasy-spring<span class="ni">&amp;lt;</span>/artifactId<span class="ni">&amp;gt;</span>
    <span class="ni">&amp;lt;</span>version<span class="ni">&amp;gt;</span>${resteasy-jaxrs.version}<span class="ni">&amp;lt;</span>/version<span class="ni">&amp;gt;</span>
    <span class="ni">&amp;lt;</span>scope<span class="ni">&amp;gt;</span>runtime<span class="ni">&amp;lt;</span>/scope<span class="ni">&amp;gt;</span>
<span class="ni">&amp;lt;</span>/dependency<span class="ni">&amp;gt;</span>
</code></pre></div><ol start="2">
<li>Добавить Spring-ового слушателя в <tt>web.xml</tt></li>
</ol>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"> <span class="ni">&amp;lt;</span>listener<span class="ni">&amp;gt;</span>
  <span class="ni">&amp;lt;</span>listener-class<span class="ni">&amp;gt;</span>org.jboss.resteasy.plugins.spring.SpringContextLoaderListener<span class="ni">&amp;lt;</span>/listener-class<span class="ni">&amp;gt;</span>
 <span class="ni">&amp;lt;</span>/listener<span class="ni">&amp;gt;</span>

</code></pre></div><p>После этих изменений JBoss RESTEasy будет в курсе про Spring, это позволит в реализации REST-сервисов полноценно использовать все возможности, предоставляемые Spring Framework.</p>
<h4>Пишем тесты</h4>
Написание тестов - весьма полезная вещь, ниже я покажу пример теста для REST-сервиса.
В рамках данного теста у нас будет подниматься <a href="http://docs.jboss.org/resteasy/docs/2.3.1.GA/javadocs/org/jboss/resteasy/plugins/server/tjws/TJWSEmbeddedJaxrsServer.html">встраиваемый веб-сервер TJWSEmbeddedJaxrsServer</a>, к которому мы будем обращаться для тестирования наших REST-сервисов.
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java">
<span class="nd">@RunWith</span><span class="o">(</span><span class="n">SpringJUnit4ClassRunner</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="nd">@ContextConfiguration</span><span class="o">({</span><span class="s">&#34;/applicationContext-test.xml&#34;</span><span class="o">})</span>
<span class="nd">@TestExecutionListeners</span><span class="o">({</span><span class="n">DependencyInjectionTestExecutionListener</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">DirtiesContextTestExecutionListener</span><span class="o">.</span><span class="na">class</span><span class="o">})</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TestEntityServiceRest</span> <span class="o">{</span>

 <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">PORT</span> <span class="o">=</span> <span class="n">8081</span><span class="o">;</span>
 <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">BASE_URL</span> <span class="o">=</span> <span class="s">&#34;http://localhost:&#34;</span> <span class="o">+</span> <span class="n">PORT</span><span class="o">;</span>

 <span class="nd">@Autowired</span>
 <span class="n">EntityService</span> <span class="n">entityService</span><span class="o">;</span>

 <span class="nd">@Autowired</span>
 <span class="n">ConfigurableApplicationContext</span> <span class="n">applicationContext</span><span class="o">;</span>


 <span class="kd">protected</span> <span class="n">HttpClient</span> <span class="n">client</span><span class="o">;</span>
 <span class="kd">protected</span> <span class="n">TJWSEmbeddedJaxrsServer</span> <span class="n">server</span><span class="o">;</span>


 <span class="nd">@Before</span>
 <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setUpClient</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
  <span class="n">client</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultHttpClient</span><span class="o">();</span>
 <span class="o">}</span>

 <span class="nd">@Before</span>
 <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setUpServer</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
  <span class="n">server</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TJWSEmbeddedJaxrsServer</span><span class="o">();</span>
  <span class="n">server</span><span class="o">.</span><span class="na">setPort</span><span class="o">(</span><span class="n">PORT</span><span class="o">);</span>
  <span class="n">ResteasyDeployment</span> <span class="n">deployment</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="na">getDeployment</span><span class="o">();</span>

  <span class="n">server</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>

  <span class="n">Dispatcher</span> <span class="n">dispatcher</span> <span class="o">=</span> <span class="n">deployment</span><span class="o">.</span><span class="na">getDispatcher</span><span class="o">();</span>
  <span class="n">SpringBeanProcessor</span> <span class="n">processor</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SpringBeanProcessor</span><span class="o">(</span><span class="n">dispatcher</span><span class="o">,</span> <span class="n">deployment</span><span class="o">.</span><span class="na">getRegistry</span><span class="o">(),</span> <span class="n">deployment</span><span class="o">.</span><span class="na">getProviderFactory</span><span class="o">());</span>
  <span class="n">applicationContext</span><span class="o">.</span><span class="na">addBeanFactoryPostProcessor</span><span class="o">(</span><span class="n">processor</span><span class="o">);</span>

  <span class="n">SpringResourceFactory</span> <span class="n">noDefaults</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SpringResourceFactory</span><span class="o">(</span>
    <span class="s">&#34;entityServiceRestImpl&#34;</span><span class="o">,</span> <span class="n">applicationContext</span><span class="o">,</span> <span class="n">EntityRestServiceImpl</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
  <span class="n">dispatcher</span><span class="o">.</span><span class="na">getRegistry</span><span class="o">().</span><span class="na">addResourceFactory</span><span class="o">(</span><span class="n">noDefaults</span><span class="o">);</span>
 <span class="o">}</span>

 <span class="nd">@After</span>
 <span class="kd">public</span> <span class="kt">void</span> <span class="nf">stop</span><span class="o">()</span> <span class="o">{</span>
  <span class="n">server</span><span class="o">.</span><span class="na">stop</span><span class="o">();</span>
 <span class="o">}</span>

 <span class="nd">@Test</span>
 <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testListAll</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>

  <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
  <span class="kd">final</span> <span class="n">List</span><span class="o">&amp;</span><span class="n">lt</span><span class="o">;</span><span class="n">Entity</span><span class="o">&amp;</span><span class="n">gt</span><span class="o">;</span> <span class="n">returnedList</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&amp;</span><span class="n">lt</span><span class="o">;</span><span class="n">Entity</span><span class="o">&amp;</span><span class="n">gt</span><span class="o">;();</span>
  <span class="kt">int</span> <span class="n">EXPECTED_SIZE</span> <span class="o">=</span> <span class="n">6</span><span class="o">;</span>
  <span class="k">while</span> <span class="o">(</span><span class="n">i</span> <span class="o">&amp;</span><span class="n">lt</span><span class="o">;</span> <span class="n">EXPECTED_SIZE</span><span class="o">)</span> <span class="o">{</span>
   <span class="n">i</span><span class="o">++;</span>
   <span class="kd">final</span> <span class="n">Entity</span> <span class="n">entity</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Entity</span><span class="o">();</span>
   <span class="n">entity</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
   <span class="n">entity</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">&#34;test&#34;</span> <span class="o">+</span> <span class="n">i</span><span class="o">);</span>
   <span class="n">returnedList</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">entity</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="n">when</span><span class="o">(</span><span class="n">entityService</span><span class="o">.</span><span class="na">findAll</span><span class="o">()).</span><span class="na">thenReturn</span><span class="o">(</span><span class="n">returnedList</span><span class="o">);</span>


  <span class="n">HttpGet</span> <span class="n">get</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HttpGet</span><span class="o">(</span><span class="n">BASE_URL</span> <span class="o">+</span> <span class="s">&#34;/service/entity/&#34;</span><span class="o">);</span>

  <span class="n">HttpResponse</span> <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">get</span><span class="o">);</span>
  <span class="n">InputStream</span> <span class="n">content</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getEntity</span><span class="o">().</span><span class="na">getContent</span><span class="o">();</span>

  <span class="n">EntityList</span> <span class="n">result</span> <span class="o">=</span> <span class="n">fromString</span><span class="o">(</span><span class="n">EntityList</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">content</span><span class="o">);</span>
  <span class="n">content</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>

  <span class="n">Assert</span><span class="o">.</span><span class="na">assertNotNull</span><span class="o">(</span><span class="n">result</span><span class="o">);</span>
  <span class="n">Assert</span><span class="o">.</span><span class="na">assertEquals</span><span class="o">(</span><span class="n">EXPECTED_SIZE</span><span class="o">,</span> <span class="n">result</span><span class="o">.</span><span class="na">getEntities</span><span class="o">().</span><span class="na">size</span><span class="o">());</span>
 <span class="o">}</span>

 <span class="nd">@Test</span>
 <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testFindById</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>

  <span class="kd">final</span> <span class="n">Entity</span> <span class="n">validEntity</span> <span class="o">=</span> <span class="n">getValidEntity</span><span class="o">();</span>
  <span class="n">validEntity</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="n">2</span><span class="o">);</span>

  <span class="n">when</span><span class="o">(</span><span class="n">entityService</span><span class="o">.</span><span class="na">findById</span><span class="o">(</span><span class="n">validEntity</span><span class="o">.</span><span class="na">getId</span><span class="o">())).</span><span class="na">thenAnswer</span><span class="o">(</span><span class="k">new</span> <span class="n">Answer</span><span class="o">&amp;</span><span class="n">lt</span><span class="o">;</span><span class="n">Object</span><span class="o">&amp;</span><span class="n">gt</span><span class="o">;()</span> <span class="o">{</span>
   <span class="nd">@Override</span>
   <span class="kd">public</span> <span class="n">Object</span> <span class="nf">answer</span><span class="o">(</span><span class="n">InvocationOnMock</span> <span class="n">invocation</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Throwable</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">validEntity</span><span class="o">;</span>
   <span class="o">}</span>
  <span class="o">});</span>

  <span class="n">HttpGet</span> <span class="n">get</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HttpGet</span><span class="o">(</span><span class="n">BASE_URL</span> <span class="o">+</span> <span class="s">&#34;/service/entity/2&#34;</span><span class="o">);</span>

  <span class="n">HttpResponse</span> <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">get</span><span class="o">);</span>
  <span class="n">InputStream</span> <span class="n">content</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getEntity</span><span class="o">().</span><span class="na">getContent</span><span class="o">();</span>

  <span class="n">Entity</span> <span class="n">result</span> <span class="o">=</span> <span class="n">fromString</span><span class="o">(</span><span class="n">Entity</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">content</span><span class="o">);</span>
  <span class="n">content</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>

  <span class="n">Assert</span><span class="o">.</span><span class="na">assertNotNull</span><span class="o">(</span><span class="n">result</span><span class="o">);</span>

  <span class="n">deepAssertEquals</span><span class="o">(</span><span class="n">validEntity</span><span class="o">,</span> <span class="n">result</span><span class="o">);</span>

 <span class="o">}</span>

 <span class="kd">private</span> <span class="kt">void</span> <span class="nf">deepAssertEquals</span><span class="o">(</span><span class="n">Object</span> <span class="n">expected</span><span class="o">,</span> <span class="n">Object</span> <span class="n">actual</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IllegalAccessException</span><span class="o">,</span> <span class="n">InvocationTargetException</span> <span class="o">{</span>
  <span class="n">Assert</span><span class="o">.</span><span class="na">assertEquals</span><span class="o">(</span><span class="n">expected</span><span class="o">.</span><span class="na">getClass</span><span class="o">(),</span> <span class="n">actual</span><span class="o">.</span><span class="na">getClass</span><span class="o">());</span>
  <span class="n">PropertyDescriptor</span><span class="o">[]</span> <span class="n">propertyDescriptors</span> <span class="o">=</span> <span class="n">BeanUtils</span><span class="o">.</span><span class="na">getPropertyDescriptors</span><span class="o">(</span><span class="n">expected</span><span class="o">.</span><span class="na">getClass</span><span class="o">());</span>
  <span class="k">for</span> <span class="o">(</span><span class="n">PropertyDescriptor</span> <span class="n">propertyDescriptor</span> <span class="o">:</span> <span class="n">propertyDescriptors</span><span class="o">)</span> <span class="o">{</span>
   <span class="n">Object</span> <span class="n">expectedValue</span> <span class="o">=</span> <span class="n">propertyDescriptor</span><span class="o">.</span><span class="na">getReadMethod</span><span class="o">().</span><span class="na">invoke</span><span class="o">(</span><span class="n">expected</span><span class="o">);</span>
   <span class="n">Object</span> <span class="n">actualValue</span> <span class="o">=</span> <span class="n">propertyDescriptor</span><span class="o">.</span><span class="na">getReadMethod</span><span class="o">().</span><span class="na">invoke</span><span class="o">(</span><span class="n">actual</span><span class="o">);</span>
   <span class="n">Assert</span><span class="o">.</span><span class="na">assertEquals</span><span class="o">(</span><span class="n">expectedValue</span><span class="o">,</span> <span class="n">actualValue</span><span class="o">);</span>
  <span class="o">}</span>
 <span class="o">}</span>

        <span class="kd">public</span> <span class="kd">static</span> <span class="o">&amp;</span><span class="n">lt</span><span class="o">;</span><span class="n">T</span><span class="o">&amp;</span><span class="n">gt</span><span class="o">;</span> <span class="n">T</span> <span class="nf">fromString</span><span class="o">(</span><span class="n">Class</span><span class="o">&amp;</span><span class="n">lt</span><span class="o">;</span><span class="n">T</span><span class="o">&amp;</span><span class="n">gt</span><span class="o">;</span> <span class="n">clazz</span><span class="o">,</span> <span class="n">String</span> <span class="n">input</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">JAXBException</span> <span class="o">{</span>
  <span class="n">JAXBContext</span> <span class="n">ctx</span> <span class="o">=</span> <span class="n">JAXBContext</span><span class="o">.</span><span class="na">newInstance</span><span class="o">(</span><span class="n">clazz</span><span class="o">);</span>
  <span class="n">Unmarshaller</span> <span class="n">unmarshaller</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="na">createUnmarshaller</span><span class="o">();</span>
  <span class="nd">@SuppressWarnings</span><span class="o">(&amp;</span><span class="n">quot</span><span class="o">;</span><span class="n">unchecked</span><span class="o">&amp;</span><span class="n">quot</span><span class="o">;)</span>
  <span class="n">T</span> <span class="n">unmarshal</span> <span class="o">=</span> <span class="o">(</span><span class="n">T</span><span class="o">)</span> <span class="n">unmarshaller</span><span class="o">.</span><span class="na">unmarshal</span><span class="o">(</span><span class="k">new</span> <span class="n">StringReader</span><span class="o">(</span><span class="n">input</span><span class="o">));</span>
  <span class="k">return</span> <span class="n">unmarshal</span><span class="o">;</span>
 <span class="o">}</span>

 <span class="kd">public</span> <span class="kd">static</span> <span class="o">&amp;</span><span class="n">lt</span><span class="o">;</span><span class="n">T</span><span class="o">&amp;</span><span class="n">gt</span><span class="o">;</span> <span class="n">T</span> <span class="nf">fromString</span><span class="o">(</span><span class="n">Class</span><span class="o">&amp;</span><span class="n">lt</span><span class="o">;</span><span class="n">T</span><span class="o">&amp;</span><span class="n">gt</span><span class="o">;</span> <span class="n">clazz</span><span class="o">,</span> <span class="n">InputStream</span> <span class="n">input</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">JAXBException</span> <span class="o">{</span>
  <span class="n">JAXBContext</span> <span class="n">ctx</span> <span class="o">=</span> <span class="n">JAXBContext</span><span class="o">.</span><span class="na">newInstance</span><span class="o">(</span><span class="n">clazz</span><span class="o">);</span>
  <span class="nd">@SuppressWarnings</span><span class="o">(&amp;</span><span class="n">quot</span><span class="o">;</span><span class="n">unchecked</span><span class="o">&amp;</span><span class="n">quot</span><span class="o">;)</span>
  <span class="n">T</span> <span class="n">unmarshal</span> <span class="o">=</span> <span class="o">(</span><span class="n">T</span><span class="o">)</span> <span class="n">ctx</span><span class="o">.</span><span class="na">createUnmarshaller</span><span class="o">().</span><span class="na">unmarshal</span><span class="o">(</span><span class="n">input</span><span class="o">);</span>
  <span class="k">return</span> <span class="n">unmarshal</span><span class="o">;</span>
 <span class="o">}</span>
<span class="o">}</span>

</code></pre></div><h4>Запуск тестов</h4>
Половина дела сделана, теперь нам необходимо настроить инфраструктуру для тестирования наших свеженаписанных REST-сервисов.
<p>Для этого нам необходимо внести следующие модификации в <tt>pom.xml</tt>:</p>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml">
<span class="ni">&amp;lt;</span>plugin<span class="ni">&amp;gt;</span>
    <span class="ni">&amp;lt;</span>groupId<span class="ni">&amp;gt;</span>org.apache.maven.plugins<span class="ni">&amp;lt;</span>/groupId<span class="ni">&amp;gt;</span>
    <span class="ni">&amp;lt;</span>artifactId<span class="ni">&amp;gt;</span>maven-surefire-plugin<span class="ni">&amp;lt;</span>/artifactId<span class="ni">&amp;gt;</span>
    <span class="ni">&amp;lt;</span>version<span class="ni">&amp;gt;</span>2.11<span class="ni">&amp;lt;</span>/version<span class="ni">&amp;gt;</span>

    <span class="ni">&amp;lt;</span>executions<span class="ni">&amp;gt;</span>
        <span class="ni">&amp;lt;</span>execution<span class="ni">&amp;gt;</span>
     <span class="ni">&amp;lt;</span>id<span class="ni">&amp;gt;</span>Unit tests<span class="ni">&amp;lt;</span>/id<span class="ni">&amp;gt;</span>
            <span class="ni">&amp;lt;</span>phase<span class="ni">&amp;gt;</span>test<span class="ni">&amp;lt;</span>/phase<span class="ni">&amp;gt;</span>
            <span class="ni">&amp;lt;</span>goals<span class="ni">&amp;gt;</span>
                <span class="ni">&amp;lt;</span>goal<span class="ni">&amp;gt;</span>test<span class="ni">&amp;lt;</span>/goal<span class="ni">&amp;gt;</span>
            <span class="ni">&amp;lt;</span>/goals<span class="ni">&amp;gt;</span>
            <span class="ni">&amp;lt;</span>configuration<span class="ni">&amp;gt;</span>
                <span class="ni">&amp;lt;</span>excludes<span class="ni">&amp;gt;</span>
                    <span class="ni">&amp;lt;</span>exclude<span class="ni">&amp;gt;</span>**/IT*.java<span class="ni">&amp;lt;</span>/exclude<span class="ni">&amp;gt;</span>
                <span class="ni">&amp;lt;</span>/excludes<span class="ni">&amp;gt;</span>
            <span class="ni">&amp;lt;</span>/configuration<span class="ni">&amp;gt;</span>
        <span class="ni">&amp;lt;</span>/execution<span class="ni">&amp;gt;</span>
        <span class="ni">&amp;lt;</span>execution<span class="ni">&amp;gt;</span>
            <span class="ni">&amp;lt;</span>id<span class="ni">&amp;gt;</span>Integration tests<span class="ni">&amp;lt;</span>/id<span class="ni">&amp;gt;</span>
            <span class="ni">&amp;lt;</span>phase<span class="ni">&amp;gt;</span>integration-test<span class="ni">&amp;lt;</span>/phase<span class="ni">&amp;gt;</span>
            <span class="ni">&amp;lt;</span>goals<span class="ni">&amp;gt;</span>
                <span class="ni">&amp;lt;</span>goal<span class="ni">&amp;gt;</span>test<span class="ni">&amp;lt;</span>/goal<span class="ni">&amp;gt;</span>
            <span class="ni">&amp;lt;</span>/goals<span class="ni">&amp;gt;</span>
            <span class="ni">&amp;lt;</span>configuration<span class="ni">&amp;gt;</span>
                <span class="ni">&amp;lt;</span>includes<span class="ni">&amp;gt;</span>
                    <span class="ni">&amp;lt;</span>include<span class="ni">&amp;gt;</span>**/IT*.java<span class="ni">&amp;lt;</span>/include<span class="ni">&amp;gt;</span>
                <span class="ni">&amp;lt;</span>/includes<span class="ni">&amp;gt;</span>
            <span class="ni">&amp;lt;</span>/configuration<span class="ni">&amp;gt;</span>
        <span class="ni">&amp;lt;</span>/execution<span class="ni">&amp;gt;</span>
    <span class="ni">&amp;lt;</span>/executions<span class="ni">&amp;gt;</span>
<span class="ni">&amp;lt;</span>/plugin<span class="ni">&amp;gt;</span>

<span class="ni">&amp;lt;</span>dependency<span class="ni">&amp;gt;</span>
    <span class="ni">&amp;lt;</span>groupId<span class="ni">&amp;gt;</span>org.apache.httpcomponents<span class="ni">&amp;lt;</span>/groupId<span class="ni">&amp;gt;</span>
    <span class="ni">&amp;lt;</span>artifactId<span class="ni">&amp;gt;</span>httpclient<span class="ni">&amp;lt;</span>/artifactId<span class="ni">&amp;gt;</span>
    <span class="ni">&amp;lt;</span>version<span class="ni">&amp;gt;</span>4.1.2<span class="ni">&amp;lt;</span>/version<span class="ni">&amp;gt;</span>
    <span class="ni">&amp;lt;</span>scope<span class="ni">&amp;gt;</span>test<span class="ni">&amp;lt;</span>/scope<span class="ni">&amp;gt;</span>
<span class="ni">&amp;lt;</span>/dependency<span class="ni">&amp;gt;</span>
<span class="ni">&amp;lt;</span>dependency<span class="ni">&amp;gt;</span>
    <span class="ni">&amp;lt;</span>groupId<span class="ni">&amp;gt;</span>org.jboss.resteasy<span class="ni">&amp;lt;</span>/groupId<span class="ni">&amp;gt;</span>
    <span class="ni">&amp;lt;</span>artifactId<span class="ni">&amp;gt;</span>resteasy-jaxrs<span class="ni">&amp;lt;</span>/artifactId<span class="ni">&amp;gt;</span>
    <span class="ni">&amp;lt;</span>scope<span class="ni">&amp;gt;</span>test<span class="ni">&amp;lt;</span>/scope<span class="ni">&amp;gt;</span>
<span class="ni">&amp;lt;</span>/dependency<span class="ni">&amp;gt;</span>
<span class="ni">&amp;lt;</span>dependency<span class="ni">&amp;gt;</span>
    <span class="ni">&amp;lt;</span>groupId<span class="ni">&amp;gt;</span>org.jboss.resteasy<span class="ni">&amp;lt;</span>/groupId<span class="ni">&amp;gt;</span>
    <span class="ni">&amp;lt;</span>artifactId<span class="ni">&amp;gt;</span>resteasy-spring<span class="ni">&amp;lt;</span>/artifactId<span class="ni">&amp;gt;</span>
    <span class="ni">&amp;lt;</span>scope<span class="ni">&amp;gt;</span>test<span class="ni">&amp;lt;</span>/scope<span class="ni">&amp;gt;</span>
<span class="ni">&amp;lt;</span>/dependency<span class="ni">&amp;gt;</span>
<span class="ni">&amp;lt;</span>dependency<span class="ni">&amp;gt;</span>
    <span class="ni">&amp;lt;</span>groupId<span class="ni">&amp;gt;</span>org.jboss.resteasy<span class="ni">&amp;lt;</span>/groupId<span class="ni">&amp;gt;</span>
    <span class="ni">&amp;lt;</span>artifactId<span class="ni">&amp;gt;</span>tjws<span class="ni">&amp;lt;</span>/artifactId<span class="ni">&amp;gt;</span>
    <span class="ni">&amp;lt;</span>version<span class="ni">&amp;gt;</span>${resteasy-jaxrs.version}<span class="ni">&amp;lt;</span>/version<span class="ni">&amp;gt;</span>
<span class="ni">&amp;lt;</span>/dependency<span class="ni">&amp;gt;</span>
<span class="ni">&amp;lt;</span>dependency<span class="ni">&amp;gt;</span>
    <span class="ni">&amp;lt;</span>groupId<span class="ni">&amp;gt;</span>javax.servlet<span class="ni">&amp;lt;</span>/groupId<span class="ni">&amp;gt;</span>
    <span class="ni">&amp;lt;</span>artifactId<span class="ni">&amp;gt;</span>servlet-api<span class="ni">&amp;lt;</span>/artifactId<span class="ni">&amp;gt;</span>
    <span class="ni">&amp;lt;</span>scope<span class="ni">&amp;gt;</span>test<span class="ni">&amp;lt;</span>/scope<span class="ni">&amp;gt;</span>
<span class="ni">&amp;lt;</span>/dependency<span class="ni">&amp;gt;</span>
<span class="ni">&amp;lt;</span>dependency<span class="ni">&amp;gt;</span>
    <span class="ni">&amp;lt;</span>groupId<span class="ni">&amp;gt;</span>commons-io<span class="ni">&amp;lt;</span>/groupId<span class="ni">&amp;gt;</span>
    <span class="ni">&amp;lt;</span>artifactId<span class="ni">&amp;gt;</span>commons-io<span class="ni">&amp;lt;</span>/artifactId<span class="ni">&amp;gt;</span>
    <span class="ni">&amp;lt;</span>scope<span class="ni">&amp;gt;</span>test<span class="ni">&amp;lt;</span>/scope<span class="ni">&amp;gt;</span>
<span class="ni">&amp;lt;</span>/dependency<span class="ni">&amp;gt;</span>
</code></pre></div><h4>Заключение</h4>
В целом, ничего сложного, главное делать всё аккуратно. Хорошего вам кода!
        </div>
        

<footer>
  <div class="sharing">
    Share:
    <a href="https://getpocket.com/save?url=https%3a%2f%2futhark.github.io%2f2012%2f02%2f09%2fjava-rest%2f" target="_blank" ><i class="fa fa-get-pocket" title="Save to Pocket" aria-hidden="true"></i></a>
    <a href="https://twitter.com/intent/tweet?text=%d0%a0%d0%b0%d0%b7%d1%80%d0%b0%d0%b1%d0%be%d1%82%d0%ba%d0%b0%20%d0%b8%20%d1%82%d0%b5%d1%81%d1%82%d0%b8%d1%80%d0%be%d0%b2%d0%b0%d0%bd%d0%b8%d0%b5%20Java%20REST%20%d0%b2%d0%b5%d0%b1-%d1%81%d0%b5%d1%80%d0%b2%d0%b8%d1%81%d0%be%d0%b2&url=https%3a%2f%2futhark.github.io%2f2012%2f02%2f09%2fjava-rest%2f" target="_blank" title="Post to Twitter" aria-hidden="true"><i class="fa fa-twitter"></i></a>
  </div>
  <div>
    <hr/>
    <p>If you have any questions, feel free to ping me on Twitter.</p>
  </div>
  
  <p class="meta">
     Estimated reading time: 4 minute(s)
  </p>
  
  <p class="meta">
    
    Last update: <time datetime="2012-02-09">Feb 9, 2012</time>
  </p>
  <p class="meta">
    
    
    
    Categories: <a class="label" href="https://uthark.github.io/categories/article/">#article</a><a class="label" href="https://uthark.github.io/categories/jax-rs/">#jax-rs</a><a class="label" href="https://uthark.github.io/categories/%d1%80%d0%b0%d0%b7%d1%80%d0%b0%d0%b1%d0%be%d1%82%d0%ba%d0%b0/">#разработка</a><a class="label" href="https://uthark.github.io/categories/resteasy/">#resteasy</a><a class="label" href="https://uthark.github.io/categories/development/">#development</a>
  </p>












  </p>
  


  

  <p class="meta">
    
    <a class="basic-alignment left" href="https://uthark.github.io/2012/01/28/aspectj/" title="Немножко магии от AspectJ">&lt;&lt;&nbsp;Немножко магии от AspectJ</a>
    

    
    <a class="basic-alignment right" href="https://uthark.github.io/2012/02/23/jpa-spring-data-jpa/" title="Упрощаем работу с JPA при помощи Spring Data JPA">Упрощаем работу с JPA при помощи Spring Data JPA&nbsp;&gt;&gt;</a>
    
  </p>
  
  
  <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "uthark" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
  
  
</footer>

      </article>
      
    </div>
    

<aside class="sidebar thirds">
  <section class="first odd">

    

    <p>
      
    </p>
  </section>


<section class="even">
  <div class="toc-header">Table of Contents</div>
   <nav id="TableOfContents"></nav>
</section>

  

  
  
  

</aside>

  </div>
</div>

<footer>
    
    <div class="center">
        <ul class="sidebar-nav">
            
            <li class="sidebar-nav-item"><a target="_blank" href="https://github.com/uthark/" title="https://github.com/uthark/"><i class="fa fa-github fa-2x"></i></a>
            </li>
            <li class="sidebar-nav-item">   <a target="_blank" href="https://bitbucket.org/uthark/" title="https://bitbucket.org/uthark/"><i
                    class="fa fa-bitbucket fa-2x"></i></a>
            
            <li class="sidebar-nav-item"><a target="_blank" href="https://twitter.com/real_atamanenko" title="https://twitter.com/real_atamanenko"><i
                    class="fa fa-twitter fa-2x"></i></a>
            <li class="sidebar-nav-item"><a target="_blank" href="https://keybase.io/uthark/" title="https://keybase.io/uthark/"><i
                    class="fa fa-key fa-2x"></i></a> 
            
            <li class="sidebar-nav-item"><a target="_blank" href="http://stackoverflow.com/users/216764/uthark" title="http://stackoverflow.com/users/216764/uthark"><i
                    class="fa fa-stack-overflow fa-2x"></i></a>
            
            
            
                
                
            </li>
            
                
                    
                    
                        <li><a href="https://feeds.feedburner.com/atamanenko" target="_blank" type="application/rss+xml" title="RSS"><i class="fa fa-rss-square fa-2x"></i></a></li>
                    

                
            
        </ul>
    </div>
    <p>&copy;&nbsp;2009&nbsp;—&nbsp;2020 Oleg Atamanenko - <a href="https://uthark.github.io/license/">CC&nbsp;BY-SA&nbsp;4.0</a>
    </p>

</footer>


<script>
    var _gaq = [['_setAccount', 'UA-8688665-1'], ['_trackPageview']];
    (function (d, t) {
        var g = d.createElement(t), s = d.getElementsByTagName(t)[0];
        s.async = 'async'
        g.src = ('https:' == location.protocol ? '//ssl' : '//www') + '.google-analytics.com/ga.js';
        s.parentNode.insertBefore(g, s)
    }(document, 'script'));
</script>


</body>
</html>

